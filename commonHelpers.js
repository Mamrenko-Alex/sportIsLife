var mh=Object.defineProperty;var gh=(t,e,n)=>e in t?mh(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Vo=(t,e,n)=>(gh(t,typeof e!="symbol"?e+"":e,n),n);import"./assets/main-110d946b.js";function _h(){document.querySelector(".filter-list-js").classList.add("hidden-form");const e=document.querySelector(".wrap-js"),n=document.createElement("p");n.className="favorite-text",e.appendChild(n),n.textContent="It appears that you haven`t added any exercises to your favorites yet. To get started, you can add exercises that you like to your favorites for easier access in the future."}const oe="/sportIsLife/assets/sprite-9db62079.svg",er=(t,e)=>t.length<=e?t:`${t.slice(0,e)}...`;function yh(t){const e=document.querySelector(".filter-list-js");e.classList.remove("hidden-form"),t.length>6?e.classList.add("scroll"):e.classList.remove("scroll");const n=t.map(({_id:r,target:i,name:s,bodyPart:o,burnedCalories:a,time:c})=>`
  <li class="favourites_list_item" id=${r}>
    <div class="favourites_list_item_up">
      <div class="favourites_list_item_up_left">
        <span class="favourites_btn_workout">${er(i,6)}</span>
        <button id="btnTrash" class="favourites_btn_trash_icon favourites_btn_trash" data-id=${r}>
          <svg class="favourites_btn_trash_icon" width="16" height="16" aria-label="trash" data-id=${r}>
            <use class="favourites_btn_trash_icon" href="${oe}#icon-trash" data-id=${r}></use>
          </svg>
        </button>
      </div>
      <div class="favourites_list_item_up_right">
        <button class="favourites_btn_start" data-id=${r}>
          <p class="favourites_btn_start_text" data-id=${r}>start</p>
          <svg class="favourites_btn_start_icon" width="16" height="16" aria-label="arrow" data-id=${r}>
            <use href="${oe}#icon-arrow" data-id=${r}></use>
          </svg>
        </button>
      </div>
    </div>
    <div class="favourites_list_item_middle">
      <div class="favourites_list_item_middle_icon">
        <svg class="favourites_list_item_middle_icon_svg">
          <use href="${oe}#icon-run-man"></use>
        </svg>
      </div>
      <h3 class="favourites_list_item_middle_title">${er(s,16)}</h3>
    </div>
    <div class="favourites_list_item_bottom">
      <ul class="favourites_list_item_bottom_list">
        <li class="favourites_list_item_bottom_list_item">
          <p class="favourites_list_item_bottom_list_item_text">
            Burned calories: <span>${a}/${c}</span>
          </p>
        </li>
        <li class="favourites_list_item_bottom_list_item">
          <p class="favourites_list_item_bottom_list_item_text">
            Body part: <span>${er(o,5)}</span>
          </p>
        </li>
        <li class="favourites_list_item_bottom_list_item">
          <p class="favourites_list_item_bottom_list_item_text">Target: <span>${er(i,7)}</span></p>
        </li>
      </ul>
    </div>
  </li>`).join("");e.innerHTML=n}const ac=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},vh=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=t[n++],o=t[n++],a=t[n++],c=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},cc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const s=t[i],o=i+1<t.length,a=o?t[i+1]:0,c=i+2<t.length,l=c?t[i+2]:0,u=s>>2,f=(s&3)<<4|a>>4;let p=(a&15)<<2|l>>6,_=l&63;c||(_=64,o||(p=64)),r.push(n[u],n[f],n[p],n[_])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(ac(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):vh(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const s=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0;++i;const l=i<t.length?n[t.charAt(i)]:64;++i;const f=i<t.length?n[t.charAt(i)]:64;if(++i,s==null||a==null||l==null||f==null)throw new Eh;const p=s<<2|a>>4;if(r.push(p),l!==64){const _=a<<4&240|l>>2;if(r.push(_),f!==64){const O=l<<6&192|f;r.push(O)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class Eh extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ih=function(t){const e=ac(t);return cc.encodeByteArray(e,!0)},Tr=function(t){return Ih(t).replace(/\./g,"")},lc=function(t){try{return cc.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Th(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const wh=()=>Th().__FIREBASE_DEFAULTS__,Ah=()=>{if(typeof process>"u"||typeof process.env>"u")return;const t={}.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Rh=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&lc(t[1]);return e&&JSON.parse(e)},Ts=()=>{try{return wh()||Ah()||Rh()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},uc=t=>{var e,n;return(n=(e=Ts())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},Sh=t=>{const e=uc(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},hc=()=>{var t;return(t=Ts())===null||t===void 0?void 0:t.config},dc=t=>{var e;return(e=Ts())===null||e===void 0?void 0:e[`_${t}`]};class Ch{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}function bh(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t),a="";return[Tr(JSON.stringify(n)),Tr(JSON.stringify(o)),a].join(".")}function ge(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ph(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ge())}function kh(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function Nh(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Dh(){const t=ge();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function Vh(){try{return typeof indexedDB=="object"}catch{return!1}}function Oh(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(n){e(n)}})}const Lh="FirebaseError";class Ge extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=Lh,Object.setPrototypeOf(this,Ge.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ln.prototype.create)}}class Ln{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?Mh(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new Ge(i,a,r)}}function Mh(t,e){return t.replace(xh,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const xh=/\{\$([^}]+)}/g;function Fh(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function wr(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const s=t[i],o=e[i];if(Oo(s)&&Oo(o)){if(!wr(s,o))return!1}else if(s!==o)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function Oo(t){return t!==null&&typeof t=="object"}function Mn(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Uh(t,e){const n=new Bh(t,e);return n.subscribe.bind(n)}class Bh{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");qh(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=Ci),i.error===void 0&&(i.error=Ci),i.complete===void 0&&(i.complete=Ci);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function qh(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Ci(){}function Re(t){return t&&t._delegate?t._delegate:t}class gt{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const lt="[DEFAULT]";class jh{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new Ch;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(zh(e))try{this.getOrInitializeService({instanceIdentifier:lt})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=lt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=lt){return this.instances.has(e)}getOptions(e=lt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);r===a&&o.resolve(i)}return i}onInit(e,n){var r;const i=this.normalizeInstanceIdentifier(n),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:$h(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=lt){return this.component?this.component.multipleInstances?e:lt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function $h(t){return t===lt?void 0:t}function zh(t){return t.instantiationMode==="EAGER"}class Hh{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new jh(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var x;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(x||(x={}));const Wh={debug:x.DEBUG,verbose:x.VERBOSE,info:x.INFO,warn:x.WARN,error:x.ERROR,silent:x.SILENT},Gh=x.INFO,Kh={[x.DEBUG]:"log",[x.VERBOSE]:"log",[x.INFO]:"info",[x.WARN]:"warn",[x.ERROR]:"error"},Qh=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=Kh[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ws{constructor(e){this.name=e,this._logLevel=Gh,this._logHandler=Qh,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in x))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Wh[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,x.DEBUG,...e),this._logHandler(this,x.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,x.VERBOSE,...e),this._logHandler(this,x.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,x.INFO,...e),this._logHandler(this,x.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,x.WARN,...e),this._logHandler(this,x.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,x.ERROR,...e),this._logHandler(this,x.ERROR,...e)}}const Xh=(t,e)=>e.some(n=>t instanceof n);let Lo,Mo;function Jh(){return Lo||(Lo=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Yh(){return Mo||(Mo=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const fc=new WeakMap,Wi=new WeakMap,pc=new WeakMap,bi=new WeakMap,As=new WeakMap;function Zh(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",o)},s=()=>{n(Ze(t.result)),i()},o=()=>{r(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&fc.set(n,t)}).catch(()=>{}),As.set(e,t),e}function ed(t){if(Wi.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",o),t.removeEventListener("abort",o)},s=()=>{n(),i()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",o),t.addEventListener("abort",o)});Wi.set(t,e)}let Gi={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Wi.get(t);if(e==="objectStoreNames")return t.objectStoreNames||pc.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ze(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function td(t){Gi=t(Gi)}function nd(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Pi(this),e,...n);return pc.set(r,e.sort?e.sort():[e]),Ze(r)}:Yh().includes(t)?function(...e){return t.apply(Pi(this),e),Ze(fc.get(this))}:function(...e){return Ze(t.apply(Pi(this),e))}}function rd(t){return typeof t=="function"?nd(t):(t instanceof IDBTransaction&&ed(t),Xh(t,Jh())?new Proxy(t,Gi):t)}function Ze(t){if(t instanceof IDBRequest)return Zh(t);if(bi.has(t))return bi.get(t);const e=rd(t);return e!==t&&(bi.set(t,e),As.set(e,t)),e}const Pi=t=>As.get(t);function id(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=Ze(o);return r&&o.addEventListener("upgradeneeded",c=>{r(Ze(o.result),c.oldVersion,c.newVersion,Ze(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),a.then(c=>{s&&c.addEventListener("close",()=>s()),i&&c.addEventListener("versionchange",l=>i(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}const sd=["get","getKey","getAll","getAllKeys","count"],od=["put","add","delete","clear"],ki=new Map;function xo(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(ki.get(e))return ki.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=od.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||sd.includes(n)))return;const s=async function(o,...a){const c=this.transaction(o,i?"readwrite":"readonly");let l=c.store;return r&&(l=l.index(a.shift())),(await Promise.all([l[n](...a),i&&c.done]))[0]};return ki.set(e,s),s}td(t=>({...t,get:(e,n,r)=>xo(e,n)||t.get(e,n,r),has:(e,n)=>!!xo(e,n)||t.has(e,n)}));class ad{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(cd(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function cd(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Ki="@firebase/app",Fo="0.9.25";const _t=new ws("@firebase/app"),ld="@firebase/app-compat",ud="@firebase/analytics-compat",hd="@firebase/analytics",dd="@firebase/app-check-compat",fd="@firebase/app-check",pd="@firebase/auth",md="@firebase/auth-compat",gd="@firebase/database",_d="@firebase/database-compat",yd="@firebase/functions",vd="@firebase/functions-compat",Ed="@firebase/installations",Id="@firebase/installations-compat",Td="@firebase/messaging",wd="@firebase/messaging-compat",Ad="@firebase/performance",Rd="@firebase/performance-compat",Sd="@firebase/remote-config",Cd="@firebase/remote-config-compat",bd="@firebase/storage",Pd="@firebase/storage-compat",kd="@firebase/firestore",Nd="@firebase/firestore-compat",Dd="firebase",Vd="10.7.1";const Qi="[DEFAULT]",Od={[Ki]:"fire-core",[ld]:"fire-core-compat",[hd]:"fire-analytics",[ud]:"fire-analytics-compat",[fd]:"fire-app-check",[dd]:"fire-app-check-compat",[pd]:"fire-auth",[md]:"fire-auth-compat",[gd]:"fire-rtdb",[_d]:"fire-rtdb-compat",[yd]:"fire-fn",[vd]:"fire-fn-compat",[Ed]:"fire-iid",[Id]:"fire-iid-compat",[Td]:"fire-fcm",[wd]:"fire-fcm-compat",[Ad]:"fire-perf",[Rd]:"fire-perf-compat",[Sd]:"fire-rc",[Cd]:"fire-rc-compat",[bd]:"fire-gcs",[Pd]:"fire-gcs-compat",[kd]:"fire-fst",[Nd]:"fire-fst-compat","fire-js":"fire-js",[Dd]:"fire-js-all"};const Ar=new Map,Xi=new Map;function Ld(t,e){try{t.container.addComponent(e)}catch(n){_t.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Ft(t){const e=t.name;if(Xi.has(e))return _t.debug(`There were multiple attempts to register component ${e}.`),!1;Xi.set(e,t);for(const n of Ar.values())Ld(n,t);return!0}function Rs(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}const Md={["no-app"]:"No Firebase App '{$appName}' has been created - call initializeApp() first",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},et=new Ln("app","Firebase",Md);class xd{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new gt("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw et.create("app-deleted",{appName:this._name})}}const Qt=Vd;function mc(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Qi,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw et.create("bad-app-name",{appName:String(i)});if(n||(n=hc()),!n)throw et.create("no-options");const s=Ar.get(i);if(s){if(wr(n,s.options)&&wr(r,s.config))return s;throw et.create("duplicate-app",{appName:i})}const o=new Hh(i);for(const c of Xi.values())o.addComponent(c);const a=new xd(n,r,o);return Ar.set(i,a),a}function gc(t=Qi){const e=Ar.get(t);if(!e&&t===Qi&&hc())return mc();if(!e)throw et.create("no-app",{appName:t});return e}function tt(t,e,n){var r;let i=(r=Od[t])!==null&&r!==void 0?r:t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),_t.warn(a.join(" "));return}Ft(new gt(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}const Fd="firebase-heartbeat-database",Ud=1,_n="firebase-heartbeat-store";let Ni=null;function _c(){return Ni||(Ni=id(Fd,Ud,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(_n)}}}).catch(t=>{throw et.create("idb-open",{originalErrorMessage:t.message})})),Ni}async function Bd(t){try{return await(await _c()).transaction(_n).objectStore(_n).get(yc(t))}catch(e){if(e instanceof Ge)_t.warn(e.message);else{const n=et.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});_t.warn(n.message)}}}async function Uo(t,e){try{const r=(await _c()).transaction(_n,"readwrite");await r.objectStore(_n).put(e,yc(t)),await r.done}catch(n){if(n instanceof Ge)_t.warn(n.message);else{const r=et.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});_t.warn(r.message)}}}function yc(t){return`${t.name}!${t.options.appId}`}const qd=1024,jd=30*24*60*60*1e3;class $d{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new Hd(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Bo();if(!(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)))return this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=jd}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=Bo(),{heartbeatsToSend:r,unsentEntries:i}=zd(this._heartbeatsCache.heartbeats),s=Tr(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function Bo(){return new Date().toISOString().substring(0,10)}function zd(t,e=qd){const n=[];let r=t.slice();for(const i of t){const s=n.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),qo(n)>e){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),qo(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class Hd{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Vh()?Oh().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await Bd(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return Uo(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return Uo(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function qo(t){return Tr(JSON.stringify({version:2,heartbeats:t})).length}function Wd(t){Ft(new gt("platform-logger",e=>new ad(e),"PRIVATE")),Ft(new gt("heartbeat",e=>new $d(e),"PRIVATE")),tt(Ki,Fo,t),tt(Ki,Fo,"esm2017"),tt("fire-js","")}Wd("");var Gd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},I,Ss=Ss||{},N=Gd||self;function Wr(t){var e=typeof t;return e=e!="object"?e:t?Array.isArray(t)?"array":e:"null",e=="array"||e=="object"&&typeof t.length=="number"}function xn(t){var e=typeof t;return e=="object"&&t!=null||e=="function"}function Kd(t){return Object.prototype.hasOwnProperty.call(t,Di)&&t[Di]||(t[Di]=++Qd)}var Di="closure_uid_"+(1e9*Math.random()>>>0),Qd=0;function Xd(t,e,n){return t.call.apply(t.bind,arguments)}function Jd(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function pe(t,e,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?pe=Xd:pe=Jd,pe.apply(null,arguments)}function tr(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice();return r.push.apply(r,arguments),t.apply(this,r)}}function ie(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function at(){this.s=this.s,this.o=this.o}var Yd=0;at.prototype.s=!1;at.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),Yd!=0)&&Kd(this)};at.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const vc=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(typeof t=="string")return typeof e!="string"||e.length!=1?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function Cs(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function jo(t,e){for(let n=1;n<arguments.length;n++){const r=arguments[n];if(Wr(r)){const i=t.length||0,s=r.length||0;t.length=i+s;for(let o=0;o<s;o++)t[i+o]=r[o]}else t.push(r)}}function me(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}me.prototype.h=function(){this.defaultPrevented=!0};var Zd=function(){if(!N.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const n=()=>{};N.addEventListener("test",n,e),N.removeEventListener("test",n,e)}catch{}return t}();function yn(t){return/^[\s\xa0]*$/.test(t)}function Gr(){var t=N.navigator;return t&&(t=t.userAgent)?t:""}function Pe(t){return Gr().indexOf(t)!=-1}function bs(t){return bs[" "](t),t}bs[" "]=function(){};function ef(t,e){var n=Gf;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}var tf=Pe("Opera"),Ut=Pe("Trident")||Pe("MSIE"),Ec=Pe("Edge"),Ji=Ec||Ut,Ic=Pe("Gecko")&&!(Gr().toLowerCase().indexOf("webkit")!=-1&&!Pe("Edge"))&&!(Pe("Trident")||Pe("MSIE"))&&!Pe("Edge"),nf=Gr().toLowerCase().indexOf("webkit")!=-1&&!Pe("Edge");function Tc(){var t=N.document;return t?t.documentMode:void 0}var Yi;e:{var Vi="",Oi=function(){var t=Gr();if(Ic)return/rv:([^\);]+)(\)|;)/.exec(t);if(Ec)return/Edge\/([\d\.]+)/.exec(t);if(Ut)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t);if(nf)return/WebKit\/(\S+)/.exec(t);if(tf)return/(?:Version)[ \/]?(\S+)/.exec(t)}();if(Oi&&(Vi=Oi?Oi[1]:""),Ut){var Li=Tc();if(Li!=null&&Li>parseFloat(Vi)){Yi=String(Li);break e}}Yi=Vi}var Zi;if(N.document&&Ut){var $o=Tc();Zi=$o||parseInt(Yi,10)||void 0}else Zi=void 0;var rf=Zi;function vn(t,e){if(me.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Ic){e:{try{bs(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else n=="mouseover"?e=t.fromElement:n=="mouseout"&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=t.clientX!==void 0?t.clientX:t.pageX,this.clientY=t.clientY!==void 0?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=typeof t.pointerType=="string"?t.pointerType:sf[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&vn.$.h.call(this)}}ie(vn,me);var sf={2:"touch",3:"pen",4:"mouse"};vn.prototype.h=function(){vn.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Fn="closure_listenable_"+(1e6*Math.random()|0),of=0;function af(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.la=i,this.key=++of,this.fa=this.ia=!1}function Kr(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function Ps(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function cf(t,e){for(const n in t)e.call(void 0,t[n],n,t)}function wc(t){const e={};for(const n in t)e[n]=t[n];return e}const zo="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ac(t,e){let n,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(n in r)t[n]=r[n];for(let s=0;s<zo.length;s++)n=zo[s],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Qr(t){this.src=t,this.g={},this.h=0}Qr.prototype.add=function(t,e,n,r,i){var s=t.toString();t=this.g[s],t||(t=this.g[s]=[],this.h++);var o=ts(t,e,r,i);return-1<o?(e=t[o],n||(e.ia=!1)):(e=new af(e,this.src,s,!!r,i),e.ia=n,t.push(e)),e};function es(t,e){var n=e.type;if(n in t.g){var r=t.g[n],i=vc(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Kr(e),t.g[n].length==0&&(delete t.g[n],t.h--))}}function ts(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.fa&&s.listener==e&&s.capture==!!n&&s.la==r)return i}return-1}var ks="closure_lm_"+(1e6*Math.random()|0),Mi={};function Rc(t,e,n,r,i){if(r&&r.once)return Cc(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Rc(t,e[s],n,r,i);return null}return n=Vs(n),t&&t[Fn]?t.O(e,n,xn(r)?!!r.capture:!!r,i):Sc(t,e,n,!1,r,i)}function Sc(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var o=xn(i)?!!i.capture:!!i,a=Ds(t);if(a||(t[ks]=a=new Qr(t)),n=a.add(e,n,r,o,s),n.proxy)return n;if(r=lf(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Zd||(i=o),i===void 0&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Pc(e.toString()),r);else if(t.addListener&&t.removeListener)t.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function lf(){function t(n){return e.call(t.src,t.listener,n)}const e=uf;return t}function Cc(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Cc(t,e[s],n,r,i);return null}return n=Vs(n),t&&t[Fn]?t.P(e,n,xn(r)?!!r.capture:!!r,i):Sc(t,e,n,!0,r,i)}function bc(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)bc(t,e[s],n,r,i);else r=xn(r)?!!r.capture:!!r,n=Vs(n),t&&t[Fn]?(t=t.i,e=String(e).toString(),e in t.g&&(s=t.g[e],n=ts(s,n,r,i),-1<n&&(Kr(s[n]),Array.prototype.splice.call(s,n,1),s.length==0&&(delete t.g[e],t.h--)))):t&&(t=Ds(t))&&(e=t.g[e.toString()],t=-1,e&&(t=ts(e,n,r,i)),(n=-1<t?e[t]:null)&&Ns(n))}function Ns(t){if(typeof t!="number"&&t&&!t.fa){var e=t.src;if(e&&e[Fn])es(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Pc(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ds(e))?(es(n,t),n.h==0&&(n.src=null,e[ks]=null)):Kr(t)}}}function Pc(t){return t in Mi?Mi[t]:Mi[t]="on"+t}function uf(t,e){if(t.fa)t=!0;else{e=new vn(e,this);var n=t.listener,r=t.la||t.src;t.ia&&Ns(t),t=n.call(r,e)}return t}function Ds(t){return t=t[ks],t instanceof Qr?t:null}var xi="__closure_events_fn_"+(1e9*Math.random()>>>0);function Vs(t){return typeof t=="function"?t:(t[xi]||(t[xi]=function(e){return t.handleEvent(e)}),t[xi])}function re(){at.call(this),this.i=new Qr(this),this.S=this,this.J=null}ie(re,at);re.prototype[Fn]=!0;re.prototype.removeEventListener=function(t,e,n,r){bc(this,t,e,n,r)};function le(t,e){var n,r=t.J;if(r)for(n=[];r;r=r.J)n.push(r);if(t=t.S,r=e.type||e,typeof e=="string")e=new me(e,t);else if(e instanceof me)e.target=e.target||t;else{var i=e;e=new me(r,t),Ac(e,i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=nr(o,r,!0,e)&&i}if(o=e.g=t,i=nr(o,r,!0,e)&&i,i=nr(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)o=e.g=n[s],i=nr(o,r,!1,e)&&i}re.prototype.N=function(){if(re.$.N.call(this),this.i){var t=this.i,e;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Kr(n[r]);delete t.g[e],t.h--}}this.J=null};re.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)};re.prototype.P=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};function nr(t,e,n,r){if(e=t.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&es(t.i,o),i=a.call(c,r)!==!1&&i}}return i&&!r.defaultPrevented}var Os=N.JSON.stringify;class hf{constructor(e,n){this.i=e,this.j=n,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function df(){var t=Ls;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}class ff{constructor(){this.h=this.g=null}add(e,n){const r=kc.get();r.set(e,n),this.h?this.h.next=r:this.g=r,this.h=r}}var kc=new hf(()=>new pf,t=>t.reset());class pf{constructor(){this.next=this.g=this.h=null}set(e,n){this.h=e,this.g=n,this.next=null}reset(){this.next=this.g=this.h=null}}function mf(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function gf(t){N.setTimeout(()=>{throw t},0)}let En,In=!1,Ls=new ff,Nc=()=>{const t=N.Promise.resolve(void 0);En=()=>{t.then(_f)}};var _f=()=>{for(var t;t=df();){try{t.h.call(t.g)}catch(n){gf(n)}var e=kc;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}In=!1};function Xr(t,e){re.call(this),this.h=t||1,this.g=e||N,this.j=pe(this.qb,this),this.l=Date.now()}ie(Xr,re);I=Xr.prototype;I.ga=!1;I.T=null;I.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),le(this,"tick"),this.ga&&(Ms(this),this.start()))}};I.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Ms(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}I.N=function(){Xr.$.N.call(this),Ms(this),delete this.g};function xs(t,e,n){if(typeof t=="function")n&&(t=pe(t,n));else if(t&&typeof t.handleEvent=="function")t=pe(t.handleEvent,t);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:N.setTimeout(t,e||0)}function Dc(t){t.g=xs(()=>{t.g=null,t.i&&(t.i=!1,Dc(t))},t.j);const e=t.h;t.h=null,t.m.apply(null,e)}class yf extends at{constructor(e,n){super(),this.m=e,this.j=n,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Dc(this)}N(){super.N(),this.g&&(N.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Tn(t){at.call(this),this.h=t,this.g={}}ie(Tn,at);var Ho=[];function Vc(t,e,n,r){Array.isArray(n)||(n&&(Ho[0]=n.toString()),n=Ho);for(var i=0;i<n.length;i++){var s=Rc(e,n[i],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function Oc(t){Ps(t.g,function(e,n){this.g.hasOwnProperty(n)&&Ns(e)},t),t.g={}}Tn.prototype.N=function(){Tn.$.N.call(this),Oc(this)};Tn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Jr(){this.g=!0}Jr.prototype.Ea=function(){this.g=!1};function vf(t,e,n,r,i,s){t.info(function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var u=l[0];l=l[1];var f=u.split("_");o=2<=f.length&&f[1]=="type"?o+(u+"="+l+"&"):o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+n+`
`+o})}function Ef(t,e,n,r,i,s,o){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+n+`
`+s+" "+o})}function kt(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+Tf(t,n)+(r?" "+r:"")})}function If(t,e){t.info(function(){return"TIMEOUT: "+e})}Jr.prototype.info=function(){};function Tf(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n){for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return Os(n)}catch{return e}}var wt={},Wo=null;function Yr(){return Wo=Wo||new re}wt.Ta="serverreachability";function Lc(t){me.call(this,wt.Ta,t)}ie(Lc,me);function wn(t){const e=Yr();le(e,new Lc(e))}wt.STAT_EVENT="statevent";function Mc(t,e){me.call(this,wt.STAT_EVENT,t),this.stat=e}ie(Mc,me);function ye(t){const e=Yr();le(e,new Mc(e,t))}wt.Ua="timingevent";function xc(t,e){me.call(this,wt.Ua,t),this.size=e}ie(xc,me);function Un(t,e){if(typeof t!="function")throw Error("Fn must not be null and must be a function");return N.setTimeout(function(){t()},e)}var Zr={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Fc={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Fs(){}Fs.prototype.h=null;function Go(t){return t.h||(t.h=t.i())}function Uc(){}var Bn={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Us(){me.call(this,"d")}ie(Us,me);function Bs(){me.call(this,"c")}ie(Bs,me);var ns;function ei(){}ie(ei,Fs);ei.prototype.g=function(){return new XMLHttpRequest};ei.prototype.i=function(){return{}};ns=new ei;function qn(t,e,n,r){this.l=t,this.j=e,this.m=n,this.W=r||1,this.U=new Tn(this),this.P=wf,t=Ji?125:void 0,this.V=new Xr(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Bc}function Bc(){this.i=null,this.g="",this.h=!1}var wf=45e3,qc={},rs={};I=qn.prototype;I.setTimeout=function(t){this.P=t};function is(t,e,n){t.L=1,t.A=ni($e(e)),t.u=n,t.S=!0,jc(t,null)}function jc(t,e){t.G=Date.now(),jn(t),t.B=$e(t.A);var n=t.B,r=t.W;Array.isArray(r)||(r=[String(r)]),Xc(n.i,"t",r),t.o=0,n=t.l.J,t.h=new Bc,t.g=_l(t.l,n?e:null,!t.u),0<t.O&&(t.M=new yf(pe(t.Pa,t,t.g),t.O)),Vc(t.U,t.g,"readystatechange",t.nb),e=t.I?wc(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),wn(),vf(t.j,t.v,t.B,t.m,t.W,t.u)}I.nb=function(t){t=t.target;const e=this.M;e&&ke(t)==3?e.l():this.Pa(t)};I.Pa=function(t){try{if(t==this.g)e:{const u=ke(this.g);var e=this.g.Ia();const f=this.g.da();if(!(3>u)&&(u!=3||Ji||this.g&&(this.h.h||this.g.ja()||Jo(this.g)))){this.J||u!=4||e==7||(e==8||0>=f?wn(3):wn(2)),ti(this);var n=this.g.da();this.ca=n;t:if($c(this)){var r=Jo(this.g);t="";var i=r.length,s=ke(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ut(this),hn(this);var o="";break t}this.h.i=new N.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=t,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=n==200,Ef(this.j,this.v,this.B,this.m,this.W,u,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!yn(a)){var l=a;break t}}l=null}if(n=l)kt(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ss(this,n);else{this.i=!1,this.s=3,ye(12),ut(this),hn(this);break e}}this.S?(zc(this,u,o),Ji&&this.i&&u==3&&(Vc(this.U,this.V,"tick",this.mb),this.V.start())):(kt(this.j,this.m,o,null),ss(this,o)),u==4&&ut(this),this.i&&!this.J&&(u==4?fl(this.l,this):(this.i=!1,jn(this)))}else zf(this.g),n==400&&0<o.indexOf("Unknown SID")?(this.s=3,ye(12)):(this.s=0,ye(13)),ut(this),hn(this)}}}catch{}finally{}};function $c(t){return t.g?t.v=="GET"&&t.L!=2&&t.l.Ha:!1}function zc(t,e,n){let r=!0,i;for(;!t.J&&t.o<n.length;)if(i=Af(t,n),i==rs){e==4&&(t.s=4,ye(14),r=!1),kt(t.j,t.m,null,"[Incomplete Response]");break}else if(i==qc){t.s=4,ye(15),kt(t.j,t.m,n,"[Invalid Chunk]"),r=!1;break}else kt(t.j,t.m,i,null),ss(t,i);$c(t)&&t.o!=0&&(t.h.g=t.h.g.slice(t.o),t.o=0),e!=4||n.length!=0||t.h.h||(t.s=1,ye(16),r=!1),t.i=t.i&&r,r?0<n.length&&!t.ba&&(t.ba=!0,e=t.l,e.g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Ws(e),e.M=!0,ye(11))):(kt(t.j,t.m,n,"[Invalid Chunked Response]"),ut(t),hn(t))}I.mb=function(){if(this.g){var t=ke(this.g),e=this.g.ja();this.o<e.length&&(ti(this),zc(this,t,e),this.i&&t!=4&&jn(this))}};function Af(t,e){var n=t.o,r=e.indexOf(`
`,n);return r==-1?rs:(n=Number(e.substring(n,r)),isNaN(n)?qc:(r+=1,r+n>e.length?rs:(e=e.slice(r,r+n),t.o=r+n,e)))}I.cancel=function(){this.J=!0,ut(this)};function jn(t){t.Y=Date.now()+t.P,Hc(t,t.P)}function Hc(t,e){if(t.C!=null)throw Error("WatchDog timer not null");t.C=Un(pe(t.lb,t),e)}function ti(t){t.C&&(N.clearTimeout(t.C),t.C=null)}I.lb=function(){this.C=null;const t=Date.now();0<=t-this.Y?(If(this.j,this.B),this.L!=2&&(wn(),ye(17)),ut(this),this.s=2,hn(this)):Hc(this,this.Y-t)};function hn(t){t.l.H==0||t.J||fl(t.l,t)}function ut(t){ti(t);var e=t.M;e&&typeof e.sa=="function"&&e.sa(),t.M=null,Ms(t.V),Oc(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function ss(t,e){try{var n=t.l;if(n.H!=0&&(n.g==t||os(n.i,t))){if(!t.K&&os(n.i,t)&&n.H==3){try{var r=n.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!n.u){if(n.g)if(n.g.G+3e3<t.G)Cr(n),oi(n);else break e;Hs(n),ye(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&n.A==0&&!n.v&&(n.v=Un(pe(n.ib,n),6e3));if(1>=Zc(n.i)&&n.oa){try{n.oa()}catch{}n.oa=void 0}}else ht(n,11)}else if((t.K||n.g==t)&&Cr(n),!yn(e))for(i=n.Ja.g.parse(e),e=0;e<i.length;e++){let l=i[e];if(n.V=l[0],l=l[1],n.H==2)if(l[0]=="c"){n.K=l[1],n.pa=l[2];const u=l[3];u!=null&&(n.ra=u,n.l.info("VER="+n.ra));const f=l[4];f!=null&&(n.Ga=f,n.l.info("SVER="+n.Ga));const p=l[5];p!=null&&typeof p=="number"&&0<p&&(r=1.5*p,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const _=t.g;if(_){const O=_.g?_.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(O){var s=r.i;s.g||O.indexOf("spdy")==-1&&O.indexOf("quic")==-1&&O.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(qs(s,s.h),s.h=null))}if(r.F){const S=_.g?_.g.getResponseHeader("X-HTTP-Session-Id"):null;S&&(r.Da=S,z(r.I,r.F,S))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms")),r=n;var o=t;if(r.wa=gl(r,r.J?r.pa:null,r.Y),o.K){el(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(ti(a),jn(a)),r.g=o}else hl(r);0<n.j.length&&ai(n)}else l[0]!="stop"&&l[0]!="close"||ht(n,7);else n.H==3&&(l[0]=="stop"||l[0]=="close"?l[0]=="stop"?ht(n,7):zs(n):l[0]!="noop"&&n.h&&n.h.Aa(l),n.A=0)}}wn(4)}catch{}}function Rf(t){if(t.Z&&typeof t.Z=="function")return t.Z();if(typeof Map<"u"&&t instanceof Map||typeof Set<"u"&&t instanceof Set)return Array.from(t.values());if(typeof t=="string")return t.split("");if(Wr(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}e=[],n=0;for(r in t)e[n++]=t[r];return e}function Sf(t){if(t.ta&&typeof t.ta=="function")return t.ta();if(!t.Z||typeof t.Z!="function"){if(typeof Map<"u"&&t instanceof Map)return Array.from(t.keys());if(!(typeof Set<"u"&&t instanceof Set)){if(Wr(t)||typeof t=="string"){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}function Wc(t,e){if(t.forEach&&typeof t.forEach=="function")t.forEach(e,void 0);else if(Wr(t)||typeof t=="string")Array.prototype.forEach.call(t,e,void 0);else for(var n=Sf(t),r=Rf(t),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],n&&n[s],t)}var Gc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Cf(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function pt(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof pt){this.h=t.h,Rr(this,t.j),this.s=t.s,this.g=t.g,Sr(this,t.m),this.l=t.l;var e=t.i,n=new An;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),Ko(this,n),this.o=t.o}else t&&(e=String(t).match(Gc))?(this.h=!1,Rr(this,e[1]||"",!0),this.s=an(e[2]||""),this.g=an(e[3]||"",!0),Sr(this,e[4]),this.l=an(e[5]||"",!0),Ko(this,e[6]||"",!0),this.o=an(e[7]||"")):(this.h=!1,this.i=new An(null,this.h))}pt.prototype.toString=function(){var t=[],e=this.j;e&&t.push(cn(e,Qo,!0),":");var n=this.g;return(n||e=="file")&&(t.push("//"),(e=this.s)&&t.push(cn(e,Qo,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&t.push(":",String(n))),(n=this.l)&&(this.g&&n.charAt(0)!="/"&&t.push("/"),t.push(cn(n,n.charAt(0)=="/"?kf:Pf,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",cn(n,Df)),t.join("")};function $e(t){return new pt(t)}function Rr(t,e,n){t.j=n?an(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Sr(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Ko(t,e,n){e instanceof An?(t.i=e,Vf(t.i,t.h)):(n||(e=cn(e,Nf)),t.i=new An(e,t.h))}function z(t,e,n){t.i.set(e,n)}function ni(t){return z(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function an(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function cn(t,e,n){return typeof t=="string"?(t=encodeURI(t).replace(e,bf),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function bf(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(t&15).toString(16)}var Qo=/[#\/\?@]/g,Pf=/[#\?:]/g,kf=/[#\?]/g,Nf=/[#\?@]/g,Df=/#/g;function An(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function ct(t){t.g||(t.g=new Map,t.h=0,t.i&&Cf(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}I=An.prototype;I.add=function(t,e){ct(this),this.i=null,t=Xt(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this};function Kc(t,e){ct(t),e=Xt(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Qc(t,e){return ct(t),e=Xt(t,e),t.g.has(e)}I.forEach=function(t,e){ct(this),this.g.forEach(function(n,r){n.forEach(function(i){t.call(e,i,r,this)},this)},this)};I.ta=function(){ct(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const i=t[r];for(let s=0;s<i.length;s++)n.push(e[r])}return n};I.Z=function(t){ct(this);let e=[];if(typeof t=="string")Qc(this,t)&&(e=e.concat(this.g.get(Xt(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e};I.set=function(t,e){return ct(this),this.i=null,t=Xt(this,t),Qc(this,t)&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this};I.get=function(t,e){return t?(t=this.Z(t),0<t.length?String(t[0]):e):e};function Xc(t,e,n){Kc(t,e),0<n.length&&(t.i=null,t.g.set(Xt(t,e),Cs(n)),t.h+=n.length)}I.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),t.push(i)}}return this.i=t.join("&")};function Xt(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Vf(t,e){e&&!t.j&&(ct(t),t.i=null,t.g.forEach(function(n,r){var i=r.toLowerCase();r!=i&&(Kc(this,r),Xc(this,i,n))},t)),t.j=e}var Of=class{constructor(t,e){this.g=t,this.map=e}};function Jc(t){this.l=t||Lf,N.PerformanceNavigationTiming?(t=N.performance.getEntriesByType("navigation"),t=0<t.length&&(t[0].nextHopProtocol=="hq"||t[0].nextHopProtocol=="h2")):t=!!(N.g&&N.g.Ka&&N.g.Ka()&&N.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Lf=10;function Yc(t){return t.h?!0:t.g?t.g.size>=t.j:!1}function Zc(t){return t.h?1:t.g?t.g.size:0}function os(t,e){return t.h?t.h==e:t.g?t.g.has(e):!1}function qs(t,e){t.g?t.g.add(e):t.h=e}function el(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}Jc.prototype.cancel=function(){if(this.i=tl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const t of this.g.values())t.cancel();this.g.clear()}};function tl(t){if(t.h!=null)return t.i.concat(t.h.F);if(t.g!=null&&t.g.size!==0){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return Cs(t.i)}var Mf=class{stringify(t){return N.JSON.stringify(t,void 0)}parse(t){return N.JSON.parse(t,void 0)}};function xf(){this.g=new Mf}function Ff(t,e,n){const r=n||"";try{Wc(t,function(i,s){let o=i;xn(i)&&(o=Os(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Uf(t,e){const n=new Jr;if(N.Image){const r=new Image;r.onload=tr(rr,n,r,"TestLoadImage: loaded",!0,e),r.onerror=tr(rr,n,r,"TestLoadImage: error",!1,e),r.onabort=tr(rr,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=tr(rr,n,r,"TestLoadImage: timeout",!1,e),N.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}function rr(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function ri(t){this.l=t.ec||null,this.j=t.ob||!1}ie(ri,Fs);ri.prototype.g=function(){return new ii(this.l,this.j)};ri.prototype.i=function(t){return function(){return t}}({});function ii(t,e){re.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=js,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ie(ii,re);var js=0;I=ii.prototype;I.open=function(t,e){if(this.readyState!=js)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Rn(this)};I.send=function(t){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||N).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};I.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,$n(this)),this.readyState=js};I.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Rn(this)),this.g&&(this.readyState=3,Rn(this),this.g)))if(this.responseType==="arraybuffer")t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof N.ReadableStream<"u"&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;nl(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))};function nl(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}I.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?$n(this):Rn(this),this.readyState==3&&nl(this)}};I.Za=function(t){this.g&&(this.response=this.responseText=t,$n(this))};I.Ya=function(t){this.g&&(this.response=t,$n(this))};I.ka=function(){this.g&&$n(this)};function $n(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Rn(t)}I.setRequestHeader=function(t,e){this.v.append(t,e)};I.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""};I.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join(`\r
`)};function Rn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}Object.defineProperty(ii.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(t){this.m=t?"include":"same-origin"}});var Bf=N.JSON.parse;function K(t){re.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=rl,this.L=this.M=!1}ie(K,re);var rl="",qf=/^https?$/i,jf=["POST","PUT"];I=K.prototype;I.Oa=function(t){this.M=t};I.ha=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():ns.g(),this.C=this.u?Go(this.u):Go(ns),this.g.onreadystatechange=pe(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(s){Xo(this,s);return}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(const s of r.keys())n.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(n.keys()).find(s=>s.toLowerCase()=="content-type"),i=N.FormData&&t instanceof N.FormData,!(0<=vc(jf,e))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of n)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{ol(this),0<this.B&&((this.L=$f(this.g))?(this.g.timeout=this.B,this.g.ontimeout=pe(this.ua,this)):this.A=xs(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(s){Xo(this,s)}};function $f(t){return Ut&&typeof t.timeout=="number"&&t.ontimeout!==void 0}I.ua=function(){typeof Ss<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,le(this,"timeout"),this.abort(8))};function Xo(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,il(t),si(t)}function il(t){t.F||(t.F=!0,le(t,"complete"),le(t,"error"))}I.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,le(this,"complete"),le(this,"abort"),si(this))};I.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),si(this,!0)),K.$.N.call(this)};I.La=function(){this.s||(this.G||this.v||this.l?sl(this):this.kb())};I.kb=function(){sl(this)};function sl(t){if(t.h&&typeof Ss<"u"&&(!t.C[1]||ke(t)!=4||t.da()!=2)){if(t.v&&ke(t)==4)xs(t.La,0,t);else if(le(t,"readystatechange"),ke(t)==4){t.h=!1;try{const o=t.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var n;if(!(n=e)){var r;if(r=o===0){var i=String(t.I).match(Gc)[1]||null;!i&&N.self&&N.self.location&&(i=N.self.location.protocol.slice(0,-1)),r=!qf.test(i?i.toLowerCase():"")}n=r}if(n)le(t,"complete"),le(t,"success");else{t.m=6;try{var s=2<ke(t)?t.g.statusText:""}catch{s=""}t.j=s+" ["+t.da()+"]",il(t)}}finally{si(t)}}}}function si(t,e){if(t.g){ol(t);const n=t.g,r=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||le(t,"ready");try{n.onreadystatechange=r}catch{}}}function ol(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(N.clearTimeout(t.A),t.A=null)}I.isActive=function(){return!!this.g};function ke(t){return t.g?t.g.readyState:0}I.da=function(){try{return 2<ke(this)?this.g.status:-1}catch{return-1}};I.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};I.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&e.indexOf(t)==0&&(e=e.substring(t.length)),Bf(e)}};function Jo(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case rl:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch{return null}}function zf(t){const e={};t=(t.g&&2<=ke(t)&&t.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<t.length;r++){if(yn(t[r]))continue;var n=mf(t[r]);const i=n[0];if(n=n[1],typeof n!="string")continue;n=n.trim();const s=e[i]||[];e[i]=s,s.push(n)}cf(e,function(r){return r.join(", ")})}I.Ia=function(){return this.m};I.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function al(t){let e="";return Ps(t,function(n,r){e+=r,e+=":",e+=n,e+=`\r
`}),e}function $s(t,e,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=al(n),typeof t=="string"?n!=null&&encodeURIComponent(String(n)):z(t,e,n))}function rn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function cl(t){this.Ga=0,this.j=[],this.l=new Jr,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=rn("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=rn("baseRetryDelayMs",5e3,t),this.hb=rn("retryDelaySeedMs",1e4,t),this.eb=rn("forwardChannelMaxRetries",2,t),this.xa=rn("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new Jc(t&&t.concurrentRequestLimit),this.Ja=new xf,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}I=cl.prototype;I.ra=8;I.H=1;function zs(t){if(ll(t),t.H==3){var e=t.W++,n=$e(t.I);if(z(n,"SID",t.K),z(n,"RID",e),z(n,"TYPE","terminate"),zn(t,n),e=new qn(t,t.l,e),e.L=2,e.A=ni($e(n)),n=!1,N.navigator&&N.navigator.sendBeacon)try{n=N.navigator.sendBeacon(e.A.toString(),"")}catch{}!n&&N.Image&&(new Image().src=e.A,n=!0),n||(e.g=_l(e.l,null),e.g.ha(e.A)),e.G=Date.now(),jn(e)}ml(t)}function oi(t){t.g&&(Ws(t),t.g.cancel(),t.g=null)}function ll(t){oi(t),t.u&&(N.clearTimeout(t.u),t.u=null),Cr(t),t.i.cancel(),t.m&&(typeof t.m=="number"&&N.clearTimeout(t.m),t.m=null)}function ai(t){if(!Yc(t.i)&&!t.m){t.m=!0;var e=t.Na;En||Nc(),In||(En(),In=!0),Ls.add(e,t),t.C=0}}function Hf(t,e){return Zc(t.i)>=t.i.j-(t.m?1:0)?!1:t.m?(t.j=e.F.concat(t.j),!0):t.H==1||t.H==2||t.C>=(t.cb?0:t.eb)?!1:(t.m=Un(pe(t.Na,t,e),pl(t,t.C)),t.C++,!0)}I.Na=function(t){if(this.m)if(this.m=null,this.H==1){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const i=new qn(this,this.l,t);let s=this.s;if(this.U&&(s?(s=wc(s),Ac(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,n=0;n<this.j.length;n++){t:{var r=this.j[n];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=n;break e}if(e===4096||n===this.j.length-1){e=n+1;break e}}e=1e3}else e=1e3;e=ul(this,i,e),n=$e(this.I),z(n,"RID",t),z(n,"CVER",22),this.F&&z(n,"X-HTTP-Session-Id",this.F),zn(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(al(s)))+"&"+e:this.o&&$s(n,this.o,s)),qs(this.i,i),this.bb&&z(n,"TYPE","init"),this.P?(z(n,"$req",e),z(n,"SID","null"),i.aa=!0,is(i,n,null)):is(i,n,e),this.H=2}}else this.H==3&&(t?Yo(this,t):this.j.length==0||Yc(this.i)||Yo(this))};function Yo(t,e){var n;e?n=e.m:n=t.W++;const r=$e(t.I);z(r,"SID",t.K),z(r,"RID",n),z(r,"AID",t.V),zn(t,r),t.o&&t.s&&$s(r,t.o,t.s),n=new qn(t,t.l,n,t.C+1),t.o===null&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=ul(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),qs(t.i,n),is(n,r,e)}function zn(t,e){t.na&&Ps(t.na,function(n,r){z(e,r,n)}),t.h&&Wc({},function(n,r){z(e,r,n)})}function ul(t,e,n){n=Math.min(t.j.length,n);var r=t.h?pe(t.h.Va,t.h,t):null;e:{var i=t.j;let s=-1;for(;;){const o=["count="+n];s==-1?0<n?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let c=0;c<n;c++){let l=i[c].g;const u=i[c].map;if(l-=s,0>l)s=Math.max(0,i[c].g-100),a=!1;else try{Ff(u,o,"req"+l+"_")}catch{r&&r(u)}}if(a){r=o.join("&");break e}}}return t=t.j.splice(0,n),e.F=t,r}function hl(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;En||Nc(),In||(En(),In=!0),Ls.add(e,t),t.A=0}}function Hs(t){return t.g||t.u||3<=t.A?!1:(t.ba++,t.u=Un(pe(t.Ma,t),pl(t,t.A)),t.A++,!0)}I.Ma=function(){if(this.u=null,dl(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=Un(pe(this.jb,this),t)}};I.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,ye(10),oi(this),dl(this))};function Ws(t){t.B!=null&&(N.clearTimeout(t.B),t.B=null)}function dl(t){t.g=new qn(t,t.l,"rpc",t.ba),t.o===null&&(t.g.I=t.s),t.g.O=0;var e=$e(t.wa);z(e,"RID","rpc"),z(e,"SID",t.K),z(e,"AID",t.V),z(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&z(e,"TO",t.qa),z(e,"TYPE","xmlhttp"),zn(t,e),t.o&&t.s&&$s(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.A=ni($e(e)),n.u=null,n.S=!0,jc(n,t)}I.ib=function(){this.v!=null&&(this.v=null,oi(this),Hs(this),ye(19))};function Cr(t){t.v!=null&&(N.clearTimeout(t.v),t.v=null)}function fl(t,e){var n=null;if(t.g==e){Cr(t),Ws(t),t.g=null;var r=2}else if(os(t.i,e))n=e.F,el(t.i,e),r=1;else return;if(t.H!=0){if(e.i)if(r==1){n=e.u?e.u.length:0,e=Date.now()-e.G;var i=t.C;r=Yr(),le(r,new xc(r,n)),ai(t)}else hl(t);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&Hf(t,e)||r==2&&Hs(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:ht(t,5);break;case 4:ht(t,10);break;case 3:ht(t,6);break;default:ht(t,2)}}}function pl(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function ht(t,e){if(t.l.info("Error code "+e),e==2){var n=null;t.h&&(n=null);var r=pe(t.pb,t);n||(n=new pt("//www.google.com/images/cleardot.gif"),N.location&&N.location.protocol=="http"||Rr(n,"https"),ni(n)),Uf(n.toString(),r)}else ye(2);t.H=0,t.h&&t.h.za(e),ml(t),ll(t)}I.pb=function(t){t?(this.l.info("Successfully pinged google.com"),ye(2)):(this.l.info("Failed to ping google.com"),ye(1))};function ml(t){if(t.H=0,t.ma=[],t.h){const e=tl(t.i);(e.length!=0||t.j.length!=0)&&(jo(t.ma,e),jo(t.ma,t.j),t.i.i.length=0,Cs(t.j),t.j.length=0),t.h.ya()}}function gl(t,e,n){var r=n instanceof pt?$e(n):new pt(n);if(r.g!="")e&&(r.g=e+"."+r.g),Sr(r,r.m);else{var i=N.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new pt(null);r&&Rr(s,r),e&&(s.g=e),i&&Sr(s,i),n&&(s.l=n),r=s}return n=t.F,e=t.Da,n&&e&&z(r,n,e),z(r,"VER",t.ra),zn(t,r),r}function _l(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=t.Ha&&!t.va?new K(new ri({ob:n})):new K(t.va),e.Oa(t.J),e}I.isActive=function(){return!!this.h&&this.h.isActive(this)};function yl(){}I=yl.prototype;I.Ba=function(){};I.Aa=function(){};I.za=function(){};I.ya=function(){};I.isActive=function(){return!0};I.Va=function(){};function br(){if(Ut&&!(10<=Number(rf)))throw Error("Environmental error: no available transport.")}br.prototype.g=function(t,e){return new Ie(t,e)};function Ie(t,e){re.call(this),this.g=new cl(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!yn(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!yn(e)&&(this.g.F=e,t=this.h,t!==null&&e in t&&(t=this.h,e in t&&delete t[e])),this.j=new Jt(this)}ie(Ie,re);Ie.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;ye(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=gl(t,null,t.Y),ai(t)};Ie.prototype.close=function(){zs(this.g)};Ie.prototype.u=function(t){var e=this.g;if(typeof t=="string"){var n={};n.__data__=t,t=n}else this.v&&(n={},n.__data__=Os(t),t=n);e.j.push(new Of(e.fb++,t)),e.H==3&&ai(e)};Ie.prototype.N=function(){this.g.h=null,delete this.j,zs(this.g),delete this.g,Ie.$.N.call(this)};function vl(t){Us.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){e:{for(const n in e){t=n;break e}t=void 0}(this.i=t)&&(t=this.i,e=e!==null&&t in e?e[t]:void 0),this.data=e}else this.data=t}ie(vl,Us);function El(){Bs.call(this),this.status=1}ie(El,Bs);function Jt(t){this.g=t}ie(Jt,yl);Jt.prototype.Ba=function(){le(this.g,"a")};Jt.prototype.Aa=function(t){le(this.g,new vl(t))};Jt.prototype.za=function(t){le(this.g,new El)};Jt.prototype.ya=function(){le(this.g,"b")};function Wf(){this.blockSize=-1}function be(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}ie(be,Wf);be.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function Fi(t,e,n){n||(n=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];var s=t.g[3],o=e+(s^n&(i^s))+r[0]+3614090360&4294967295;e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[3]+3250441966&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(s^n&(i^s))+r[4]+4118548399&4294967295,e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[7]+4249261313&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(s^n&(i^s))+r[8]+1770035416&4294967295,e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[11]+2304563134&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(s^n&(i^s))+r[12]+1804603682&4294967295,e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[15]+1236535329&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(n^i))+r[1]+4129170786&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[0]+3921069994&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(n^i))+r[5]+3593408605&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[4]+3889429448&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(n^i))+r[9]+568446438&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[8]+1163531501&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(n^i))+r[13]+2850285829&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[12]+2368359562&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(n^i^s)+r[5]+4294588738&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[14]+4259657740&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(n^i^s)+r[1]+2763975236&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[10]+3200236656&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(n^i^s)+r[13]+681279174&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[6]+76029189&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(n^i^s)+r[9]+3654602809&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[2]+3299628645&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(i^(n|~s))+r[0]+4096336452&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[5]+4237533241&4294967295,n=i+(o<<21&4294967295|o>>>11),o=e+(i^(n|~s))+r[12]+1700485571&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[1]+2240044497&4294967295,n=i+(o<<21&4294967295|o>>>11),o=e+(i^(n|~s))+r[8]+1873313359&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[13]+1309151649&4294967295,n=i+(o<<21&4294967295|o>>>11),o=e+(i^(n|~s))+r[4]+4149444226&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+s&4294967295}be.prototype.j=function(t,e){e===void 0&&(e=t.length);for(var n=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=n;)Fi(this,t,s),s+=this.blockSize;if(typeof t=="string"){for(;s<e;)if(r[i++]=t.charCodeAt(s++),i==this.blockSize){Fi(this,r),i=0;break}}else for(;s<e;)if(r[i++]=t[s++],i==this.blockSize){Fi(this,r),i=0;break}}this.h=i,this.i+=e};be.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=n&255,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};function j(t,e){this.h=e;for(var n=[],r=!0,i=t.length-1;0<=i;i--){var s=t[i]|0;r&&s==e||(n[i]=s,r=!1)}this.g=n}var Gf={};function Gs(t){return-128<=t&&128>t?ef(t,function(e){return new j([e|0],0>e?-1:0)}):new j([t|0],0>t?-1:0)}function Ne(t){if(isNaN(t)||!isFinite(t))return Nt;if(0>t)return ae(Ne(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=as;return new j(e,0)}function Il(t,e){if(t.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(t.charAt(0)=="-")return ae(Il(t.substring(1),e));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=Ne(Math.pow(e,8)),r=Nt,i=0;i<t.length;i+=8){var s=Math.min(8,t.length-i),o=parseInt(t.substring(i,i+s),e);8>s?(s=Ne(Math.pow(e,s)),r=r.R(s).add(Ne(o))):(r=r.R(n),r=r.add(Ne(o)))}return r}var as=4294967296,Nt=Gs(0),cs=Gs(1),Zo=Gs(16777216);I=j.prototype;I.ea=function(){if(Te(this))return-ae(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.D(n);t+=(0<=r?r:as+r)*e,e*=as}return t};I.toString=function(t){if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(Be(this))return"0";if(Te(this))return"-"+ae(this).toString(t);for(var e=Ne(Math.pow(t,6)),n=this,r="";;){var i=kr(n,e).g;n=Pr(n,i.R(e));var s=((0<n.g.length?n.g[0]:n.h)>>>0).toString(t);if(n=i,Be(n))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};I.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h};function Be(t){if(t.h!=0)return!1;for(var e=0;e<t.g.length;e++)if(t.g[e]!=0)return!1;return!0}function Te(t){return t.h==-1}I.X=function(t){return t=Pr(this,t),Te(t)?-1:Be(t)?0:1};function ae(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new j(n,~t.h).add(cs)}I.abs=function(){return Te(this)?ae(this):this};I.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(t.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(t.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new j(n,n[n.length-1]&-2147483648?-1:0)};function Pr(t,e){return t.add(ae(e))}I.R=function(t){if(Be(this)||Be(t))return Nt;if(Te(this))return Te(t)?ae(this).R(ae(t)):ae(ae(this).R(t));if(Te(t))return ae(this.R(ae(t)));if(0>this.X(Zo)&&0>t.X(Zo))return Ne(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<t.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=t.D(i)>>>16,c=t.D(i)&65535;n[2*r+2*i]+=o*c,ir(n,2*r+2*i),n[2*r+2*i+1]+=s*c,ir(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,ir(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,ir(n,2*r+2*i+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new j(n,0)};function ir(t,e){for(;(t[e]&65535)!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function sn(t,e){this.g=t,this.h=e}function kr(t,e){if(Be(e))throw Error("division by zero");if(Be(t))return new sn(Nt,Nt);if(Te(t))return e=kr(ae(t),e),new sn(ae(e.g),ae(e.h));if(Te(e))return e=kr(t,ae(e)),new sn(ae(e.g),e.h);if(30<t.g.length){if(Te(t)||Te(e))throw Error("slowDivide_ only works with positive integers.");for(var n=cs,r=e;0>=r.X(t);)n=ea(n),r=ea(r);var i=St(n,1),s=St(r,1);for(r=St(r,2),n=St(n,2);!Be(r);){var o=s.add(r);0>=o.X(t)&&(i=i.add(n),s=o),r=St(r,1),n=St(n,1)}return e=Pr(t,i.R(e)),new sn(i,e)}for(i=Nt;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),r=Math.ceil(Math.log(n)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=Ne(n),o=s.R(e);Te(o)||0<o.X(t);)n-=r,s=Ne(n),o=s.R(e);Be(s)&&(s=cs),i=i.add(s),t=Pr(t,o)}return new sn(i,t)}I.gb=function(t){return kr(this,t).h};I.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)&t.D(r);return new j(n,this.h&t.h)};I.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)|t.D(r);return new j(n,this.h|t.h)};I.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)^t.D(r);return new j(n,this.h^t.h)};function ea(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.D(r)<<1|t.D(r-1)>>>31;return new j(n,t.h)}function St(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,i=[],s=0;s<r;s++)i[s]=0<e?t.D(s+n)>>>e|t.D(s+n+1)<<32-e:t.D(s+n);return new j(i,t.h)}br.prototype.createWebChannel=br.prototype.g;Ie.prototype.send=Ie.prototype.u;Ie.prototype.open=Ie.prototype.m;Ie.prototype.close=Ie.prototype.close;Zr.NO_ERROR=0;Zr.TIMEOUT=8;Zr.HTTP_ERROR=6;Fc.COMPLETE="complete";Uc.EventType=Bn;Bn.OPEN="a";Bn.CLOSE="b";Bn.ERROR="c";Bn.MESSAGE="d";re.prototype.listen=re.prototype.O;K.prototype.listenOnce=K.prototype.P;K.prototype.getLastError=K.prototype.Sa;K.prototype.getLastErrorCode=K.prototype.Ia;K.prototype.getStatus=K.prototype.da;K.prototype.getResponseJson=K.prototype.Wa;K.prototype.getResponseText=K.prototype.ja;K.prototype.send=K.prototype.ha;K.prototype.setWithCredentials=K.prototype.Oa;be.prototype.digest=be.prototype.l;be.prototype.reset=be.prototype.reset;be.prototype.update=be.prototype.j;j.prototype.add=j.prototype.add;j.prototype.multiply=j.prototype.R;j.prototype.modulo=j.prototype.gb;j.prototype.compare=j.prototype.X;j.prototype.toNumber=j.prototype.ea;j.prototype.toString=j.prototype.toString;j.prototype.getBits=j.prototype.D;j.fromNumber=Ne;j.fromString=Il;var Kf=function(){return new br},Qf=function(){return Yr()},Ui=Zr,Xf=Fc,Jf=wt,ta={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},sr=Uc,Yf=K,Zf=be,Dt=j;const na="@firebase/firestore";let de=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};de.UNAUTHENTICATED=new de(null),de.GOOGLE_CREDENTIALS=new de("google-credentials-uid"),de.FIRST_PARTY=new de("first-party-uid"),de.MOCK_USER=new de("mock-user");let Yt="10.7.0";const yt=new ws("@firebase/firestore");function on(){return yt.logLevel}function T(t,...e){if(yt.logLevel<=x.DEBUG){const n=e.map(Ks);yt.debug(`Firestore (${Yt}): ${t}`,...n)}}function ze(t,...e){if(yt.logLevel<=x.ERROR){const n=e.map(Ks);yt.error(`Firestore (${Yt}): ${t}`,...n)}}function Bt(t,...e){if(yt.logLevel<=x.WARN){const n=e.map(Ks);yt.warn(`Firestore (${Yt}): ${t}`,...n)}}function Ks(t){if(typeof t=="string")return t;try{return function(n){return JSON.stringify(n)}(t)}catch{return t}}function P(t="Unexpected state"){const e=`FIRESTORE (${Yt}) INTERNAL ASSERTION FAILED: `+t;throw ze(e),new Error(e)}function $(t,e){t||P()}function L(t,e){return t}const g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class R extends Ge{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class nt{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}class Tl{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ep{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(de.UNAUTHENTICATED))}shutdown(){}}class tp{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class np{constructor(e){this.t=e,this.currentUser=de.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){let r=this.i;const i=c=>this.i!==r?(r=this.i,n(c)):Promise.resolve();let s=new nt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new nt,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const c=s;e.enqueueRetryable(async()=>{await c.promise,await i(this.currentUser)})},a=c=>{T("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?a(c):(T("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new nt)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(T("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?($(typeof r.accessToken=="string"),new Tl(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return $(e===null||typeof e=="string"),new de(e)}}class rp{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=de.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class ip{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new rp(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(de.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class sp{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class op{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){const r=s=>{s.error!=null&&T("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,T("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{T("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):T("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?($(typeof n.token=="string"),this.R=n.token,new sp(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function ap(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class wl{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=ap(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<n&&(r+=e.charAt(i[s]%e.length))}return r}}function B(t,e){return t<e?-1:t>e?1:0}function qt(t,e,n){return t.length===e.length&&t.every((r,i)=>n(r,e[i]))}class te{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new R(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new R(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new R(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new R(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return te.fromMillis(Date.now())}static fromDate(e){return te.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new te(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?B(this.nanoseconds,e.nanoseconds):B(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class D{constructor(e){this.timestamp=e}static fromTimestamp(e){return new D(e)}static min(){return new D(new te(0,0))}static max(){return new D(new te(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Sn{constructor(e,n,r){n===void 0?n=0:n>e.length&&P(),r===void 0?r=e.length-n:r>e.length-n&&P(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Sn.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Sn?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const s=e.get(i),o=n.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class H extends Sn{construct(e,n,r){return new H(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new R(g.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(i=>i.length>0))}return new H(n)}static emptyPath(){return new H([])}}const cp=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ce extends Sn{construct(e,n,r){return new ce(e,n,r)}static isValidIdentifier(e){return cp.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ce.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new ce(["__name__"])}static fromServerFormat(e){const n=[];let r="",i=0;const s=()=>{if(r.length===0)throw new R(g.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if(a==="\\"){if(i+1===e.length)throw new R(g.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new R(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new R(g.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ce(n)}static emptyPath(){return new ce([])}}class C{constructor(e){this.path=e}static fromPath(e){return new C(H.fromString(e))}static fromName(e){return new C(H.fromString(e).popFirst(5))}static empty(){return new C(H.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&H.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return H.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new C(new H(e.slice()))}}function lp(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=D.fromTimestamp(r===1e9?new te(n+1,0):new te(n,r));return new it(i,C.empty(),e)}function up(t){return new it(t.readTime,t.key,-1)}class it{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new it(D.min(),C.empty(),-1)}static max(){return new it(D.max(),C.empty(),-1)}}function hp(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=C.comparator(t.documentKey,e.documentKey),n!==0?n:B(t.largestBatchId,e.largestBatchId))}const dp="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class fp{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function Hn(t){if(t.code!==g.FAILED_PRECONDITION||t.message!==dp)throw t;T("LocalStore","Unexpectedly lost primary lease")}class m{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&P(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new m((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(n,s).next(r,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof m?n:m.resolve(n)}catch(n){return m.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):m.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):m.reject(n)}static resolve(e){return new m((n,r)=>{n(e)})}static reject(e){return new m((n,r)=>{r(e)})}static waitFor(e){return new m((n,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&n()},c=>r(c))}),o=!0,s===i&&n()})}static or(e){let n=m.resolve(!1);for(const r of e)n=n.next(i=>i?m.resolve(i):r());return n}static forEach(e,n){const r=[];return e.forEach((i,s)=>{r.push(n.call(this,i,s))}),this.waitFor(r)}static mapArray(e,n){return new m((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let c=0;c<s;c++){const l=c;n(e[l]).next(u=>{o[l]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,n){return new m((r,i)=>{const s=()=>{e()===!0?n().next(()=>{s()},i):r()};s()})}}function Wn(t){return t.name==="IndexedDbTransactionError"}class Qs{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.se(r),this.oe=r=>n.writeSequenceNumber(r))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.oe&&this.oe(e),e}}Qs._e=-1;function ci(t){return t==null}function Nr(t){return t===0&&1/t==-1/0}function pp(t){return typeof t=="number"&&Number.isInteger(t)&&!Nr(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function ra(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Zt(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Al(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class W{constructor(e,n){this.comparator=e,this.root=n||se.EMPTY}insert(e,n){return new W(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,se.BLACK,null,null))}remove(e){return new W(this.comparator,this.root.remove(e,this.comparator).copy(null,null,se.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new or(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new or(this.root,e,this.comparator,!1)}getReverseIterator(){return new or(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new or(this.root,e,this.comparator,!0)}}class or{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=n?r(e.key,n):1,n&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class se{constructor(e,n,r,i,s){this.key=e,this.value=n,this.color=r??se.RED,this.left=i??se.EMPTY,this.right=s??se.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,s){return new se(e??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,n,r),null):s===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return se.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return se.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,se.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,se.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw P();const e=this.left.check();if(e!==this.right.check())throw P();return e+(this.isRed()?0:1)}}se.EMPTY=null,se.RED=!0,se.BLACK=!1;se.EMPTY=new class{constructor(){this.size=0}get key(){throw P()}get value(){throw P()}get color(){throw P()}get left(){throw P()}get right(){throw P()}copy(e,n,r,i,s){return this}insert(e,n,r){return new se(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ue{constructor(e){this.comparator=e,this.data=new W(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new ia(this.data.getIterator())}getIteratorFrom(e){return new ia(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof ue)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new ue(this.comparator);return n.data=e,n}}class ia{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ce{constructor(e){this.fields=e,e.sort(ce.comparator)}static empty(){return new Ce([])}unionWith(e){let n=new ue(ce.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Ce(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return qt(this.fields,e.fields,(n,r)=>n.isEqual(r))}}class Rl extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class _e{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Rl("Invalid base64 string: "+s):s}}(e);return new _e(n)}static fromUint8Array(e){const n=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new _e(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return B(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}_e.EMPTY_BYTE_STRING=new _e("");const mp=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function st(t){if($(!!t),typeof t=="string"){let e=0;const n=mp.exec(t);if($(!!n),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:J(t.seconds),nanos:J(t.nanos)}}function J(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function vt(t){return typeof t=="string"?_e.fromBase64String(t):_e.fromUint8Array(t)}function Xs(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function Js(t){const e=t.mapValue.fields.__previous_value__;return Xs(e)?Js(e):e}function Cn(t){const e=st(t.mapValue.fields.__local_write_time__.timestampValue);return new te(e.seconds,e.nanos)}class gp{constructor(e,n,r,i,s,o,a,c,l){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=l}}class bn{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new bn("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof bn&&e.projectId===this.projectId&&e.database===this.database}}const ar={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Et(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Xs(t)?4:_p(t)?9007199254740991:10:P()}function xe(t,e){if(t===e)return!0;const n=Et(t);if(n!==Et(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Cn(t).isEqual(Cn(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=st(i.timestampValue),a=st(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(i,s){return vt(i.bytesValue).isEqual(vt(s.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(i,s){return J(i.geoPointValue.latitude)===J(s.geoPointValue.latitude)&&J(i.geoPointValue.longitude)===J(s.geoPointValue.longitude)}(t,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return J(i.integerValue)===J(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=J(i.doubleValue),a=J(s.doubleValue);return o===a?Nr(o)===Nr(a):isNaN(o)&&isNaN(a)}return!1}(t,e);case 9:return qt(t.arrayValue.values||[],e.arrayValue.values||[],xe);case 10:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(ra(o)!==ra(a))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!xe(o[c],a[c])))return!1;return!0}(t,e);default:return P()}}function Pn(t,e){return(t.values||[]).find(n=>xe(n,e))!==void 0}function jt(t,e){if(t===e)return 0;const n=Et(t),r=Et(e);if(n!==r)return B(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return B(t.booleanValue,e.booleanValue);case 2:return function(s,o){const a=J(s.integerValue||s.doubleValue),c=J(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(t,e);case 3:return sa(t.timestampValue,e.timestampValue);case 4:return sa(Cn(t),Cn(e));case 5:return B(t.stringValue,e.stringValue);case 6:return function(s,o){const a=vt(s),c=vt(o);return a.compareTo(c)}(t.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),c=o.split("/");for(let l=0;l<a.length&&l<c.length;l++){const u=B(a[l],c[l]);if(u!==0)return u}return B(a.length,c.length)}(t.referenceValue,e.referenceValue);case 8:return function(s,o){const a=B(J(s.latitude),J(o.latitude));return a!==0?a:B(J(s.longitude),J(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(s,o){const a=s.values||[],c=o.values||[];for(let l=0;l<a.length&&l<c.length;++l){const u=jt(a[l],c[l]);if(u)return u}return B(a.length,c.length)}(t.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===ar.mapValue&&o===ar.mapValue)return 0;if(s===ar.mapValue)return 1;if(o===ar.mapValue)return-1;const a=s.fields||{},c=Object.keys(a),l=o.fields||{},u=Object.keys(l);c.sort(),u.sort();for(let f=0;f<c.length&&f<u.length;++f){const p=B(c[f],u[f]);if(p!==0)return p;const _=jt(a[c[f]],l[u[f]]);if(_!==0)return _}return B(c.length,u.length)}(t.mapValue,e.mapValue);default:throw P()}}function sa(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return B(t,e);const n=st(t),r=st(e),i=B(n.seconds,r.seconds);return i!==0?i:B(n.nanos,r.nanos)}function $t(t){return ls(t)}function ls(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=st(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return vt(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return C.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",i=!0;for(const s of n.values||[])i?i=!1:r+=",",r+=ls(s);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${ls(n.fields[o])}`;return i+"}"}(t.mapValue):P()}function us(t){return!!t&&"integerValue"in t}function Ys(t){return!!t&&"arrayValue"in t}function oa(t){return!!t&&"nullValue"in t}function aa(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function fr(t){return!!t&&"mapValue"in t}function dn(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Zt(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=dn(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=dn(t.arrayValue.values[n]);return e}return Object.assign({},t)}function _p(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}class we{constructor(e){this.value=e}static empty(){return new we({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!fr(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=dn(n)}setAll(e){let n=ce.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){const c=this.getFieldsMap(n);this.applyChanges(c,r,i),r={},i=[],n=a.popLast()}o?r[a.lastSegment()]=dn(o):i.push(a.lastSegment())});const s=this.getFieldsMap(n);this.applyChanges(s,r,i)}delete(e){const n=this.field(e.popLast());fr(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return xe(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];fr(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){Zt(n,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new we(dn(this.value))}}function Sl(t){const e=[];return Zt(t.fields,(n,r)=>{const i=new ce([n]);if(fr(r)){const s=Sl(r.mapValue).fields;if(s.length===0)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new Ce(e)}class fe{constructor(e,n,r,i,s,o,a){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new fe(e,0,D.min(),D.min(),D.min(),we.empty(),0)}static newFoundDocument(e,n,r,i){return new fe(e,1,n,D.min(),r,i,0)}static newNoDocument(e,n){return new fe(e,2,n,D.min(),D.min(),we.empty(),0)}static newUnknownDocument(e,n){return new fe(e,3,n,D.min(),D.min(),we.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(D.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=we.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=we.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=D.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof fe&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new fe(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Dr{constructor(e,n){this.position=e,this.inclusive=n}}function ca(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(s.field.isKeyField()?r=C.comparator(C.fromName(o.referenceValue),n.key):r=jt(o,n.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function la(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!xe(t.position[n],e.position[n]))return!1;return!0}class Vr{constructor(e,n="asc"){this.field=e,this.dir=n}}function yp(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class Cl{}class ee extends Cl{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new Ep(e,n,r):n==="array-contains"?new wp(e,r):n==="in"?new Ap(e,r):n==="not-in"?new Rp(e,r):n==="array-contains-any"?new Sp(e,r):new ee(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new Ip(e,r):new Tp(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(jt(n,this.value)):n!==null&&Et(this.value)===Et(n)&&this.matchesComparison(jt(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return P()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Fe extends Cl{constructor(e,n){super(),this.filters=e,this.op=n,this.ue=null}static create(e,n){return new Fe(e,n)}matches(e){return bl(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function bl(t){return t.op==="and"}function Pl(t){return vp(t)&&bl(t)}function vp(t){for(const e of t.filters)if(e instanceof Fe)return!1;return!0}function hs(t){if(t instanceof ee)return t.field.canonicalString()+t.op.toString()+$t(t.value);if(Pl(t))return t.filters.map(e=>hs(e)).join(",");{const e=t.filters.map(n=>hs(n)).join(",");return`${t.op}(${e})`}}function kl(t,e){return t instanceof ee?function(r,i){return i instanceof ee&&r.op===i.op&&r.field.isEqual(i.field)&&xe(r.value,i.value)}(t,e):t instanceof Fe?function(r,i){return i instanceof Fe&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&kl(o,i.filters[a]),!0):!1}(t,e):void P()}function Nl(t){return t instanceof ee?function(n){return`${n.field.canonicalString()} ${n.op} ${$t(n.value)}`}(t):t instanceof Fe?function(n){return n.op.toString()+" {"+n.getFilters().map(Nl).join(" ,")+"}"}(t):"Filter"}class Ep extends ee{constructor(e,n,r){super(e,n,r),this.key=C.fromName(r.referenceValue)}matches(e){const n=C.comparator(e.key,this.key);return this.matchesComparison(n)}}class Ip extends ee{constructor(e,n){super(e,"in",n),this.keys=Dl("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class Tp extends ee{constructor(e,n){super(e,"not-in",n),this.keys=Dl("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function Dl(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>C.fromName(r.referenceValue))}class wp extends ee{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return Ys(n)&&Pn(n.arrayValue,this.value)}}class Ap extends ee{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Pn(this.value.arrayValue,n)}}class Rp extends ee{constructor(e,n){super(e,"not-in",n)}matches(e){if(Pn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!Pn(this.value.arrayValue,n)}}class Sp extends ee{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!Ys(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>Pn(this.value.arrayValue,r))}}class Cp{constructor(e,n=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}}function ua(t,e=null,n=[],r=[],i=null,s=null,o=null){return new Cp(t,e,n,r,i,s,o)}function Zs(t){const e=L(t);if(e.ce===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>hs(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),ci(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>$t(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>$t(r)).join(",")),e.ce=n}return e.ce}function eo(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!yp(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!kl(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!la(t.startAt,e.startAt)&&la(t.endAt,e.endAt)}function ds(t){return C.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class li{constructor(e,n=null,r=[],i=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function bp(t,e,n,r,i,s,o,a){return new li(t,e,n,r,i,s,o,a)}function Vl(t){return new li(t)}function ha(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function Pp(t){return t.collectionGroup!==null}function fn(t){const e=L(t);if(e.le===null){e.le=[];const n=new Set;for(const s of e.explicitOrderBy)e.le.push(s),n.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new ue(ce.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(l=>{l.isInequality()&&(a=a.add(l.field))})}),a})(e).forEach(s=>{n.has(s.canonicalString())||s.isKeyField()||e.le.push(new Vr(s,r))}),n.has(ce.keyField().canonicalString())||e.le.push(new Vr(ce.keyField(),r))}return e.le}function De(t){const e=L(t);return e.he||(e.he=kp(e,fn(t))),e.he}function kp(t,e){if(t.limitType==="F")return ua(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(i=>{const s=i.dir==="desc"?"asc":"desc";return new Vr(i.field,s)});const n=t.endAt?new Dr(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Dr(t.startAt.position,t.startAt.inclusive):null;return ua(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function fs(t,e,n){return new li(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function ui(t,e){return eo(De(t),De(e))&&t.limitType===e.limitType}function Ol(t){return`${Zs(De(t))}|lt:${t.limitType}`}function Ct(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(i=>Nl(i)).join(", ")}]`),ci(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(i=>$t(i)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(i=>$t(i)).join(",")),`Target(${r})`}(De(t))}; limitType=${t.limitType})`}function hi(t,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):C.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(t,e)&&function(r,i){for(const s of fn(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(t,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(t,e)&&function(r,i){return!(r.startAt&&!function(o,a,c){const l=ca(o,a,c);return o.inclusive?l<=0:l<0}(r.startAt,fn(r),i)||r.endAt&&!function(o,a,c){const l=ca(o,a,c);return o.inclusive?l>=0:l>0}(r.endAt,fn(r),i))}(t,e)}function Np(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Ll(t){return(e,n)=>{let r=!1;for(const i of fn(t)){const s=Dp(i,e,n);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function Dp(t,e,n){const r=t.field.isKeyField()?C.comparator(e.key,n.key):function(s,o,a){const c=o.data.field(s),l=a.data.field(s);return c!==null&&l!==null?jt(c,l):P()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return P()}}class en{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Zt(this.inner,(n,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return Al(this.inner)}size(){return this.innerSize}}const Vp=new W(C.comparator);function He(){return Vp}const Ml=new W(C.comparator);function ln(...t){let e=Ml;for(const n of t)e=e.insert(n.key,n);return e}function xl(t){let e=Ml;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function dt(){return pn()}function Fl(){return pn()}function pn(){return new en(t=>t.toString(),(t,e)=>t.isEqual(e))}const Op=new W(C.comparator),Lp=new ue(C.comparator);function M(...t){let e=Lp;for(const n of t)e=e.add(n);return e}const Mp=new ue(B);function xp(){return Mp}function Ul(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Nr(e)?"-0":e}}function Bl(t){return{integerValue:""+t}}function Fp(t,e){return pp(e)?Bl(e):Ul(t,e)}class di{constructor(){this._=void 0}}function Up(t,e,n){return t instanceof Or?function(i,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Xs(s)&&(s=Js(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(n,e):t instanceof kn?jl(t,e):t instanceof Nn?$l(t,e):function(i,s){const o=ql(i,s),a=da(o)+da(i.Ie);return us(o)&&us(i.Ie)?Bl(a):Ul(i.serializer,a)}(t,e)}function Bp(t,e,n){return t instanceof kn?jl(t,e):t instanceof Nn?$l(t,e):n}function ql(t,e){return t instanceof Lr?function(r){return us(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}class Or extends di{}class kn extends di{constructor(e){super(),this.elements=e}}function jl(t,e){const n=zl(e);for(const r of t.elements)n.some(i=>xe(i,r))||n.push(r);return{arrayValue:{values:n}}}class Nn extends di{constructor(e){super(),this.elements=e}}function $l(t,e){let n=zl(e);for(const r of t.elements)n=n.filter(i=>!xe(i,r));return{arrayValue:{values:n}}}class Lr extends di{constructor(e,n){super(),this.serializer=e,this.Ie=n}}function da(t){return J(t.integerValue||t.doubleValue)}function zl(t){return Ys(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function qp(t,e){return t.field.isEqual(e.field)&&function(r,i){return r instanceof kn&&i instanceof kn||r instanceof Nn&&i instanceof Nn?qt(r.elements,i.elements,xe):r instanceof Lr&&i instanceof Lr?xe(r.Ie,i.Ie):r instanceof Or&&i instanceof Or}(t.transform,e.transform)}class jp{constructor(e,n){this.version=e,this.transformResults=n}}class Ve{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new Ve}static exists(e){return new Ve(void 0,e)}static updateTime(e){return new Ve(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function pr(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class fi{}function Hl(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new to(t.key,Ve.none()):new Gn(t.key,t.data,Ve.none());{const n=t.data,r=we.empty();let i=new ue(ce.comparator);for(let s of e.fields)if(!i.has(s)){let o=n.field(s);o===null&&s.length>1&&(s=s.popLast(),o=n.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new At(t.key,r,new Ce(i.toArray()),Ve.none())}}function $p(t,e,n){t instanceof Gn?function(i,s,o){const a=i.value.clone(),c=pa(i.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(t,e,n):t instanceof At?function(i,s,o){if(!pr(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=pa(i.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(Wl(i)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(t,e,n):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function mn(t,e,n,r){return t instanceof Gn?function(s,o,a,c){if(!pr(s.precondition,o))return a;const l=s.value.clone(),u=ma(s.fieldTransforms,c,o);return l.setAll(u),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null}(t,e,n,r):t instanceof At?function(s,o,a,c){if(!pr(s.precondition,o))return a;const l=ma(s.fieldTransforms,c,o),u=o.data;return u.setAll(Wl(s)),u.setAll(l),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(f=>f.field))}(t,e,n,r):function(s,o,a){return pr(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(t,e,n)}function zp(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),s=ql(r.transform,i||null);s!=null&&(n===null&&(n=we.empty()),n.set(r.field,s))}return n||null}function fa(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&qt(r,i,(s,o)=>qp(s,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Gn extends fi{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class At extends fi{constructor(e,n,r,i,s=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Wl(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function pa(t,e,n){const r=new Map;$(t.length===n.length);for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,Bp(o,a,n[i]))}return r}function ma(t,e,n){const r=new Map;for(const i of t){const s=i.transform,o=n.data.field(i.field);r.set(i.field,Up(s,o,e))}return r}class to extends fi{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Hp extends fi{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Wp{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&$p(s,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=mn(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=mn(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=Fl();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=n.has(i.key)?null:a;const c=Hl(o,a);c!==null&&r.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(D.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),M())}isEqual(e){return this.batchId===e.batchId&&qt(this.mutations,e.mutations,(n,r)=>fa(n,r))&&qt(this.baseMutations,e.baseMutations,(n,r)=>fa(n,r))}}class no{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){$(e.mutations.length===r.length);let i=function(){return Op}();const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new no(e,n,r,i)}}class Gp{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class Kp{constructor(e,n){this.count=e,this.unchangedNames=n}}var X,F;function Qp(t){switch(t){default:return P();case g.CANCELLED:case g.UNKNOWN:case g.DEADLINE_EXCEEDED:case g.RESOURCE_EXHAUSTED:case g.INTERNAL:case g.UNAVAILABLE:case g.UNAUTHENTICATED:return!1;case g.INVALID_ARGUMENT:case g.NOT_FOUND:case g.ALREADY_EXISTS:case g.PERMISSION_DENIED:case g.FAILED_PRECONDITION:case g.ABORTED:case g.OUT_OF_RANGE:case g.UNIMPLEMENTED:case g.DATA_LOSS:return!0}}function Gl(t){if(t===void 0)return ze("GRPC error has no .code"),g.UNKNOWN;switch(t){case X.OK:return g.OK;case X.CANCELLED:return g.CANCELLED;case X.UNKNOWN:return g.UNKNOWN;case X.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case X.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case X.INTERNAL:return g.INTERNAL;case X.UNAVAILABLE:return g.UNAVAILABLE;case X.UNAUTHENTICATED:return g.UNAUTHENTICATED;case X.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case X.NOT_FOUND:return g.NOT_FOUND;case X.ALREADY_EXISTS:return g.ALREADY_EXISTS;case X.PERMISSION_DENIED:return g.PERMISSION_DENIED;case X.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case X.ABORTED:return g.ABORTED;case X.OUT_OF_RANGE:return g.OUT_OF_RANGE;case X.UNIMPLEMENTED:return g.UNIMPLEMENTED;case X.DATA_LOSS:return g.DATA_LOSS;default:return P()}}(F=X||(X={}))[F.OK=0]="OK",F[F.CANCELLED=1]="CANCELLED",F[F.UNKNOWN=2]="UNKNOWN",F[F.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",F[F.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",F[F.NOT_FOUND=5]="NOT_FOUND",F[F.ALREADY_EXISTS=6]="ALREADY_EXISTS",F[F.PERMISSION_DENIED=7]="PERMISSION_DENIED",F[F.UNAUTHENTICATED=16]="UNAUTHENTICATED",F[F.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",F[F.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",F[F.ABORTED=10]="ABORTED",F[F.OUT_OF_RANGE=11]="OUT_OF_RANGE",F[F.UNIMPLEMENTED=12]="UNIMPLEMENTED",F[F.INTERNAL=13]="INTERNAL",F[F.UNAVAILABLE=14]="UNAVAILABLE",F[F.DATA_LOSS=15]="DATA_LOSS";function Xp(){return new TextEncoder}const Jp=new Dt([4294967295,4294967295],0);function ga(t){const e=Xp().encode(t),n=new Zf;return n.update(e),new Uint8Array(n.digest())}function _a(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Dt([n,r],0),new Dt([i,s],0)]}class ro{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new un(`Invalid padding: ${n}`);if(r<0)throw new un(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new un(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new un(`Invalid padding when bitmap length is 0: ${n}`);this.Te=8*e.length-n,this.Ee=Dt.fromNumber(this.Te)}de(e,n,r){let i=e.add(n.multiply(Dt.fromNumber(r)));return i.compare(Jp)===1&&(i=new Dt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;const n=ga(e),[r,i]=_a(n);for(let s=0;s<this.hashCount;s++){const o=this.de(r,i,s);if(!this.Ae(o))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new ro(s,i,n);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Te===0)return;const n=ga(e),[r,i]=_a(n);for(let s=0;s<this.hashCount;s++){const o=this.de(r,i,s);this.Re(o)}}Re(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class un extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class pi{constructor(e,n,r,i,s){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,Kn.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new pi(D.min(),i,new W(B),He(),M())}}class Kn{constructor(e,n,r,i,s){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new Kn(r,n,M(),M(),M())}}class mr{constructor(e,n,r,i){this.Ve=e,this.removedTargetIds=n,this.key=r,this.me=i}}class Kl{constructor(e,n){this.targetId=e,this.fe=n}}class Ql{constructor(e,n,r=_e.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class ya{constructor(){this.ge=0,this.pe=Ea(),this.ye=_e.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=M(),n=M(),r=M();return this.pe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:P()}}),new Kn(this.ye,this.we,e,n,r)}Fe(){this.Se=!1,this.pe=Ea()}Me(e,n){this.Se=!0,this.pe=this.pe.insert(e,n)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,$(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class Yp{constructor(e){this.Le=e,this.ke=new Map,this.qe=He(),this.Qe=va(),this.Ke=new W(B)}$e(e){for(const n of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(n,e.me):this.We(n,e.key,e.me);for(const n of e.removedTargetIds)this.We(n,e.key,e.me)}Ge(e){this.forEachTarget(e,n=>{const r=this.ze(n);switch(e.state){case 0:this.je(n)&&r.Ce(e.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(e.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(n);break;case 3:this.je(n)&&(r.Be(),r.Ce(e.resumeToken));break;case 4:this.je(n)&&(this.He(n),r.Ce(e.resumeToken));break;default:P()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ke.forEach((r,i)=>{this.je(i)&&n(i)})}Je(e){const n=e.targetId,r=e.fe.count,i=this.Ye(n);if(i){const s=i.target;if(ds(s))if(r===0){const o=new C(s.path);this.We(n,o,fe.newNoDocument(o,D.min()))}else $(r===1);else{const o=this.Ze(n);if(o!==r){const a=this.Xe(e),c=a?this.et(a,e,o):1;if(c!==0){this.He(n);const l=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(n,l)}}}}}Xe(e){const n=e.fe.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=n;let o,a;try{o=vt(r).toUint8Array()}catch(c){if(c instanceof Rl)return Bt("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new ro(o,i,s)}catch(c){return Bt(c instanceof un?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Te===0?null:a}et(e,n,r){return n.fe.count===r-this.rt(e,n.targetId)?0:2}rt(e,n){const r=this.Le.getRemoteKeysForTarget(n);let i=0;return r.forEach(s=>{const o=this.Le.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.We(n,s,null),i++)}),i}it(e){const n=new Map;this.ke.forEach((s,o)=>{const a=this.Ye(o);if(a){if(s.current&&ds(a.target)){const c=new C(a.target.path);this.qe.get(c)!==null||this.st(o,c)||this.We(o,c,fe.newNoDocument(c,e))}s.De&&(n.set(o,s.ve()),s.Fe())}});let r=M();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{const l=this.Ye(c);return!l||l.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(e));const i=new pi(e,n,this.Ke,this.qe,r);return this.qe=He(),this.Qe=va(),this.Ke=new W(B),i}Ue(e,n){if(!this.je(e))return;const r=this.st(e,n.key)?2:0;this.ze(e).Me(n.key,r),this.qe=this.qe.insert(n.key,n),this.Qe=this.Qe.insert(n.key,this.ot(n.key).add(e))}We(e,n,r){if(!this.je(e))return;const i=this.ze(e);this.st(e,n)?i.Me(n,1):i.xe(n),this.Qe=this.Qe.insert(n,this.ot(n).delete(e)),r&&(this.qe=this.qe.insert(n,r))}removeTarget(e){this.ke.delete(e)}Ze(e){const n=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let n=this.ke.get(e);return n||(n=new ya,this.ke.set(e,n)),n}ot(e){let n=this.Qe.get(e);return n||(n=new ue(B),this.Qe=this.Qe.insert(e,n)),n}je(e){const n=this.Ye(e)!==null;return n||T("WatchChangeAggregator","Detected inactive target",e),n}Ye(e){const n=this.ke.get(e);return n&&n.be?null:this.Le._t(e)}He(e){this.ke.set(e,new ya),this.Le.getRemoteKeysForTarget(e).forEach(n=>{this.We(e,n,null)})}st(e,n){return this.Le.getRemoteKeysForTarget(e).has(n)}}function va(){return new W(C.comparator)}function Ea(){return new W(C.comparator)}const Zp=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),em=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),tm=(()=>({and:"AND",or:"OR"}))();class nm{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function ps(t,e){return t.useProto3Json||ci(e)?e:{value:e}}function Mr(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Xl(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function rm(t,e){return Mr(t,e.toTimestamp())}function Oe(t){return $(!!t),D.fromTimestamp(function(n){const r=st(n);return new te(r.seconds,r.nanos)}(t))}function io(t,e){return function(r){return new H(["projects",r.projectId,"databases",r.database])}(t).child("documents").child(e).canonicalString()}function Jl(t){const e=H.fromString(t);return $(tu(e)),e}function ms(t,e){return io(t.databaseId,e.path)}function Bi(t,e){const n=Jl(e);if(n.get(1)!==t.databaseId.projectId)throw new R(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new R(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new C(Yl(n))}function gs(t,e){return io(t.databaseId,e)}function im(t){const e=Jl(t);return e.length===4?H.emptyPath():Yl(e)}function _s(t){return new H(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Yl(t){return $(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function Ia(t,e,n){return{name:ms(t,e),fields:n.value.mapValue.fields}}function sm(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:P()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(l,u){return l.useProto3Json?($(u===void 0||typeof u=="string"),_e.fromBase64String(u||"")):($(u===void 0||u instanceof Uint8Array),_e.fromUint8Array(u||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(l){const u=l.code===void 0?g.UNKNOWN:Gl(l.code);return new R(u,l.message||"")}(o);n=new Ql(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Bi(t,r.document.name),s=Oe(r.document.updateTime),o=r.document.createTime?Oe(r.document.createTime):D.min(),a=new we({mapValue:{fields:r.document.fields}}),c=fe.newFoundDocument(i,s,o,a),l=r.targetIds||[],u=r.removedTargetIds||[];n=new mr(l,u,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Bi(t,r.document),s=r.readTime?Oe(r.readTime):D.min(),o=fe.newNoDocument(i,s),a=r.removedTargetIds||[];n=new mr([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Bi(t,r.document),s=r.removedTargetIds||[];n=new mr([],s,i,null)}else{if(!("filter"in e))return P();{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,o=new Kp(i,s),a=r.targetId;n=new Kl(a,o)}}return n}function om(t,e){let n;if(e instanceof Gn)n={update:Ia(t,e.key,e.value)};else if(e instanceof to)n={delete:ms(t,e.key)};else if(e instanceof At)n={update:Ia(t,e.key,e.data),updateMask:mm(e.fieldMask)};else{if(!(e instanceof Hp))return P();n={verify:ms(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(s,o){const a=o.transform;if(a instanceof Or)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof kn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Nn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Lr)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw P()}(0,r))),e.precondition.isNone||(n.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:rm(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:P()}(t,e.precondition)),n}function am(t,e){return t&&t.length>0?($(e!==void 0),t.map(n=>function(i,s){let o=i.updateTime?Oe(i.updateTime):Oe(s);return o.isEqual(D.min())&&(o=Oe(s)),new jp(o,i.transformResults||[])}(n,e))):[]}function cm(t,e){return{documents:[gs(t,e.path)]}}function lm(t,e){const n={structuredQuery:{}},r=e.path;e.collectionGroup!==null?(n.parent=gs(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=gs(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(c){if(c.length!==0)return eu(Fe.create(c,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const s=function(c){if(c.length!==0)return c.map(l=>function(f){return{field:bt(f.field),direction:dm(f.dir)}}(l))}(e.orderBy);s&&(n.structuredQuery.orderBy=s);const o=ps(t,e.limit);return o!==null&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),n}function um(t){let e=im(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){$(r===1);const u=n.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];n.where&&(s=function(f){const p=Zl(f);return p instanceof Fe&&Pl(p)?p.getFilters():[p]}(n.where));let o=[];n.orderBy&&(o=function(f){return f.map(p=>function(O){return new Vr(Pt(O.field),function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(O.direction))}(p))}(n.orderBy));let a=null;n.limit&&(a=function(f){let p;return p=typeof f=="object"?f.value:f,ci(p)?null:p}(n.limit));let c=null;n.startAt&&(c=function(f){const p=!!f.before,_=f.values||[];return new Dr(_,p)}(n.startAt));let l=null;return n.endAt&&(l=function(f){const p=!f.before,_=f.values||[];return new Dr(_,p)}(n.endAt)),bp(e,i,o,s,a,"F",c,l)}function hm(t,e){const n=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return P()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function Zl(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Pt(n.unaryFilter.field);return ee.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Pt(n.unaryFilter.field);return ee.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Pt(n.unaryFilter.field);return ee.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Pt(n.unaryFilter.field);return ee.create(o,"!=",{nullValue:"NULL_VALUE"});default:return P()}}(t):t.fieldFilter!==void 0?function(n){return ee.create(Pt(n.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return P()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return Fe.create(n.compositeFilter.filters.map(r=>Zl(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return P()}}(n.compositeFilter.op))}(t):P()}function dm(t){return Zp[t]}function fm(t){return em[t]}function pm(t){return tm[t]}function bt(t){return{fieldPath:t.canonicalString()}}function Pt(t){return ce.fromServerFormat(t.fieldPath)}function eu(t){return t instanceof ee?function(n){if(n.op==="=="){if(aa(n.value))return{unaryFilter:{field:bt(n.field),op:"IS_NAN"}};if(oa(n.value))return{unaryFilter:{field:bt(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(aa(n.value))return{unaryFilter:{field:bt(n.field),op:"IS_NOT_NAN"}};if(oa(n.value))return{unaryFilter:{field:bt(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:bt(n.field),op:fm(n.op),value:n.value}}}(t):t instanceof Fe?function(n){const r=n.getFilters().map(i=>eu(i));return r.length===1?r[0]:{compositeFilter:{op:pm(n.op),filters:r}}}(t):P()}function mm(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function tu(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}class Ye{constructor(e,n,r,i,s=D.min(),o=D.min(),a=_e.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new Ye(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new Ye(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ye(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ye(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class gm{constructor(e){this.ut=e}}function _m(t){const e=um({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?fs(e,e.limit,"L"):e}class ym{constructor(){this.on=new vm}addToCollectionParentIndex(e,n){return this.on.add(n),m.resolve()}getCollectionParents(e,n){return m.resolve(this.on.getEntries(n))}addFieldIndex(e,n){return m.resolve()}deleteFieldIndex(e,n){return m.resolve()}deleteAllFieldIndexes(e){return m.resolve()}createTargetIndexes(e,n){return m.resolve()}getDocumentsMatchingTarget(e,n){return m.resolve(null)}getIndexType(e,n){return m.resolve(0)}getFieldIndexes(e,n){return m.resolve([])}getNextCollectionGroupToUpdate(e){return m.resolve(null)}getMinOffset(e,n){return m.resolve(it.min())}getMinOffsetFromCollectionGroup(e,n){return m.resolve(it.min())}updateCollectionGroup(e,n,r){return m.resolve()}updateIndexEntries(e,n){return m.resolve()}}class vm{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new ue(H.comparator),s=!i.has(r);return this.index[n]=i.add(r),s}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ue(H.comparator)).toArray()}}class zt{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new zt(0)}static Nn(){return new zt(-1)}}class Em{constructor(){this.changes=new en(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,fe.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?m.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Im{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}class Tm{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,n))).next(i=>(r!==null&&mn(r.mutation,i,Ce.empty(),te.now()),i))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,M()).next(()=>r))}getLocalViewOfDocuments(e,n,r=M()){const i=dt();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,r).next(s=>{let o=ln();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const r=dt();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,M()))}populateOverlays(e,n,r){const i=[];return r.forEach(s=>{n.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,r,i){let s=He();const o=pn(),a=function(){return pn()}();return n.forEach((c,l)=>{const u=r.get(l.key);i.has(l.key)&&(u===void 0||u.mutation instanceof At)?s=s.insert(l.key,l):u!==void 0?(o.set(l.key,u.mutation.getFieldMask()),mn(u.mutation,l,u.mutation.getFieldMask(),te.now())):o.set(l.key,Ce.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((l,u)=>o.set(l,u)),n.forEach((l,u)=>{var f;return a.set(l,new Im(u,(f=o.get(l))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,n){const r=pn();let i=new W((o,a)=>o-a),s=M();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const a of o)a.keys().forEach(c=>{const l=n.get(c);if(l===null)return;let u=r.get(c)||Ce.empty();u=a.applyToLocalView(l,u),r.set(c,u);const f=(i.get(a.batchId)||M()).add(c);i=i.insert(a.batchId,f)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const c=a.getNext(),l=c.key,u=c.value,f=Fl();u.forEach(p=>{if(!s.has(p)){const _=Hl(n.get(p),r.get(p));_!==null&&f.set(p,_),s=s.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,l,f))}return m.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,i){return function(o){return C.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):Pp(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-s.size):m.resolve(dt());let a=-1,c=s;return o.next(l=>m.forEach(l,(u,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),s.get(u)?m.resolve():this.remoteDocumentCache.getEntry(e,u).next(p=>{c=c.insert(u,p)}))).next(()=>this.populateOverlays(e,l,s)).next(()=>this.computeViews(e,c,l,M())).next(u=>({batchId:a,changes:xl(u)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new C(n)).next(r=>{let i=ln();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const s=n.collectionGroup;let o=ln();return this.indexManager.getCollectionParents(e,s).next(a=>m.forEach(a,c=>{const l=function(f,p){return new li(p,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(n,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,l,r,i).next(u=>{u.forEach((f,p)=>{o=o.insert(f,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,s,i))).next(o=>{s.forEach((c,l)=>{const u=l.getKey();o.get(u)===null&&(o=o.insert(u,fe.newInvalidDocument(u)))});let a=ln();return o.forEach((c,l)=>{const u=s.get(c);u!==void 0&&mn(u.mutation,l,Ce.empty(),te.now()),hi(n,l)&&(a=a.insert(c,l))}),a})}}class wm{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,n){return m.resolve(this.ur.get(n))}saveBundleMetadata(e,n){return this.ur.set(n.id,function(i){return{id:i.id,version:i.version,createTime:Oe(i.createTime)}}(n)),m.resolve()}getNamedQuery(e,n){return m.resolve(this.cr.get(n))}saveNamedQuery(e,n){return this.cr.set(n.name,function(i){return{name:i.name,query:_m(i.bundledQuery),readTime:Oe(i.readTime)}}(n)),m.resolve()}}class Am{constructor(){this.overlays=new W(C.comparator),this.lr=new Map}getOverlay(e,n){return m.resolve(this.overlays.get(n))}getOverlays(e,n){const r=dt();return m.forEach(n,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((i,s)=>{this.lt(e,n,s)}),m.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.lr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.lr.delete(r)),m.resolve()}getOverlaysForCollection(e,n,r){const i=dt(),s=n.length+1,o=new C(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const c=a.getNext().value,l=c.getKey();if(!n.isPrefixOf(l.path))break;l.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return m.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let s=new W((l,u)=>l-u);const o=this.overlays.getIterator();for(;o.hasNext();){const l=o.getNext().value;if(l.getKey().getCollectionGroup()===n&&l.largestBatchId>r){let u=s.get(l.largestBatchId);u===null&&(u=dt(),s=s.insert(l.largestBatchId,u)),u.set(l.getKey(),l)}}const a=dt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((l,u)=>a.set(l,u)),!(a.size()>=i)););return m.resolve(a)}lt(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const o=this.lr.get(i.largestBatchId).delete(r.key);this.lr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Gp(n,r));let s=this.lr.get(n);s===void 0&&(s=M(),this.lr.set(n,s)),this.lr.set(n,s.add(r.key))}}class so{constructor(){this.hr=new ue(ne.Pr),this.Ir=new ue(ne.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,n){const r=new ne(e,n);this.hr=this.hr.add(r),this.Ir=this.Ir.add(r)}Er(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.dr(new ne(e,n))}Ar(e,n){e.forEach(r=>this.removeReference(r,n))}Rr(e){const n=new C(new H([])),r=new ne(n,e),i=new ne(n,e+1),s=[];return this.Ir.forEachInRange([r,i],o=>{this.dr(o),s.push(o.key)}),s}Vr(){this.hr.forEach(e=>this.dr(e))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){const n=new C(new H([])),r=new ne(n,e),i=new ne(n,e+1);let s=M();return this.Ir.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const n=new ne(e,0),r=this.hr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class ne{constructor(e,n){this.key=e,this.gr=n}static Pr(e,n){return C.comparator(e.key,n.key)||B(e.gr,n.gr)}static Tr(e,n){return B(e.gr,n.gr)||C.comparator(e.key,n.key)}}class Rm{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.pr=1,this.yr=new ue(ne.Pr)}checkEmpty(e){return m.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const s=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Wp(s,n,r,i);this.mutationQueue.push(o);for(const a of i)this.yr=this.yr.add(new ne(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return m.resolve(o)}lookupMutationBatch(e,n){return m.resolve(this.wr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.Sr(r),s=i<0?0:i;return m.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return m.resolve(this.mutationQueue.length===0?-1:this.pr-1)}getAllMutationBatches(e){return m.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new ne(n,0),i=new ne(n,Number.POSITIVE_INFINITY),s=[];return this.yr.forEachInRange([r,i],o=>{const a=this.wr(o.gr);s.push(a)}),m.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new ue(B);return n.forEach(i=>{const s=new ne(i,0),o=new ne(i,Number.POSITIVE_INFINITY);this.yr.forEachInRange([s,o],a=>{r=r.add(a.gr)})}),m.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let s=r;C.isDocumentKey(s)||(s=s.child(""));const o=new ne(new C(s),0);let a=new ue(B);return this.yr.forEachWhile(c=>{const l=c.key.path;return!!r.isPrefixOf(l)&&(l.length===i&&(a=a.add(c.gr)),!0)},o),m.resolve(this.br(a))}br(e){const n=[];return e.forEach(r=>{const i=this.wr(r);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){$(this.Dr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.yr;return m.forEach(n.mutations,i=>{const s=new ne(i.key,n.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.yr=r})}Fn(e){}containsKey(e,n){const r=new ne(n,0),i=this.yr.firstAfterOrEqual(r);return m.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,m.resolve()}Dr(e,n){return this.Sr(e)}Sr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}wr(e){const n=this.Sr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class Sm{constructor(e){this.Cr=e,this.docs=function(){return new W(C.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),s=i?i.size:0,o=this.Cr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return m.resolve(r?r.document.mutableCopy():fe.newInvalidDocument(n))}getEntries(e,n){let r=He();return n.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():fe.newInvalidDocument(i))}),m.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let s=He();const o=n.path,a=new C(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){const{key:l,value:{document:u}}=c.getNext();if(!o.isPrefixOf(l.path))break;l.path.length>o.length+1||hp(up(u),r)<=0||(i.has(u.key)||hi(n,u))&&(s=s.insert(u.key,u.mutableCopy()))}return m.resolve(s)}getAllFromCollectionGroup(e,n,r,i){P()}vr(e,n){return m.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new Cm(this)}getSize(e){return m.resolve(this.size)}}class Cm extends Em{constructor(e){super(),this._r=e}applyChanges(e){const n=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?n.push(this._r.addEntry(e,i)):this._r.removeEntry(r)}),m.waitFor(n)}getFromCache(e,n){return this._r.getEntry(e,n)}getAllFromCache(e,n){return this._r.getEntries(e,n)}}class bm{constructor(e){this.persistence=e,this.Fr=new en(n=>Zs(n),eo),this.lastRemoteSnapshotVersion=D.min(),this.highestTargetId=0,this.Mr=0,this.Or=new so,this.targetCount=0,this.Nr=zt.On()}forEachTarget(e,n){return this.Fr.forEach((r,i)=>n(i)),m.resolve()}getLastRemoteSnapshotVersion(e){return m.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return m.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),m.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Mr&&(this.Mr=n),m.resolve()}kn(e){this.Fr.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.Nr=new zt(n),this.highestTargetId=n),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,n){return this.kn(n),this.targetCount+=1,m.resolve()}updateTargetData(e,n){return this.kn(n),m.resolve()}removeTargetData(e,n){return this.Fr.delete(n.target),this.Or.Rr(n.targetId),this.targetCount-=1,m.resolve()}removeTargets(e,n,r){let i=0;const s=[];return this.Fr.forEach((o,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.Fr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),m.waitFor(s).next(()=>i)}getTargetCount(e){return m.resolve(this.targetCount)}getTargetData(e,n){const r=this.Fr.get(n)||null;return m.resolve(r)}addMatchingKeys(e,n,r){return this.Or.Er(n,r),m.resolve()}removeMatchingKeys(e,n,r){this.Or.Ar(n,r);const i=this.persistence.referenceDelegate,s=[];return i&&n.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),m.waitFor(s)}removeMatchingKeysForTargetId(e,n){return this.Or.Rr(n),m.resolve()}getMatchingKeysForTargetId(e,n){const r=this.Or.mr(n);return m.resolve(r)}containsKey(e,n){return m.resolve(this.Or.containsKey(n))}}class Pm{constructor(e,n){this.Br={},this.overlays={},this.Lr=new Qs(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new bm(this),this.indexManager=new ym,this.remoteDocumentCache=function(i){return new Sm(i)}(r=>this.referenceDelegate.Qr(r)),this.serializer=new gm(n),this.Kr=new wm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new Am,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.Br[e.toKey()];return r||(r=new Rm(n,this.referenceDelegate),this.Br[e.toKey()]=r),r}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,n,r){T("MemoryPersistence","Starting transaction:",e);const i=new km(this.Lr.next());return this.referenceDelegate.$r(),r(i).next(s=>this.referenceDelegate.Ur(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Wr(e,n){return m.or(Object.values(this.Br).map(r=>()=>r.containsKey(e,n)))}}class km extends fp{constructor(e){super(),this.currentSequenceNumber=e}}class oo{constructor(e){this.persistence=e,this.Gr=new so,this.zr=null}static jr(e){return new oo(e)}get Hr(){if(this.zr)return this.zr;throw P()}addReference(e,n,r){return this.Gr.addReference(r,n),this.Hr.delete(r.toString()),m.resolve()}removeReference(e,n,r){return this.Gr.removeReference(r,n),this.Hr.add(r.toString()),m.resolve()}markPotentiallyOrphaned(e,n){return this.Hr.add(n.toString()),m.resolve()}removeTarget(e,n){this.Gr.Rr(n.targetId).forEach(i=>this.Hr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(s=>this.Hr.add(s.toString()))}).next(()=>r.removeTargetData(e,n))}$r(){this.zr=new Set}Ur(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return m.forEach(this.Hr,r=>{const i=C.fromPath(r);return this.Jr(e,i).next(s=>{s||n.removeEntry(i,D.min())})}).next(()=>(this.zr=null,n.apply(e)))}updateLimboDocument(e,n){return this.Jr(e,n).next(r=>{r?this.Hr.delete(n.toString()):this.Hr.add(n.toString())})}Qr(e){return 0}Jr(e,n){return m.or([()=>m.resolve(this.Gr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Wr(e,n)])}}class ao{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.ki=r,this.qi=i}static Qi(e,n){let r=M(),i=M();for(const s of n.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new ao(e,n.fromCache,r,i)}}class Nm{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Dm{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=8}initialize(e,n){this.Gi=e,this.indexManager=n,this.Ki=!0}getDocumentsMatchingQuery(e,n,r,i){const s={result:null};return this.zi(e,n).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ji(e,n,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new Nm;return this.Hi(e,n,o).next(a=>{if(s.result=a,this.$i)return this.Ji(e,n,o,a.size)})}).next(()=>s.result)}Ji(e,n,r,i){return r.documentReadCount<this.Ui?(on()<=x.DEBUG&&T("QueryEngine","SDK will not create cache indexes for query:",Ct(n),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),m.resolve()):(on()<=x.DEBUG&&T("QueryEngine","Query:",Ct(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Wi*i?(on()<=x.DEBUG&&T("QueryEngine","The SDK decides to create cache indexes for query:",Ct(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,De(n))):m.resolve())}zi(e,n){if(ha(n))return m.resolve(null);let r=De(n);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=fs(n,null,"F"),r=De(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=M(...s);return this.Gi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(c=>{const l=this.Yi(n,a);return this.Zi(n,l,o,c.readTime)?this.zi(e,fs(n,null,"F")):this.Xi(e,l,n,c)}))})))}ji(e,n,r,i){return ha(n)||i.isEqual(D.min())?m.resolve(null):this.Gi.getDocuments(e,r).next(s=>{const o=this.Yi(n,s);return this.Zi(n,o,r,i)?m.resolve(null):(on()<=x.DEBUG&&T("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ct(n)),this.Xi(e,o,n,lp(i,-1)).next(a=>a))})}Yi(e,n){let r=new ue(Ll(e));return n.forEach((i,s)=>{hi(e,s)&&(r=r.add(s))}),r}Zi(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const s=e.limitType==="F"?n.last():n.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Hi(e,n,r){return on()<=x.DEBUG&&T("QueryEngine","Using full collection scan to execute query:",Ct(n)),this.Gi.getDocumentsMatchingQuery(e,n,it.min(),r)}Xi(e,n,r,i){return this.Gi.getDocumentsMatchingQuery(e,r,i).next(s=>(n.forEach(o=>{s=s.insert(o.key,o)}),s))}}class Vm{constructor(e,n,r,i){this.persistence=e,this.es=n,this.serializer=i,this.ts=new W(B),this.ns=new en(s=>Zs(s),eo),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(r)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Tm(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.ts))}}function Om(t,e,n,r){return new Vm(t,e,n,r)}async function nu(t,e){const n=L(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,n.os(e),n.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let c=M();for(const l of i){o.push(l.batchId);for(const u of l.mutations)c=c.add(u.key)}for(const l of s){a.push(l.batchId);for(const u of l.mutations)c=c.add(u.key)}return n.localDocuments.getDocuments(r,c).next(l=>({_s:l,removedBatchIds:o,addedBatchIds:a}))})})}function Lm(t,e){const n=L(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=n.ss.newChangeBuffer({trackRemovals:!0});return function(a,c,l,u){const f=l.batch,p=f.keys();let _=m.resolve();return p.forEach(O=>{_=_.next(()=>u.getEntry(c,O)).next(S=>{const w=l.docVersions.get(O);$(w!==null),S.version.compareTo(w)<0&&(f.applyToRemoteDocument(S,l),S.isValidDocument()&&(S.setReadTime(l.commitVersion),u.addEntry(S)))})}),_.next(()=>a.mutationQueue.removeMutationBatch(c,f))}(n,r,e,s).next(()=>s.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let c=M();for(let l=0;l<a.mutationResults.length;++l)a.mutationResults[l].transformResults.length>0&&(c=c.add(a.batch.mutations[l].key));return c}(e))).next(()=>n.localDocuments.getDocuments(r,i))})}function ru(t){const e=L(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.qr.getLastRemoteSnapshotVersion(n))}function Mm(t,e){const n=L(t),r=e.snapshotVersion;let i=n.ts;return n.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=n.ss.newChangeBuffer({trackRemovals:!0});i=n.ts;const a=[];e.targetChanges.forEach((u,f)=>{const p=i.get(f);if(!p)return;a.push(n.qr.removeMatchingKeys(s,u.removedDocuments,f).next(()=>n.qr.addMatchingKeys(s,u.addedDocuments,f)));let _=p.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(f)!==null?_=_.withResumeToken(_e.EMPTY_BYTE_STRING,D.min()).withLastLimboFreeSnapshotVersion(D.min()):u.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(u.resumeToken,r)),i=i.insert(f,_),function(S,w,q){return S.resumeToken.approximateByteSize()===0||w.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=3e8?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0}(p,_,u)&&a.push(n.qr.updateTargetData(s,_))});let c=He(),l=M();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(xm(s,o,e.documentUpdates).next(u=>{c=u.us,l=u.cs})),!r.isEqual(D.min())){const u=n.qr.getLastRemoteSnapshotVersion(s).next(f=>n.qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return m.waitFor(a).next(()=>o.apply(s)).next(()=>n.localDocuments.getLocalViewOfDocuments(s,c,l)).next(()=>c)}).then(s=>(n.ts=i,s))}function xm(t,e,n){let r=M(),i=M();return n.forEach(s=>r=r.add(s)),e.getEntries(t,r).next(s=>{let o=He();return n.forEach((a,c)=>{const l=s.get(a);c.isFoundDocument()!==l.isFoundDocument()&&(i=i.add(a)),c.isNoDocument()&&c.version.isEqual(D.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!l.isValidDocument()||c.version.compareTo(l.version)>0||c.version.compareTo(l.version)===0&&l.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):T("LocalStore","Ignoring outdated watch update for ",a,". Current version:",l.version," Watch version:",c.version)}),{us:o,cs:i}})}function Fm(t,e){const n=L(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Um(t,e){const n=L(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return n.qr.getTargetData(r,e).next(s=>s?(i=s,m.resolve(i)):n.qr.allocateTargetId(r).next(o=>(i=new Ye(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.qr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=n.ts.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.ts=n.ts.insert(r.targetId,r),n.ns.set(e,r.targetId)),r})}async function ys(t,e,n){const r=L(t),i=r.ts.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!Wn(o))throw o;T("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ts=r.ts.remove(e),r.ns.delete(i.target)}function Ta(t,e,n){const r=L(t);let i=D.min(),s=M();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,l,u){const f=L(c),p=f.ns.get(u);return p!==void 0?m.resolve(f.ts.get(p)):f.qr.getTargetData(l,u)}(r,o,De(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>r.es.getDocumentsMatchingQuery(o,e,n?i:D.min(),n?s:M())).next(a=>(Bm(r,Np(e),a),{documents:a,ls:s})))}function Bm(t,e,n){let r=t.rs.get(e)||D.min();n.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),t.rs.set(e,r)}class wa{constructor(){this.activeTargetIds=xp()}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class qm{constructor(){this.eo=new wa,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,n,r){this.no[e]=n}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new wa,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class jm{ro(e){}shutdown(){}}class Aa{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){T("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ao)e(0)}_o(){T("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ao)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let cr=null;function qi(){return cr===null?cr=function(){return 268435456+Math.round(2147483648*Math.random())}():cr++,"0x"+cr.toString(16)}const $m={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class zm{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}onMessage(e){this.Eo=e}close(){this.lo()}send(e){this.co(e)}Ao(){this.Po()}Ro(e){this.To(e)}Vo(e){this.Eo(e)}}const he="WebChannelConnection";class Hm extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const r=n.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.mo=r+"://"+n.host,this.fo=`projects/${i}/databases/${s}`,this.po=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get yo(){return!1}wo(n,r,i,s,o){const a=qi(),c=this.So(n,r);T("RestConnection",`Sending RPC '${n}' ${a}:`,c,i);const l={"google-cloud-resource-prefix":this.fo,"x-goog-request-params":this.po};return this.bo(l,s,o),this.Do(n,c,l,i).then(u=>(T("RestConnection",`Received RPC '${n}' ${a}: `,u),u),u=>{throw Bt("RestConnection",`RPC '${n}' ${a} failed with error: `,u,"url: ",c,"request:",i),u})}Co(n,r,i,s,o,a){return this.wo(n,r,i,s,o)}bo(n,r,i){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Yt}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>n[o]=s),i&&i.headers.forEach((s,o)=>n[o]=s)}So(n,r){const i=$m[n];return`${this.mo}/v1/${r}:${i}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Do(e,n,r,i){const s=qi();return new Promise((o,a)=>{const c=new Yf;c.setWithCredentials(!0),c.listenOnce(Xf.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Ui.NO_ERROR:const u=c.getResponseJson();T(he,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(u)),o(u);break;case Ui.TIMEOUT:T(he,`RPC '${e}' ${s} timed out`),a(new R(g.DEADLINE_EXCEEDED,"Request time out"));break;case Ui.HTTP_ERROR:const f=c.getStatus();if(T(he,`RPC '${e}' ${s} failed with status:`,f,"response text:",c.getResponseText()),f>0){let p=c.getResponseJson();Array.isArray(p)&&(p=p[0]);const _=p==null?void 0:p.error;if(_&&_.status&&_.message){const O=function(w){const q=w.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(q)>=0?q:g.UNKNOWN}(_.status);a(new R(O,_.message))}else a(new R(g.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new R(g.UNAVAILABLE,"Connection failed."));break;default:P()}}finally{T(he,`RPC '${e}' ${s} completed.`)}});const l=JSON.stringify(i);T(he,`RPC '${e}' ${s} sending request:`,i),c.send(n,"POST",l,r,15)})}vo(e,n,r){const i=qi(),s=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Kf(),a=Qf(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(c.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(c.useFetchStreams=!0),this.bo(c.initMessageHeaders,n,r),c.encodeInitMessageHeaders=!0;const u=s.join("");T(he,`Creating RPC '${e}' stream ${i}: ${u}`,c);const f=o.createWebChannel(u,c);let p=!1,_=!1;const O=new zm({co:w=>{_?T(he,`Not sending because RPC '${e}' stream ${i} is closed:`,w):(p||(T(he,`Opening RPC '${e}' stream ${i} transport.`),f.open(),p=!0),T(he,`RPC '${e}' stream ${i} sending:`,w),f.send(w))},lo:()=>f.close()}),S=(w,q,G)=>{w.listen(q,Y=>{try{G(Y)}catch(ve){setTimeout(()=>{throw ve},0)}})};return S(f,sr.EventType.OPEN,()=>{_||T(he,`RPC '${e}' stream ${i} transport opened.`)}),S(f,sr.EventType.CLOSE,()=>{_||(_=!0,T(he,`RPC '${e}' stream ${i} transport closed`),O.Ro())}),S(f,sr.EventType.ERROR,w=>{_||(_=!0,Bt(he,`RPC '${e}' stream ${i} transport errored:`,w),O.Ro(new R(g.UNAVAILABLE,"The operation could not be completed")))}),S(f,sr.EventType.MESSAGE,w=>{var q;if(!_){const G=w.data[0];$(!!G);const Y=G,ve=Y.error||((q=Y[0])===null||q===void 0?void 0:q.error);if(ve){T(he,`RPC '${e}' stream ${i} received error:`,ve);const Ee=ve.status;let v=function(d){const A=X[d];if(A!==void 0)return Gl(A)}(Ee),y=ve.message;v===void 0&&(v=g.INTERNAL,y="Unknown error status: "+Ee+" with message "+ve.message),_=!0,O.Ro(new R(v,y)),f.close()}else T(he,`RPC '${e}' stream ${i} received:`,G),O.Vo(G)}}),S(a,Jf.STAT_EVENT,w=>{w.stat===ta.PROXY?T(he,`RPC '${e}' stream ${i} detected buffering proxy`):w.stat===ta.NOPROXY&&T(he,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{O.Ao()},0),O}}function ji(){return typeof document<"u"?document:null}function mi(t){return new nm(t,!0)}class iu{constructor(e,n,r=1e3,i=1.5,s=6e4){this.si=e,this.timerId=n,this.Fo=r,this.Mo=i,this.xo=s,this.Oo=0,this.No=null,this.Bo=Date.now(),this.reset()}reset(){this.Oo=0}Lo(){this.Oo=this.xo}ko(e){this.cancel();const n=Math.floor(this.Oo+this.qo()),r=Math.max(0,Date.now()-this.Bo),i=Math.max(0,n-r);i>0&&T("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Oo} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.No=this.si.enqueueAfterDelay(this.timerId,i,()=>(this.Bo=Date.now(),e())),this.Oo*=this.Mo,this.Oo<this.Fo&&(this.Oo=this.Fo),this.Oo>this.xo&&(this.Oo=this.xo)}Qo(){this.No!==null&&(this.No.skipDelay(),this.No=null)}cancel(){this.No!==null&&(this.No.cancel(),this.No=null)}qo(){return(Math.random()-.5)*this.Oo}}class su{constructor(e,n,r,i,s,o,a,c){this.si=e,this.Ko=r,this.$o=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Uo=0,this.Wo=null,this.Go=null,this.stream=null,this.zo=new iu(e,n)}jo(){return this.state===1||this.state===5||this.Ho()}Ho(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Jo()}async stop(){this.jo()&&await this.close(0)}Yo(){this.state=0,this.zo.reset()}Zo(){this.Ho()&&this.Wo===null&&(this.Wo=this.si.enqueueAfterDelay(this.Ko,6e4,()=>this.Xo()))}e_(e){this.t_(),this.stream.send(e)}async Xo(){if(this.Ho())return this.close(0)}t_(){this.Wo&&(this.Wo.cancel(),this.Wo=null)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}async close(e,n){this.t_(),this.n_(),this.zo.cancel(),this.Uo++,e!==4?this.zo.reset():n&&n.code===g.RESOURCE_EXHAUSTED?(ze(n.toString()),ze("Using maximum backoff delay to prevent overloading the backend."),this.zo.Lo()):n&&n.code===g.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.r_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Io(n)}r_(){}auth(){this.state=1;const e=this.i_(this.Uo),n=this.Uo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Uo===n&&this.s_(r,i)},r=>{e(()=>{const i=new R(g.UNKNOWN,"Fetching auth token failed: "+r.message);return this.o_(i)})})}s_(e,n){const r=this.i_(this.Uo);this.stream=this.__(e,n),this.stream.ho(()=>{r(()=>(this.state=2,this.Go=this.si.enqueueAfterDelay(this.$o,1e4,()=>(this.Ho()&&(this.state=3),Promise.resolve())),this.listener.ho()))}),this.stream.Io(i=>{r(()=>this.o_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Jo(){this.state=5,this.zo.ko(async()=>{this.state=0,this.start()})}o_(e){return T("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}i_(e){return n=>{this.si.enqueueAndForget(()=>this.Uo===e?n():(T("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Wm extends su{constructor(e,n,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,o),this.serializer=s}__(e,n){return this.connection.vo("Listen",e,n)}onMessage(e){this.zo.reset();const n=sm(this.serializer,e),r=function(s){if(!("targetChange"in s))return D.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?D.min():o.readTime?Oe(o.readTime):D.min()}(e);return this.listener.a_(n,r)}u_(e){const n={};n.database=_s(this.serializer),n.addTarget=function(s,o){let a;const c=o.target;if(a=ds(c)?{documents:cm(s,c)}:{query:lm(s,c)},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Xl(s,o.resumeToken);const l=ps(s,o.expectedCount);l!==null&&(a.expectedCount=l)}else if(o.snapshotVersion.compareTo(D.min())>0){a.readTime=Mr(s,o.snapshotVersion.toTimestamp());const l=ps(s,o.expectedCount);l!==null&&(a.expectedCount=l)}return a}(this.serializer,e);const r=hm(this.serializer,e);r&&(n.labels=r),this.e_(n)}c_(e){const n={};n.database=_s(this.serializer),n.removeTarget=e,this.e_(n)}}class Gm extends su{constructor(e,n,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,o),this.serializer=s,this.l_=!1}get h_(){return this.l_}start(){this.l_=!1,this.lastStreamToken=void 0,super.start()}r_(){this.l_&&this.P_([])}__(e,n){return this.connection.vo("Write",e,n)}onMessage(e){if($(!!e.streamToken),this.lastStreamToken=e.streamToken,this.l_){this.zo.reset();const n=am(e.writeResults,e.commitTime),r=Oe(e.commitTime);return this.listener.I_(r,n)}return $(!e.writeResults||e.writeResults.length===0),this.l_=!0,this.listener.T_()}E_(){const e={};e.database=_s(this.serializer),this.e_(e)}P_(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>om(this.serializer,r))};this.e_(n)}}class Km extends class{}{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.d_=!1}A_(){if(this.d_)throw new R(g.FAILED_PRECONDITION,"The client has already been terminated.")}wo(e,n,r){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.wo(e,n,r,i,s)).catch(i=>{throw i.name==="FirebaseError"?(i.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new R(g.UNKNOWN,i.toString())})}Co(e,n,r,i){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Co(e,n,r,s,o,i)).catch(s=>{throw s.name==="FirebaseError"?(s.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new R(g.UNKNOWN,s.toString())})}terminate(){this.d_=!0}}class Qm{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.V_=0,this.m_=null,this.f_=!0}g_(){this.V_===0&&(this.p_("Unknown"),this.m_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.m_=null,this.y_("Backend didn't respond within 10 seconds."),this.p_("Offline"),Promise.resolve())))}w_(e){this.state==="Online"?this.p_("Unknown"):(this.V_++,this.V_>=1&&(this.S_(),this.y_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.p_("Offline")))}set(e){this.S_(),this.V_=0,e==="Online"&&(this.f_=!1),this.p_(e)}p_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}y_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.f_?(ze(n),this.f_=!1):T("OnlineStateTracker",n)}S_(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}}class Xm{constructor(e,n,r,i,s){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.b_=[],this.D_=new Map,this.C_=new Set,this.v_=[],this.F_=s,this.F_.ro(o=>{r.enqueueAndForget(async()=>{Rt(this)&&(T("RemoteStore","Restarting streams for network reachability change."),await async function(c){const l=L(c);l.C_.add(4),await Qn(l),l.M_.set("Unknown"),l.C_.delete(4),await gi(l)}(this))})}),this.M_=new Qm(r,i)}}async function gi(t){if(Rt(t))for(const e of t.v_)await e(!0)}async function Qn(t){for(const e of t.v_)await e(!1)}function ou(t,e){const n=L(t);n.D_.has(e.targetId)||(n.D_.set(e.targetId,e),uo(n)?lo(n):tn(n).Ho()&&co(n,e))}function au(t,e){const n=L(t),r=tn(n);n.D_.delete(e),r.Ho()&&cu(n,e),n.D_.size===0&&(r.Ho()?r.Zo():Rt(n)&&n.M_.set("Unknown"))}function co(t,e){if(t.x_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(D.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}tn(t).u_(e)}function cu(t,e){t.x_.Oe(e),tn(t).c_(e)}function lo(t){t.x_=new Yp({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>t.D_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),tn(t).start(),t.M_.g_()}function uo(t){return Rt(t)&&!tn(t).jo()&&t.D_.size>0}function Rt(t){return L(t).C_.size===0}function lu(t){t.x_=void 0}async function Jm(t){t.D_.forEach((e,n)=>{co(t,e)})}async function Ym(t,e){lu(t),uo(t)?(t.M_.w_(e),lo(t)):t.M_.set("Unknown")}async function Zm(t,e,n){if(t.M_.set("Online"),e instanceof Ql&&e.state===2&&e.cause)try{await async function(i,s){const o=s.cause;for(const a of s.targetIds)i.D_.has(a)&&(await i.remoteSyncer.rejectListen(a,o),i.D_.delete(a),i.x_.removeTarget(a))}(t,e)}catch(r){T("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await xr(t,r)}else if(e instanceof mr?t.x_.$e(e):e instanceof Kl?t.x_.Je(e):t.x_.Ge(e),!n.isEqual(D.min()))try{const r=await ru(t.localStore);n.compareTo(r)>=0&&await function(s,o){const a=s.x_.it(o);return a.targetChanges.forEach((c,l)=>{if(c.resumeToken.approximateByteSize()>0){const u=s.D_.get(l);u&&s.D_.set(l,u.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,l)=>{const u=s.D_.get(c);if(!u)return;s.D_.set(c,u.withResumeToken(_e.EMPTY_BYTE_STRING,u.snapshotVersion)),cu(s,c);const f=new Ye(u.target,c,l,u.sequenceNumber);co(s,f)}),s.remoteSyncer.applyRemoteEvent(a)}(t,n)}catch(r){T("RemoteStore","Failed to raise snapshot:",r),await xr(t,r)}}async function xr(t,e,n){if(!Wn(e))throw e;t.C_.add(1),await Qn(t),t.M_.set("Offline"),n||(n=()=>ru(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{T("RemoteStore","Retrying IndexedDB access"),await n(),t.C_.delete(1),await gi(t)})}function uu(t,e){return e().catch(n=>xr(t,n,e))}async function _i(t){const e=L(t),n=ot(e);let r=e.b_.length>0?e.b_[e.b_.length-1].batchId:-1;for(;eg(e);)try{const i=await Fm(e.localStore,r);if(i===null){e.b_.length===0&&n.Zo();break}r=i.batchId,tg(e,i)}catch(i){await xr(e,i)}hu(e)&&du(e)}function eg(t){return Rt(t)&&t.b_.length<10}function tg(t,e){t.b_.push(e);const n=ot(t);n.Ho()&&n.h_&&n.P_(e.mutations)}function hu(t){return Rt(t)&&!ot(t).jo()&&t.b_.length>0}function du(t){ot(t).start()}async function ng(t){ot(t).E_()}async function rg(t){const e=ot(t);for(const n of t.b_)e.P_(n.mutations)}async function ig(t,e,n){const r=t.b_.shift(),i=no.from(r,e,n);await uu(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),await _i(t)}async function sg(t,e){e&&ot(t).h_&&await async function(r,i){if(function(o){return Qp(o)&&o!==g.ABORTED}(i.code)){const s=r.b_.shift();ot(r).Yo(),await uu(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),await _i(r)}}(t,e),hu(t)&&du(t)}async function Ra(t,e){const n=L(t);n.asyncQueue.verifyOperationInProgress(),T("RemoteStore","RemoteStore received new credentials");const r=Rt(n);n.C_.add(3),await Qn(n),r&&n.M_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.C_.delete(3),await gi(n)}async function og(t,e){const n=L(t);e?(n.C_.delete(2),await gi(n)):e||(n.C_.add(2),await Qn(n),n.M_.set("Unknown"))}function tn(t){return t.O_||(t.O_=function(n,r,i){const s=L(n);return s.A_(),new Wm(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{ho:Jm.bind(null,t),Io:Ym.bind(null,t),a_:Zm.bind(null,t)}),t.v_.push(async e=>{e?(t.O_.Yo(),uo(t)?lo(t):t.M_.set("Unknown")):(await t.O_.stop(),lu(t))})),t.O_}function ot(t){return t.N_||(t.N_=function(n,r,i){const s=L(n);return s.A_(),new Gm(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{ho:ng.bind(null,t),Io:sg.bind(null,t),T_:rg.bind(null,t),I_:ig.bind(null,t)}),t.v_.push(async e=>{e?(t.N_.Yo(),await _i(t)):(await t.N_.stop(),t.b_.length>0&&(T("RemoteStore",`Stopping write stream with ${t.b_.length} pending writes`),t.b_=[]))})),t.N_}class ho{constructor(e,n,r,i,s){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new nt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,s){const o=Date.now()+r,a=new ho(e,n,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new R(g.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function fo(t,e){if(ze("AsyncQueue",`${e}: ${t}`),Wn(t))return new R(g.UNAVAILABLE,`${e}: ${t}`);throw t}class Vt{constructor(e){this.comparator=e?(n,r)=>e(n,r)||C.comparator(n.key,r.key):(n,r)=>C.comparator(n.key,r.key),this.keyedMap=ln(),this.sortedSet=new W(this.comparator)}static emptySet(e){return new Vt(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Vt)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Vt;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}class Sa{constructor(){this.B_=new W(C.comparator)}track(e){const n=e.doc.key,r=this.B_.get(n);r?e.type!==0&&r.type===3?this.B_=this.B_.insert(n,e):e.type===3&&r.type!==1?this.B_=this.B_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.B_=this.B_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.B_=this.B_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.B_=this.B_.remove(n):e.type===1&&r.type===2?this.B_=this.B_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.B_=this.B_.insert(n,{type:2,doc:e.doc}):P():this.B_=this.B_.insert(n,e)}L_(){const e=[];return this.B_.inorderTraversal((n,r)=>{e.push(r)}),e}}class Ht{constructor(e,n,r,i,s,o,a,c,l){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=l}static fromInitialDocuments(e,n,r,i,s){const o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new Ht(e,n,Vt.emptySet(n),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ui(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}class ag{constructor(){this.k_=void 0,this.listeners=[]}}class cg{constructor(){this.queries=new en(e=>Ol(e),ui),this.onlineState="Unknown",this.q_=new Set}}async function lg(t,e){const n=L(t),r=e.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new ag),i)try{s.k_=await n.onListen(r)}catch(o){const a=fo(o,`Initialization of query '${Ct(e.query)}' failed`);return void e.onError(a)}n.queries.set(r,s),s.listeners.push(e),e.Q_(n.onlineState),s.k_&&e.K_(s.k_)&&po(n)}async function ug(t,e){const n=L(t),r=e.query;let i=!1;const s=n.queries.get(r);if(s){const o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),i=s.listeners.length===0)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function hg(t,e){const n=L(t);let r=!1;for(const i of e){const s=i.query,o=n.queries.get(s);if(o){for(const a of o.listeners)a.K_(i)&&(r=!0);o.k_=i}}r&&po(n)}function dg(t,e,n){const r=L(t),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(n);r.queries.delete(e)}function po(t){t.q_.forEach(e=>{e.next()})}class fg{constructor(e,n,r){this.query=e,this.U_=n,this.W_=!1,this.G_=null,this.onlineState="Unknown",this.options=r||{}}K_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new Ht(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.W_?this.z_(e)&&(this.U_.next(e),n=!0):this.j_(e,this.onlineState)&&(this.H_(e),n=!0),this.G_=e,n}onError(e){this.U_.error(e)}Q_(e){this.onlineState=e;let n=!1;return this.G_&&!this.W_&&this.j_(this.G_,e)&&(this.H_(this.G_),n=!0),n}j_(e,n){if(!e.fromCache)return!0;const r=n!=="Offline";return(!this.options.J_||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}z_(e){if(e.docChanges.length>0)return!0;const n=this.G_&&this.G_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}H_(e){e=Ht.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.W_=!0,this.U_.next(e)}}class fu{constructor(e){this.key=e}}class pu{constructor(e){this.key=e}}class pg{constructor(e,n){this.query=e,this.ia=n,this.sa=null,this.hasCachedResults=!1,this.current=!1,this.oa=M(),this.mutatedKeys=M(),this._a=Ll(e),this.aa=new Vt(this._a)}get ua(){return this.ia}ca(e,n){const r=n?n.la:new Sa,i=n?n.aa:this.aa;let s=n?n.mutatedKeys:this.mutatedKeys,o=i,a=!1;const c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,l=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,f)=>{const p=i.get(u),_=hi(this.query,f)?f:null,O=!!p&&this.mutatedKeys.has(p.key),S=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let w=!1;p&&_?p.data.isEqual(_.data)?O!==S&&(r.track({type:3,doc:_}),w=!0):this.ha(p,_)||(r.track({type:2,doc:_}),w=!0,(c&&this._a(_,c)>0||l&&this._a(_,l)<0)&&(a=!0)):!p&&_?(r.track({type:0,doc:_}),w=!0):p&&!_&&(r.track({type:1,doc:p}),w=!0,(c||l)&&(a=!0)),w&&(_?(o=o.add(_),s=S?s.add(u):s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{aa:o,la:r,Zi:a,mutatedKeys:s}}ha(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const s=this.aa;this.aa=e.aa,this.mutatedKeys=e.mutatedKeys;const o=e.la.L_();o.sort((u,f)=>function(_,O){const S=w=>{switch(w){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return P()}};return S(_)-S(O)}(u.type,f.type)||this._a(u.doc,f.doc)),this.Pa(r),i=i!=null&&i;const a=n&&!i?this.Ia():[],c=this.oa.size===0&&this.current&&!i?1:0,l=c!==this.sa;return this.sa=c,o.length!==0||l?{snapshot:new Ht(this.query,e.aa,s,o,e.mutatedKeys,c===0,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ta:a}:{Ta:a}}Q_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({aa:this.aa,la:new Sa,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{Ta:[]}}Ea(e){return!this.ia.has(e)&&!!this.aa.has(e)&&!this.aa.get(e).hasLocalMutations}Pa(e){e&&(e.addedDocuments.forEach(n=>this.ia=this.ia.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.ia=this.ia.delete(n)),this.current=e.current)}Ia(){if(!this.current)return[];const e=this.oa;this.oa=M(),this.aa.forEach(r=>{this.Ea(r.key)&&(this.oa=this.oa.add(r.key))});const n=[];return e.forEach(r=>{this.oa.has(r)||n.push(new pu(r))}),this.oa.forEach(r=>{e.has(r)||n.push(new fu(r))}),n}da(e){this.ia=e.ls,this.oa=M();const n=this.ca(e.documents);return this.applyChanges(n,!0)}Aa(){return Ht.fromInitialDocuments(this.query,this.aa,this.mutatedKeys,this.sa===0,this.hasCachedResults)}}class mg{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class gg{constructor(e){this.key=e,this.Ra=!1}}class _g{constructor(e,n,r,i,s,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Va={},this.ma=new en(a=>Ol(a),ui),this.fa=new Map,this.ga=new Set,this.pa=new W(C.comparator),this.ya=new Map,this.wa=new so,this.Sa={},this.ba=new Map,this.Da=zt.Nn(),this.onlineState="Unknown",this.Ca=void 0}get isPrimaryClient(){return this.Ca===!0}}async function yg(t,e){const n=bg(t);let r,i;const s=n.ma.get(e);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Aa();else{const o=await Um(n.localStore,De(e)),a=n.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,i=await vg(n,e,r,a==="current",o.resumeToken),n.isPrimaryClient&&ou(n.remoteStore,o)}return i}async function vg(t,e,n,r,i){t.va=(f,p,_)=>async function(S,w,q,G){let Y=w.view.ca(q);Y.Zi&&(Y=await Ta(S.localStore,w.query,!1).then(({documents:y})=>w.view.ca(y,Y)));const ve=G&&G.targetChanges.get(w.targetId),Ee=G&&G.targetMismatches.get(w.targetId)!=null,v=w.view.applyChanges(Y,S.isPrimaryClient,ve,Ee);return ba(S,w.targetId,v.Ta),v.snapshot}(t,f,p,_);const s=await Ta(t.localStore,e,!0),o=new pg(e,s.ls),a=o.ca(s.documents),c=Kn.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),l=o.applyChanges(a,t.isPrimaryClient,c);ba(t,n,l.Ta);const u=new mg(e,n,o);return t.ma.set(e,u),t.fa.has(n)?t.fa.get(n).push(e):t.fa.set(n,[e]),l.snapshot}async function Eg(t,e){const n=L(t),r=n.ma.get(e),i=n.fa.get(r.targetId);if(i.length>1)return n.fa.set(r.targetId,i.filter(s=>!ui(s,e))),void n.ma.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await ys(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),au(n.remoteStore,r.targetId),vs(n,r.targetId)}).catch(Hn)):(vs(n,r.targetId),await ys(n.localStore,r.targetId,!0))}async function Ig(t,e,n){const r=Pg(t);try{const i=await function(o,a){const c=L(o),l=te.now(),u=a.reduce((_,O)=>_.add(O.key),M());let f,p;return c.persistence.runTransaction("Locally write mutations","readwrite",_=>{let O=He(),S=M();return c.ss.getEntries(_,u).next(w=>{O=w,O.forEach((q,G)=>{G.isValidDocument()||(S=S.add(q))})}).next(()=>c.localDocuments.getOverlayedDocuments(_,O)).next(w=>{f=w;const q=[];for(const G of a){const Y=zp(G,f.get(G.key).overlayedDocument);Y!=null&&q.push(new At(G.key,Y,Sl(Y.value.mapValue),Ve.exists(!0)))}return c.mutationQueue.addMutationBatch(_,l,q,a)}).next(w=>{p=w;const q=w.applyToLocalDocumentSet(f,S);return c.documentOverlayCache.saveOverlays(_,w.batchId,q)})}).then(()=>({batchId:p.batchId,changes:xl(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,c){let l=o.Sa[o.currentUser.toKey()];l||(l=new W(B)),l=l.insert(a,c),o.Sa[o.currentUser.toKey()]=l}(r,i.batchId,n),await Xn(r,i.changes),await _i(r.remoteStore)}catch(i){const s=fo(i,"Failed to persist write");n.reject(s)}}async function mu(t,e){const n=L(t);try{const r=await Mm(n.localStore,e);e.targetChanges.forEach((i,s)=>{const o=n.ya.get(s);o&&($(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.Ra=!0:i.modifiedDocuments.size>0?$(o.Ra):i.removedDocuments.size>0&&($(o.Ra),o.Ra=!1))}),await Xn(n,r,e)}catch(r){await Hn(r)}}function Ca(t,e,n){const r=L(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.ma.forEach((s,o)=>{const a=o.view.Q_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const c=L(o);c.onlineState=a;let l=!1;c.queries.forEach((u,f)=>{for(const p of f.listeners)p.Q_(a)&&(l=!0)}),l&&po(c)}(r.eventManager,e),i.length&&r.Va.a_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Tg(t,e,n){const r=L(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.ya.get(e),s=i&&i.key;if(s){let o=new W(C.comparator);o=o.insert(s,fe.newNoDocument(s,D.min()));const a=M().add(s),c=new pi(D.min(),new Map,new W(B),o,a);await mu(r,c),r.pa=r.pa.remove(s),r.ya.delete(e),mo(r)}else await ys(r.localStore,e,!1).then(()=>vs(r,e,n)).catch(Hn)}async function wg(t,e){const n=L(t),r=e.batch.batchId;try{const i=await Lm(n.localStore,e);_u(n,r,null),gu(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Xn(n,i)}catch(i){await Hn(i)}}async function Ag(t,e,n){const r=L(t);try{const i=await function(o,a){const c=L(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let u;return c.mutationQueue.lookupMutationBatch(l,a).next(f=>($(f!==null),u=f.keys(),c.mutationQueue.removeMutationBatch(l,f))).next(()=>c.mutationQueue.performConsistencyCheck(l)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(l,u,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,u)).next(()=>c.localDocuments.getDocuments(l,u))})}(r.localStore,e);_u(r,e,n),gu(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Xn(r,i)}catch(i){await Hn(i)}}function gu(t,e){(t.ba.get(e)||[]).forEach(n=>{n.resolve()}),t.ba.delete(e)}function _u(t,e,n){const r=L(t);let i=r.Sa[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(n?s.reject(n):s.resolve(),i=i.remove(e)),r.Sa[r.currentUser.toKey()]=i}}function vs(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.fa.get(e))t.ma.delete(r),n&&t.Va.Fa(r,n);t.fa.delete(e),t.isPrimaryClient&&t.wa.Rr(e).forEach(r=>{t.wa.containsKey(r)||yu(t,r)})}function yu(t,e){t.ga.delete(e.path.canonicalString());const n=t.pa.get(e);n!==null&&(au(t.remoteStore,n),t.pa=t.pa.remove(e),t.ya.delete(n),mo(t))}function ba(t,e,n){for(const r of n)r instanceof fu?(t.wa.addReference(r.key,e),Rg(t,r)):r instanceof pu?(T("SyncEngine","Document no longer in limbo: "+r.key),t.wa.removeReference(r.key,e),t.wa.containsKey(r.key)||yu(t,r.key)):P()}function Rg(t,e){const n=e.key,r=n.path.canonicalString();t.pa.get(n)||t.ga.has(r)||(T("SyncEngine","New document in limbo: "+n),t.ga.add(r),mo(t))}function mo(t){for(;t.ga.size>0&&t.pa.size<t.maxConcurrentLimboResolutions;){const e=t.ga.values().next().value;t.ga.delete(e);const n=new C(H.fromString(e)),r=t.Da.next();t.ya.set(r,new gg(n)),t.pa=t.pa.insert(n,r),ou(t.remoteStore,new Ye(De(Vl(n.path)),r,"TargetPurposeLimboResolution",Qs._e))}}async function Xn(t,e,n){const r=L(t),i=[],s=[],o=[];r.ma.isEmpty()||(r.ma.forEach((a,c)=>{o.push(r.va(c,e,n).then(l=>{if((l||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,l!=null&&l.fromCache?"not-current":"current"),l){i.push(l);const u=ao.Qi(c.targetId,l);s.push(u)}}))}),await Promise.all(o),r.Va.a_(i),await async function(c,l){const u=L(c);try{await u.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>m.forEach(l,p=>m.forEach(p.ki,_=>u.persistence.referenceDelegate.addReference(f,p.targetId,_)).next(()=>m.forEach(p.qi,_=>u.persistence.referenceDelegate.removeReference(f,p.targetId,_)))))}catch(f){if(!Wn(f))throw f;T("LocalStore","Failed to update sequence numbers: "+f)}for(const f of l){const p=f.targetId;if(!f.fromCache){const _=u.ts.get(p),O=_.snapshotVersion,S=_.withLastLimboFreeSnapshotVersion(O);u.ts=u.ts.insert(p,S)}}}(r.localStore,s))}async function Sg(t,e){const n=L(t);if(!n.currentUser.isEqual(e)){T("SyncEngine","User change. New user:",e.toKey());const r=await nu(n.localStore,e);n.currentUser=e,function(s,o){s.ba.forEach(a=>{a.forEach(c=>{c.reject(new R(g.CANCELLED,o))})}),s.ba.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Xn(n,r._s)}}function Cg(t,e){const n=L(t),r=n.ya.get(e);if(r&&r.Ra)return M().add(r.key);{let i=M();const s=n.fa.get(e);if(!s)return i;for(const o of s){const a=n.ma.get(o);i=i.unionWith(a.view.ua)}return i}}function bg(t){const e=L(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=mu.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Cg.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Tg.bind(null,e),e.Va.a_=hg.bind(null,e.eventManager),e.Va.Fa=dg.bind(null,e.eventManager),e}function Pg(t){const e=L(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=wg.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Ag.bind(null,e),e}class Pa{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=mi(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,n){return null}createIndexBackfillerScheduler(e,n){return null}createLocalStore(e){return Om(this.persistence,new Dm,e.initialUser,this.serializer)}createPersistence(e){return new Pm(oo.jr,this.serializer)}createSharedClientState(e){return new qm}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class kg{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Ca(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Sg.bind(null,this.syncEngine),await og(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new cg}()}createDatastore(e){const n=mi(e.databaseInfo.databaseId),r=function(s){return new Hm(s)}(e.databaseInfo);return function(s,o,a,c){return new Km(s,o,a,c)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,i,s,o,a){return new Xm(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,n=>Ca(this.syncEngine,n,0),function(){return Aa.D()?new Aa:new jm}())}createSyncEngine(e,n){return function(i,s,o,a,c,l,u){const f=new _g(i,s,o,a,c,l);return u&&(f.Ca=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return async function(n){const r=L(n);T("RemoteStore","RemoteStore shutting down."),r.C_.add(5),await Qn(r),r.F_.shutdown(),r.M_.set("Unknown")}(this.remoteStore)}}class Ng{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Oa(this.observer.next,e)}error(e){this.observer.error?this.Oa(this.observer.error,e):ze("Uncaught Error in snapshot listener:",e.toString())}Na(){this.muted=!0}Oa(e,n){this.muted||setTimeout(()=>{this.muted||e(n)},0)}}class Dg{constructor(e,n,r,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=de.UNAUTHENTICATED,this.clientId=wl.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,async s=>{T("FirestoreClient","Received user=",s.uid),await this.authCredentialListener(s),this.user=s}),this.appCheckCredentials.start(r,s=>(T("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new R(g.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new nt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=fo(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function $i(t,e){t.asyncQueue.verifyOperationInProgress(),T("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async i=>{r.isEqual(i)||(await nu(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function ka(t,e){t.asyncQueue.verifyOperationInProgress();const n=await Og(t);T("FirestoreClient","Initializing OnlineComponentProvider");const r=await t.getConfiguration();await e.initialize(n,r),t.setCredentialChangeListener(i=>Ra(e.remoteStore,i)),t.setAppCheckTokenChangeListener((i,s)=>Ra(e.remoteStore,s)),t._onlineComponents=e}function Vg(t){return t.name==="FirebaseError"?t.code===g.FAILED_PRECONDITION||t.code===g.UNIMPLEMENTED:!(typeof DOMException<"u"&&t instanceof DOMException)||t.code===22||t.code===20||t.code===11}async function Og(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){T("FirestoreClient","Using user provided OfflineComponentProvider");try{await $i(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!Vg(n))throw n;Bt("Error using user provided cache. Falling back to memory cache: "+n),await $i(t,new Pa)}}else T("FirestoreClient","Using default OfflineComponentProvider"),await $i(t,new Pa);return t._offlineComponents}async function vu(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(T("FirestoreClient","Using user provided OnlineComponentProvider"),await ka(t,t._uninitializedComponentsProvider._online)):(T("FirestoreClient","Using default OnlineComponentProvider"),await ka(t,new kg))),t._onlineComponents}function Lg(t){return vu(t).then(e=>e.syncEngine)}async function Mg(t){const e=await vu(t),n=e.eventManager;return n.onListen=yg.bind(null,e.syncEngine),n.onUnlisten=Eg.bind(null,e.syncEngine),n}function xg(t,e,n={}){const r=new nt;return t.asyncQueue.enqueueAndForget(async()=>function(s,o,a,c,l){const u=new Ng({next:p=>{o.enqueueAndForget(()=>ug(s,f)),p.fromCache&&c.source==="server"?l.reject(new R(g.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(p)},error:p=>l.reject(p)}),f=new fg(a,u,{includeMetadataChanges:!0,J_:!0});return lg(s,f)}(await Mg(t),t.asyncQueue,e,n,r)),r.promise}function Eu(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}const Na=new Map;function Iu(t,e,n){if(!n)throw new R(g.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Fg(t,e,n,r){if(e===!0&&r===!0)throw new R(g.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Da(t){if(!C.isDocumentKey(t))throw new R(g.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Va(t){if(C.isDocumentKey(t))throw new R(g.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function go(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":P()}function Wt(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new R(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=go(t);throw new R(g.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class Oa{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new R(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new R(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Fg("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Eu((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new R(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new R(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new R(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class yi{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Oa({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new R(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new R(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Oa(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new ep;switch(r.type){case"firstParty":return new ip(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new R(g.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=Na.get(n);r&&(T("ComponentProvider","Removing Datastore"),Na.delete(n),r.terminate())}(this),Promise.resolve()}}function Ug(t,e,n,r={}){var i;const s=(t=Wt(t,yi))._getSettings(),o=`${e}:${n}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Bt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,c;if(typeof r.mockUserToken=="string")a=r.mockUserToken,c=de.MOCK_USER;else{a=bh(r.mockUserToken,(i=t._app)===null||i===void 0?void 0:i.options.projectId);const l=r.mockUserToken.sub||r.mockUserToken.user_id;if(!l)throw new R(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new de(l)}t._authCredentials=new tp(new Tl(a,c))}}class vi{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new vi(this.firestore,e,this._query)}}class Ae{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new rt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ae(this.firestore,e,this._key)}}class rt extends vi{constructor(e,n,r){super(e,n,Vl(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ae(this.firestore,null,new C(e))}withConverter(e){return new rt(this.firestore,e,this._path)}}function Bg(t,e,...n){if(t=Re(t),Iu("collection","path",e),t instanceof yi){const r=H.fromString(e,...n);return Va(r),new rt(t,null,r)}{if(!(t instanceof Ae||t instanceof rt))throw new R(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(H.fromString(e,...n));return Va(r),new rt(t.firestore,null,r)}}function Tu(t,e,...n){if(t=Re(t),arguments.length===1&&(e=wl.newId()),Iu("doc","path",e),t instanceof yi){const r=H.fromString(e,...n);return Da(r),new Ae(t,null,new C(r))}{if(!(t instanceof Ae||t instanceof rt))throw new R(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(H.fromString(e,...n));return Da(r),new Ae(t.firestore,t instanceof rt?t.converter:null,new C(r))}}class qg{constructor(){this.Ja=Promise.resolve(),this.Ya=[],this.Za=!1,this.Xa=[],this.eu=null,this.tu=!1,this.nu=!1,this.ru=[],this.zo=new iu(this,"async_queue_retry"),this.iu=()=>{const n=ji();n&&T("AsyncQueue","Visibility state changed to "+n.visibilityState),this.zo.Qo()};const e=ji();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.iu)}get isShuttingDown(){return this.Za}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.su(),this.ou(e)}enterRestrictedMode(e){if(!this.Za){this.Za=!0,this.nu=e||!1;const n=ji();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.iu)}}enqueue(e){if(this.su(),this.Za)return new Promise(()=>{});const n=new nt;return this.ou(()=>this.Za&&this.nu?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ya.push(e),this._u()))}async _u(){if(this.Ya.length!==0){try{await this.Ya[0](),this.Ya.shift(),this.zo.reset()}catch(e){if(!Wn(e))throw e;T("AsyncQueue","Operation failed with retryable error: "+e)}this.Ya.length>0&&this.zo.ko(()=>this._u())}}ou(e){const n=this.Ja.then(()=>(this.tu=!0,e().catch(r=>{this.eu=r,this.tu=!1;const i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw ze("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.tu=!1,r))));return this.Ja=n,n}enqueueAfterDelay(e,n,r){this.su(),this.ru.indexOf(e)>-1&&(n=0);const i=ho.createAndSchedule(this,e,n,r,s=>this.au(s));return this.Xa.push(i),i}su(){this.eu&&P()}verifyOperationInProgress(){}async uu(){let e;do e=this.Ja,await e;while(e!==this.Ja)}cu(e){for(const n of this.Xa)if(n.timerId===e)return!0;return!1}lu(e){return this.uu().then(()=>{this.Xa.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.Xa)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.uu()})}hu(e){this.ru.push(e)}au(e){const n=this.Xa.indexOf(e);this.Xa.splice(n,1)}}class Ei extends yi{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=function(){return new qg}(),this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Au(this),this._firestoreClient.terminate()}}function jg(t,e){const n=typeof t=="object"?t:gc(),r=typeof t=="string"?t:e||"(default)",i=Rs(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=Sh("firestore");s&&Ug(i,...s)}return i}function wu(t){return t._firestoreClient||Au(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Au(t){var e,n,r;const i=t._freezeSettings(),s=function(a,c,l,u){return new gp(a,c,l,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,Eu(u.experimentalLongPollingOptions),u.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,i);t._firestoreClient=new Dg(t._authCredentials,t._appCheckCredentials,t._queue,s),!((n=i.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class Gt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Gt(_e.fromBase64String(e))}catch(n){throw new R(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Gt(_e.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class _o{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new R(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ce(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Ru{constructor(e){this._methodName=e}}class yo{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new R(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new R(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return B(this._lat,e._lat)||B(this._long,e._long)}}const $g=/^__.*__$/;class zg{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new At(e,this.data,this.fieldMask,n,this.fieldTransforms):new Gn(e,this.data,n,this.fieldTransforms)}}function Su(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw P()}}class vo{constructor(e,n,r,i,s,o){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Pu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Iu(){return this.settings.Iu}Tu(e){return new vo(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Eu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.Tu({path:r,du:!1});return i.Au(e),i}Ru(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.Tu({path:r,du:!1});return i.Pu(),i}Vu(e){return this.Tu({path:void 0,du:!0})}mu(e){return Fr(e,this.settings.methodName,this.settings.fu||!1,this.path,this.settings.gu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Pu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Au(this.path.get(e))}Au(e){if(e.length===0)throw this.mu("Document fields must not be empty");if(Su(this.Iu)&&$g.test(e))throw this.mu('Document fields cannot begin and end with "__"')}}class Hg{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||mi(e)}pu(e,n,r,i=!1){return new vo({Iu:e,methodName:n,gu:r,path:ce.emptyPath(),du:!1,fu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Wg(t){const e=t._freezeSettings(),n=mi(t._databaseId);return new Hg(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Gg(t,e,n,r,i,s={}){const o=t.pu(s.merge||s.mergeFields?2:0,e,n,i);ku("Data must be an object, but it was:",o,r);const a=bu(r,o);let c,l;if(s.merge)c=new Ce(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){const u=[];for(const f of s.mergeFields){const p=Kg(e,f,n);if(!o.contains(p))throw new R(g.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);Xg(u,p)||u.push(p)}c=new Ce(u),l=o.fieldTransforms.filter(f=>c.covers(f.field))}else c=null,l=o.fieldTransforms;return new zg(new we(a),c,l)}function Cu(t,e){if(Pu(t=Re(t)))return ku("Unsupported field value:",e,t),bu(t,e);if(t instanceof Ru)return function(r,i){if(!Su(i.Iu))throw i.mu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.mu(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.du&&e.Iu!==4)throw e.mu("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const a of r){let c=Cu(a,i.Vu(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(t,e)}return function(r,i){if((r=Re(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Fp(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=te.fromDate(r);return{timestampValue:Mr(i.serializer,s)}}if(r instanceof te){const s=new te(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Mr(i.serializer,s)}}if(r instanceof yo)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Gt)return{bytesValue:Xl(i.serializer,r._byteString)};if(r instanceof Ae){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.mu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:io(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.mu(`Unsupported field value: ${go(r)}`)}(t,e)}function bu(t,e){const n={};return Al(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Zt(t,(r,i)=>{const s=Cu(i,e.Eu(r));s!=null&&(n[r]=s)}),{mapValue:{fields:n}}}function Pu(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof te||t instanceof yo||t instanceof Gt||t instanceof Ae||t instanceof Ru)}function ku(t,e,n){if(!Pu(n)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(n)){const r=go(n);throw r==="an object"?e.mu(t+" a custom object"):e.mu(t+" "+r)}}function Kg(t,e,n){if((e=Re(e))instanceof _o)return e._internalPath;if(typeof e=="string")return Nu(t,e);throw Fr("Field path arguments must be of type string or ",t,!1,void 0,n)}const Qg=new RegExp("[~\\*/\\[\\]]");function Nu(t,e,n){if(e.search(Qg)>=0)throw Fr(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new _o(...e.split("."))._internalPath}catch{throw Fr(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Fr(t,e,n,r,i){const s=r&&!r.isEmpty(),o=i!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new R(g.INVALID_ARGUMENT,a+t+c)}function Xg(t,e){return t.some(n=>n.isEqual(e))}class Du{constructor(e,n,r,i,s){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ae(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Jg(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Vu("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class Jg extends Du{data(){return super.data()}}function Vu(t,e){return typeof e=="string"?Nu(t,e):e instanceof _o?e._internalPath:e._delegate._internalPath}function Yg(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new R(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Zg{convertValue(e,n="none"){switch(Et(e)){case 0:return null;case 1:return e.booleanValue;case 2:return J(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(vt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 10:return this.convertObject(e.mapValue,n);default:throw P()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Zt(e,(i,s)=>{r[i]=this.convertValue(s,n)}),r}convertGeoPoint(e){return new yo(J(e.latitude),J(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Js(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Cn(e));default:return null}}convertTimestamp(e){const n=st(e);return new te(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=H.fromString(e);$(tu(r));const i=new bn(r.get(1),r.get(3)),s=new C(r.popFirst(5));return i.isEqual(n)||ze(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),s}}function e_(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class lr{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class t_ extends Du{constructor(e,n,r,i,s,o){super(e,n,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new gr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Vu("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class gr extends t_{data(e={}){return super.data(e)}}class n_{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new lr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new gr(this._firestore,this._userDataWriter,r.key,r,new lr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new R(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{const c=new gr(i._firestore,i._userDataWriter,a.doc.key,a.doc,new lr(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{const c=new gr(i._firestore,i._userDataWriter,a.doc.key,a.doc,new lr(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let l=-1,u=-1;return a.type!==0&&(l=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),u=o.indexOf(a.doc.key)),{type:r_(a.type),doc:c,oldIndex:l,newIndex:u}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function r_(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return P()}}class i_ extends Zg{constructor(e){super(),this.firestore=e}convertBytes(e){return new Gt(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Ae(this.firestore,null,n)}}function s_(t){t=Wt(t,vi);const e=Wt(t.firestore,Ei),n=wu(e),r=new i_(e);return Yg(t._query),xg(n,t._query).then(i=>new n_(e,r,t,i))}function o_(t,e,n){t=Wt(t,Ae);const r=Wt(t.firestore,Ei),i=e_(t.converter,e,n);return Ou(r,[Gg(Wg(r),"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,Ve.none())])}function a_(t){return Ou(Wt(t.firestore,Ei),[new to(t._key,Ve.none())])}function Ou(t,e){return function(r,i){const s=new nt;return r.asyncQueue.enqueueAndForget(async()=>Ig(await Lg(r),i,s)),s.promise}(wu(t),e)}(function(e,n=!0){(function(i){Yt=i})(Qt),Ft(new gt("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new Ei(new np(r.getProvider("auth-internal")),new op(r.getProvider("app-check-internal")),function(l,u){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new R(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new bn(l.options.projectId,u)}(o,i),o);return s=Object.assign({useFetchStreams:n},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),tt(na,"4.4.0",e),tt(na,"4.4.0","esm2017")})();var c_="firebase",l_="10.7.1";tt(c_,l_,"app");function Eo(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function Lu(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const u_=Lu,Mu=new Ln("auth","Firebase",Lu());const Ur=new ws("@firebase/auth");function h_(t,...e){Ur.logLevel<=x.WARN&&Ur.warn(`Auth (${Qt}): ${t}`,...e)}function _r(t,...e){Ur.logLevel<=x.ERROR&&Ur.error(`Auth (${Qt}): ${t}`,...e)}function Ue(t,...e){throw Io(t,...e)}function Le(t,...e){return Io(t,...e)}function xu(t,e,n){const r=Object.assign(Object.assign({},u_()),{[e]:n});return new Ln("auth","Firebase",r).create(e,{appName:t.name})}function d_(t,e,n){const r=n;if(!(e instanceof r))throw r.name!==e.constructor.name&&Ue(t,"argument-error"),xu(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Io(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return Mu.create(t,...e)}function V(t,e,...n){if(!t)throw Io(e,...n)}function qe(t){const e="INTERNAL ASSERTION FAILED: "+t;throw _r(e),new Error(e)}function We(t,e){t||qe(e)}function Es(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function f_(){return La()==="http:"||La()==="https:"}function La(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}function p_(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(f_()||kh()||"connection"in navigator)?navigator.onLine:!0}function m_(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class Jn{constructor(e,n){this.shortDelay=e,this.longDelay=n,We(n>e,"Short delay should be less than long delay!"),this.isMobile=Ph()||Nh()}get(){return p_()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function To(t,e){We(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class Fu{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;qe("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;qe("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;qe("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const g_={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const __=new Jn(3e4,6e4);function wo(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function nn(t,e,n,r,i={}){return Uu(t,i,async()=>{let s={},o={};r&&(e==="GET"?o=r:s={body:JSON.stringify(r)});const a=Mn(Object.assign({key:t.config.apiKey},o)).slice(1),c=await t._getAdditionalHeaders();return c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode),Fu.fetch()(Bu(t,t.config.apiHost,n,a),Object.assign({method:e,headers:c,referrerPolicy:"no-referrer"},s))})}async function Uu(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},g_),e);try{const i=new v_(t),s=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const o=await s.json();if("needConfirmation"in o)throw ur(t,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[c,l]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw ur(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw ur(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw ur(t,"user-disabled",o);const u=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw xu(t,u,l);Ue(t,u)}}catch(i){if(i instanceof Ge)throw i;Ue(t,"network-request-failed",{message:String(i)})}}async function y_(t,e,n,r,i={}){const s=await nn(t,e,n,r,i);return"mfaPendingCredential"in s&&Ue(t,"multi-factor-auth-required",{_serverResponse:s}),s}function Bu(t,e,n,r){const i=`${e}${n}?${r}`;return t.config.emulator?To(t.config,i):`${t.config.apiScheme}://${i}`}class v_{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Le(this.auth,"network-request-failed")),__.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function ur(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Le(t,e,r);return i.customData._tokenResponse=n,i}async function E_(t,e){return nn(t,"POST","/v1/accounts:delete",e)}async function I_(t,e){return nn(t,"POST","/v1/accounts:lookup",e)}function gn(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function T_(t,e=!1){const n=Re(t),r=await n.getIdToken(e),i=Ao(r);V(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s=typeof i.firebase=="object"?i.firebase:void 0,o=s==null?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:gn(zi(i.auth_time)),issuedAtTime:gn(zi(i.iat)),expirationTime:gn(zi(i.exp)),signInProvider:o||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function zi(t){return Number(t)*1e3}function Ao(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return _r("JWT malformed, contained fewer than 3 sections"),null;try{const i=lc(n);return i?JSON.parse(i):(_r("Failed to decode base64 JWT payload"),null)}catch(i){return _r("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function w_(t){const e=Ao(t);return V(e,"internal-error"),V(typeof e.exp<"u","internal-error"),V(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Dn(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Ge&&A_(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function A_({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class R_{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const i=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class qu{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=gn(this.lastLoginAt),this.creationTime=gn(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Br(t){var e;const n=t.auth,r=await t.getIdToken(),i=await Dn(t,I_(n,{idToken:r}));V(i==null?void 0:i.users.length,n,"internal-error");const s=i.users[0];t._notifyReloadListener(s);const o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?b_(s.providerUserInfo):[],a=C_(t.providerData,o),c=t.isAnonymous,l=!(t.email&&s.passwordHash)&&!(a!=null&&a.length),u=c?l:!1,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new qu(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(t,f)}async function S_(t){const e=Re(t);await Br(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function C_(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function b_(t){return t.map(e=>{var{providerId:n}=e,r=Eo(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}async function P_(t,e){const n=await Uu(t,{},async()=>{const r=Mn({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=t.config,o=Bu(t,i,"/v1/token",`key=${s}`),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Fu.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function k_(t,e){return nn(t,"POST","/v2/accounts:revokeToken",wo(t,e))}class Vn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){V(e.idToken,"internal-error"),V(typeof e.idToken<"u","internal-error"),V(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):w_(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}async getToken(e,n=!1){return V(!this.accessToken||this.refreshToken,e,"user-token-expired"),!n&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:s}=await P_(e,n);this.updateTokensAndExpiration(r,i,Number(s))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:s}=n,o=new Vn;return r&&(V(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(V(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(V(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Vn,this.toJSON())}_performRefresh(){return qe("not implemented")}}function Ke(t,e){V(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class mt{constructor(e){var{uid:n,auth:r,stsTokenManager:i}=e,s=Eo(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new R_(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new qu(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await Dn(this,this.stsTokenManager.getToken(this.auth,e));return V(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return T_(this,e)}reload(){return S_(this)}_assign(e){this!==e&&(V(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new mt(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){V(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await Br(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Dn(this,E_(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,i,s,o,a,c,l,u;const f=(r=n.displayName)!==null&&r!==void 0?r:void 0,p=(i=n.email)!==null&&i!==void 0?i:void 0,_=(s=n.phoneNumber)!==null&&s!==void 0?s:void 0,O=(o=n.photoURL)!==null&&o!==void 0?o:void 0,S=(a=n.tenantId)!==null&&a!==void 0?a:void 0,w=(c=n._redirectEventId)!==null&&c!==void 0?c:void 0,q=(l=n.createdAt)!==null&&l!==void 0?l:void 0,G=(u=n.lastLoginAt)!==null&&u!==void 0?u:void 0,{uid:Y,emailVerified:ve,isAnonymous:Ee,providerData:v,stsTokenManager:y}=n;V(Y&&y,e,"internal-error");const h=Vn.fromJSON(this.name,y);V(typeof Y=="string",e,"internal-error"),Ke(f,e.name),Ke(p,e.name),V(typeof ve=="boolean",e,"internal-error"),V(typeof Ee=="boolean",e,"internal-error"),Ke(_,e.name),Ke(O,e.name),Ke(S,e.name),Ke(w,e.name),Ke(q,e.name),Ke(G,e.name);const d=new mt({uid:Y,auth:e,email:p,emailVerified:ve,displayName:f,isAnonymous:Ee,photoURL:O,phoneNumber:_,tenantId:S,stsTokenManager:h,createdAt:q,lastLoginAt:G});return v&&Array.isArray(v)&&(d.providerData=v.map(A=>Object.assign({},A))),w&&(d._redirectEventId=w),d}static async _fromIdTokenResponse(e,n,r=!1){const i=new Vn;i.updateFromServerResponse(n);const s=new mt({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await Br(s),s}}const Ma=new Map;function je(t){We(t instanceof Function,"Expected a class definition");let e=Ma.get(t);return e?(We(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Ma.set(t,e),e)}class ju{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}ju.type="NONE";const xa=ju;function yr(t,e,n){return`firebase:${t}:${e}:${n}`}class Ot{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:s}=this.auth;this.fullUserKey=yr(this.userKey,i.apiKey,s),this.fullPersistenceKey=yr("persistence",i.apiKey,s),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?mt._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Ot(je(xa),e,r);const i=(await Promise.all(n.map(async l=>{if(await l._isAvailable())return l}))).filter(l=>l);let s=i[0]||je(xa);const o=yr(r,e.config.apiKey,e.name);let a=null;for(const l of n)try{const u=await l._get(o);if(u){const f=mt._fromJSON(e,u);l!==s&&(a=f),s=l;break}}catch{}const c=i.filter(l=>l._shouldAllowMigration);return!s._shouldAllowMigration||!c.length?new Ot(s,e,r):(s=c[0],a&&await s._set(o,a.toJSON()),await Promise.all(n.map(async l=>{if(l!==s)try{await l._remove(o)}catch{}})),new Ot(s,e,r))}}function Fa(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Hu(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if($u(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Gu(e))return"Blackberry";if(Ku(e))return"Webos";if(Ro(e))return"Safari";if((e.includes("chrome/")||zu(e))&&!e.includes("edge/"))return"Chrome";if(Wu(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function $u(t=ge()){return/firefox\//i.test(t)}function Ro(t=ge()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function zu(t=ge()){return/crios\//i.test(t)}function Hu(t=ge()){return/iemobile/i.test(t)}function Wu(t=ge()){return/android/i.test(t)}function Gu(t=ge()){return/blackberry/i.test(t)}function Ku(t=ge()){return/webos/i.test(t)}function Ii(t=ge()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function N_(t=ge()){var e;return Ii(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function D_(){return Dh()&&document.documentMode===10}function Qu(t=ge()){return Ii(t)||Wu(t)||Ku(t)||Gu(t)||/windows phone/i.test(t)||Hu(t)}function V_(){try{return!!(window&&window!==window.top)}catch{return!1}}function Xu(t,e=[]){let n;switch(t){case"Browser":n=Fa(ge());break;case"Worker":n=`${Fa(ge())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Qt}/${r}`}class O_{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=s=>new Promise((o,a)=>{try{const c=e(s);o(c)}catch(c){a(c)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}async function L_(t,e={}){return nn(t,"GET","/v2/passwordPolicy",wo(t,e))}const M_=6;class x_{constructor(e){var n,r,i,s;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=o.minPasswordLength)!==null&&n!==void 0?n:M_,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,r,i,s,o,a;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(n=c.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),c.isValid&&(c.isValid=(r=c.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(i=c.containsLowercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(s=c.containsUppercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(a=c.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),c}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class F_{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ua(this),this.idTokenSubscription=new Ua(this),this.beforeStateQueue=new O_(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Mu,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=je(n)),this._initializationPromise=this.queue(async()=>{var r,i;if(!this._deleted&&(this.persistenceManager=await Ot.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var n;const r=await this.assertedPersistence.getCurrentUser();let i=r,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,a=i==null?void 0:i._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===a)&&(c!=null&&c.user)&&(i=c.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return V(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Br(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=m_()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const n=e?Re(e):null;return n&&V(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&V(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(je(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await L_(this),n=new x_(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Ln("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await k_(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&je(e)||this._popupRedirectResolver;V(n,this,"argument-error"),this.redirectPersistenceManager=await Ot.create(this,[je(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const s=typeof n=="function"?n:n.next.bind(n);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(V(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,r,i);return()=>{o=!0,c()}}else{const c=e.addObserver(n);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return V(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Xu(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={["X-Client-Version"]:this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(n["X-Firebase-Client"]=r);const i=await this._getAppCheckToken();return i&&(n["X-Firebase-AppCheck"]=i),n}async _getAppCheckToken(){var e;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&h_(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function Ti(t){return Re(t)}class Ua{constructor(e){this.auth=e,this.observer=null,this.addObserver=Uh(n=>this.observer=n)}get next(){return V(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function U_(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}function B_(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const s=Le("internal-error");s.customData=i,n(s)},r.type="text/javascript",r.charset="UTF-8",U_().appendChild(r)})}function q_(t){return`__${t}${Math.floor(Math.random()*1e6)}`}function j_(t,e){const n=Rs(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),s=n.getOptions();if(wr(s,e??{}))return i;Ue(i,"already-initialized")}return n.initialize({options:e})}function $_(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(je);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function z_(t,e,n){const r=Ti(t);V(r._canInitEmulator,r,"emulator-config-failed"),V(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!!(n!=null&&n.disableWarnings),s=Ju(e),{host:o,port:a}=H_(e),c=a===null?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||W_()}function Ju(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function H_(t){const e=Ju(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const s=i[1];return{host:s,port:Ba(r.substr(s.length+1))}}else{const[s,o]=r.split(":");return{host:s,port:Ba(o)}}}function Ba(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function W_(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class Yu{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return qe("not implemented")}_getIdTokenResponse(e){return qe("not implemented")}_linkToIdToken(e,n){return qe("not implemented")}_getReauthenticationResolver(e){return qe("not implemented")}}async function Lt(t,e){return y_(t,"POST","/v1/accounts:signInWithIdp",wo(t,e))}const G_="http://localhost";class It extends Yu{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new It(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Ue("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=n,s=Eo(n,["providerId","signInMethod"]);if(!r||!i)return null;const o=new It(r,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return Lt(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Lt(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Lt(e,n)}buildRequest(){const e={requestUri:G_,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Mn(n)}return e}}class So{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Yn extends So{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Qe extends Yn{constructor(){super("facebook.com")}static credential(e){return It._fromParams({providerId:Qe.PROVIDER_ID,signInMethod:Qe.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Qe.credentialFromTaggedObject(e)}static credentialFromError(e){return Qe.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Qe.credential(e.oauthAccessToken)}catch{return null}}}Qe.FACEBOOK_SIGN_IN_METHOD="facebook.com";Qe.PROVIDER_ID="facebook.com";class Se extends Yn{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return It._fromParams({providerId:Se.PROVIDER_ID,signInMethod:Se.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Se.credentialFromTaggedObject(e)}static credentialFromError(e){return Se.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Se.credential(n,r)}catch{return null}}}Se.GOOGLE_SIGN_IN_METHOD="google.com";Se.PROVIDER_ID="google.com";class Xe extends Yn{constructor(){super("github.com")}static credential(e){return It._fromParams({providerId:Xe.PROVIDER_ID,signInMethod:Xe.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Xe.credentialFromTaggedObject(e)}static credentialFromError(e){return Xe.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Xe.credential(e.oauthAccessToken)}catch{return null}}}Xe.GITHUB_SIGN_IN_METHOD="github.com";Xe.PROVIDER_ID="github.com";class Je extends Yn{constructor(){super("twitter.com")}static credential(e,n){return It._fromParams({providerId:Je.PROVIDER_ID,signInMethod:Je.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Je.credentialFromTaggedObject(e)}static credentialFromError(e){return Je.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Je.credential(n,r)}catch{return null}}}Je.TWITTER_SIGN_IN_METHOD="twitter.com";Je.PROVIDER_ID="twitter.com";class Kt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const s=await mt._fromIdTokenResponse(e,r,i),o=qa(r);return new Kt({user:s,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=qa(r);return new Kt({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function qa(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class qr extends Ge{constructor(e,n,r,i){var s;super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,qr.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new qr(e,n,r,i)}}function Zu(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?qr._fromErrorAndOperation(t,s,e,r):s})}async function K_(t,e,n=!1){const r=await Dn(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Kt._forOperation(t,"link",r)}async function Q_(t,e,n=!1){const{auth:r}=t,i="reauthenticate";try{const s=await Dn(t,Zu(r,i,e,t),n);V(s.idToken,r,"internal-error");const o=Ao(s.idToken);V(o,r,"internal-error");const{sub:a}=o;return V(t.uid===a,r,"user-mismatch"),Kt._forOperation(t,i,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&Ue(r,"user-mismatch"),s}}async function X_(t,e,n=!1){const r="signIn",i=await Zu(t,r,e),s=await Kt._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(s.user),s}function J_(t,e,n,r){return Re(t).onIdTokenChanged(e,n,r)}function Y_(t,e,n){return Re(t).beforeAuthStateChanged(e,n)}function Z_(t){return Re(t).signOut()}const jr="__sak";class eh{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(jr,"1"),this.storage.removeItem(jr),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}function ey(){const t=ge();return Ro(t)||Ii(t)}const ty=1e3,ny=10;class th extends eh{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=ey()&&V_(),this.fallbackToPolling=Qu(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,c)=>{this.notifyListeners(o,c)});return}const r=e.key;if(n?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const o=this.storage.getItem(r);if(e.newValue!==o)e.newValue!==null?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!n)return}const i=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},s=this.storage.getItem(r);D_()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,ny):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},ty)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}th.type="LOCAL";const ry=th;class nh extends eh{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}nh.type="SESSION";const rh=nh;function iy(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class wi{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new wi(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:s}=n.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const a=Array.from(o).map(async l=>l(n.origin,s)),c=await iy(a);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}wi.receivers=[];function Co(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}class sy{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,c)=>{const l=Co("",20);i.port1.start();const u=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(f){const p=f;if(p.data.eventId===l)switch(p.data.status){case"ack":clearTimeout(u),s=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(p.data.response);break;default:clearTimeout(u),clearTimeout(s),c(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:l,data:n},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}function Me(){return window}function oy(t){Me().location.href=t}function ih(){return typeof Me().WorkerGlobalScope<"u"&&typeof Me().importScripts=="function"}async function ay(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function cy(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function ly(){return ih()?self:null}const sh="firebaseLocalStorageDb",uy=1,$r="firebaseLocalStorage",oh="fbase_key";class Zn{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Ai(t,e){return t.transaction([$r],e?"readwrite":"readonly").objectStore($r)}function hy(){const t=indexedDB.deleteDatabase(sh);return new Zn(t).toPromise()}function Is(){const t=indexedDB.open(sh,uy);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore($r,{keyPath:oh})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains($r)?e(r):(r.close(),await hy(),e(await Is()))})})}async function ja(t,e,n){const r=Ai(t,!0).put({[oh]:e,value:n});return new Zn(r).toPromise()}async function dy(t,e){const n=Ai(t,!1).get(e),r=await new Zn(n).toPromise();return r===void 0?null:r.value}function $a(t,e){const n=Ai(t,!0).delete(e);return new Zn(n).toPromise()}const fy=800,py=3;class ah{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Is(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>py)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ih()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=wi._getInstance(ly()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await ay(),!this.activeServiceWorker)return;this.sender=new sy(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((n=r[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||cy()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Is();return await ja(e,jr,"1"),await $a(e,jr),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>ja(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>dy(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>$a(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const s=Ai(i,!1).getAll();return new Zn(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:s}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),fy)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}ah.type="LOCAL";const my=ah;new Jn(3e4,6e4);function ch(t,e){return e?je(e):(V(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class bo extends Yu{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Lt(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Lt(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Lt(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function gy(t){return X_(t.auth,new bo(t),t.bypassAuthState)}function _y(t){const{auth:e,user:n}=t;return V(n,e,"internal-error"),Q_(n,new bo(t),t.bypassAuthState)}async function yy(t){const{auth:e,user:n}=t;return V(n,e,"internal-error"),K_(n,new bo(t),t.bypassAuthState)}class lh{constructor(e,n,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:n,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(c))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return gy;case"linkViaPopup":case"linkViaRedirect":return yy;case"reauthViaPopup":case"reauthViaRedirect":return _y;default:Ue(this.auth,"internal-error")}}resolve(e){We(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){We(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const vy=new Jn(2e3,1e4);async function Ey(t,e,n){const r=Ti(t);d_(t,e,So);const i=ch(r,n);return new ft(r,"signInViaPopup",e,i).executeNotNull()}class ft extends lh{constructor(e,n,r,i,s){super(e,n,i,s),this.provider=r,this.authWindow=null,this.pollId=null,ft.currentPopupAction&&ft.currentPopupAction.cancel(),ft.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return V(e,this.auth,"internal-error"),e}async onExecution(){We(this.filter.length===1,"Popup operations only handle one event");const e=Co();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Le(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Le(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ft.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if(!((r=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Le(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,vy.get())};e()}}ft.currentPopupAction=null;const Iy="pendingRedirect",vr=new Map;class Ty extends lh{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=vr.get(this.auth._key());if(!e){try{const r=await wy(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}vr.set(this.auth._key(),e)}return this.bypassAuthState||vr.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function wy(t,e){const n=Sy(e),r=Ry(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function Ay(t,e){vr.set(t._key(),e)}function Ry(t){return je(t._redirectPersistence)}function Sy(t){return yr(Iy,t.config.apiKey,t.name)}async function Cy(t,e,n=!1){const r=Ti(t),i=ch(r,e),o=await new Ty(r,i,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}const by=10*60*1e3;class Py{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!ky(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!uh(e)){const i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(Le(this.auth,i))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=by&&this.cachedEventUids.clear(),this.cachedEventUids.has(za(e))}saveEventToCache(e){this.cachedEventUids.add(za(e)),this.lastProcessedEventTime=Date.now()}}function za(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function uh({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function ky(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return uh(t);default:return!1}}async function Ny(t,e={}){return nn(t,"GET","/v1/projects",e)}const Dy=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Vy=/^https?/;async function Oy(t){if(t.config.emulator)return;const{authorizedDomains:e}=await Ny(t);for(const n of e)try{if(Ly(n))return}catch{}Ue(t,"unauthorized-domain")}function Ly(t){const e=Es(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!Vy.test(n))return!1;if(Dy.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const My=new Jn(3e4,6e4);function Ha(){const t=Me().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function xy(t){return new Promise((e,n)=>{var r,i,s;function o(){Ha(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Ha(),n(Le(t,"network-request-failed"))},timeout:My.get()})}if(!((i=(r=Me().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=Me().gapi)===null||s===void 0)&&s.load)o();else{const a=q_("iframefcb");return Me()[a]=()=>{gapi.load?o():n(Le(t,"network-request-failed"))},B_(`https://apis.google.com/js/api.js?onload=${a}`).catch(c=>n(c))}}).catch(e=>{throw Er=null,e})}let Er=null;function Fy(t){return Er=Er||xy(t),Er}const Uy=new Jn(5e3,15e3),By="__/auth/iframe",qy="emulator/auth/iframe",jy={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},$y=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function zy(t){const e=t.config;V(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?To(e,qy):`https://${t.config.authDomain}/${By}`,r={apiKey:e.apiKey,appName:t.name,v:Qt},i=$y.get(t.config.apiHost);i&&(r.eid=i);const s=t._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${Mn(r).slice(1)}`}async function Hy(t){const e=await Fy(t),n=Me().gapi;return V(n,t,"internal-error"),e.open({where:document.body,url:zy(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:jy,dontclear:!0},r=>new Promise(async(i,s)=>{await r.restyle({setHideOnLeave:!1});const o=Le(t,"network-request-failed"),a=Me().setTimeout(()=>{s(o)},Uy.get());function c(){Me().clearTimeout(a),i(r)}r.ping(c).then(c,()=>{s(o)})}))}const Wy={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Gy=500,Ky=600,Qy="_blank",Xy="http://localhost";class Wa{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Jy(t,e,n,r=Gy,i=Ky){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},Wy),{width:r.toString(),height:i.toString(),top:s,left:o}),l=ge().toLowerCase();n&&(a=zu(l)?Qy:n),$u(l)&&(e=e||Xy,c.scrollbars="yes");const u=Object.entries(c).reduce((p,[_,O])=>`${p}${_}=${O},`,"");if(N_(l)&&a!=="_self")return Yy(e||"",a),new Wa(null);const f=window.open(e||"",a,u);V(f,t,"popup-blocked");try{f.focus()}catch{}return new Wa(f)}function Yy(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const Zy="__/auth/handler",ev="emulator/auth/handler",tv=encodeURIComponent("fac");async function Ga(t,e,n,r,i,s){V(t.config.authDomain,t,"auth-domain-config-required"),V(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Qt,eventId:i};if(e instanceof So){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",Fh(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,f]of Object.entries(s||{}))o[u]=f}if(e instanceof Yn){const u=e.getScopes().filter(f=>f!=="");u.length>0&&(o.scopes=u.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const u of Object.keys(a))a[u]===void 0&&delete a[u];const c=await t._getAppCheckToken(),l=c?`#${tv}=${encodeURIComponent(c)}`:"";return`${nv(t)}?${Mn(a).slice(1)}${l}`}function nv({config:t}){return t.emulator?To(t,ev):`https://${t.authDomain}/${Zy}`}const Hi="webStorageSupport";class rv{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=rh,this._completeRedirectFn=Cy,this._overrideRedirectResult=Ay}async _openPopup(e,n,r,i){var s;We((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");const o=await Ga(e,n,r,Es(),i);return Jy(e,o,Co())}async _openRedirect(e,n,r,i){await this._originValidation(e);const s=await Ga(e,n,r,Es(),i);return oy(s),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:s}=this.eventManagers[n];return i?Promise.resolve(i):(We(s,"If manager is not set, promise should be"),s)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await Hy(e),r=new Py(e);return n.register("authEvent",i=>(V(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Hi,{type:Hi},i=>{var s;const o=(s=i==null?void 0:i[0])===null||s===void 0?void 0:s[Hi];o!==void 0&&n(!!o),Ue(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=Oy(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return Qu()||Ro()||Ii()}}const iv=rv;var Ka="@firebase/auth",Qa="1.5.1";class sv{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){V(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function ov(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function av(t){Ft(new gt("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;V(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Xu(t)},l=new F_(r,i,s,c);return $_(l,n),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Ft(new gt("auth-internal",e=>{const n=Ti(e.getProvider("auth").getImmediate());return(r=>new sv(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),tt(Ka,Qa,ov(t)),tt(Ka,Qa,"esm2017")}const cv=5*60,lv=dc("authIdTokenMaxAge")||cv;let Xa=null;const uv=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>lv)return;const i=n==null?void 0:n.token;Xa!==i&&(Xa=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function hv(t=gc()){const e=Rs(t,"auth");if(e.isInitialized())return e.getImmediate();const n=j_(t,{popupRedirectResolver:iv,persistence:[my,ry,rh]}),r=dc("authTokenSyncURL");if(r){const s=uv(r);Y_(n,s,()=>s(n.currentUser)),J_(n,o=>s(o))}const i=uc("auth");return i&&z_(n,`http://${i}`),n}av("Browser");const dv={apiKey:"AIzaSyBNBMjRxNAY7Ev3P0n12UWF7CdjphLNQ5M",authDomain:"hosting-test-2fa75.firebaseapp.com",projectId:"hosting-test-2fa75",storageBucket:"hosting-test-2fa75.appspot.com",messagingSenderId:"882269537085",appId:"1:882269537085:web:b0e1d25d79d88d76b4bb54"},hh=mc(dv),Po=hv(hh),ko=jg(hh),fv=async t=>{const e=Po.currentUser;if(e){const n=t;try{o_(Tu(ko,e.email,t._id),n)}catch(r){console.log(r.message)}}},pv=async t=>{const e=localStorage.getItem("user");if(e)try{a_(Tu(ko,e,t))}catch(n){console.log(n.message)}},dh=async()=>{const t=localStorage.getItem("user"),e=[];if(!t)return;(await s_(Bg(ko,t))).forEach(r=>{e.push(r.data())}),localStorage.setItem("favorites",JSON.stringify(e))};function On(){dh();const t=JSON.parse(localStorage.getItem("favorites"));if(!(t!=null&&t.length)){_h();return}yh(t)}const Ja=document.getElementById("home"),Ya=document.getElementById("favorites"),Za=document.getElementById("home-text"),ec=document.getElementById("favorites-text");document.getElementById("navigation");const mv=document.getElementById("sign-in-js"),gv=document.getElementById("sign-out"),_v=window.location.href.toString();let yv=_v.slice(-14);const vv=()=>{yv==="favorites.html"?(Ja.classList.remove("active"),Za.classList.remove("black"),Ya.classList.add("active"),ec.classList.add("black"),mv.classList.add("visually-hidden"),gv.classList.add("visually-hidden"),On()):(Ja.classList.add("active"),Za.classList.add("black"),Ya.classList.remove("active"),ec.classList.remove("black"))};vv();const Ev=document.getElementById("burger-button"),No=document.getElementById("burger"),Iv=document.getElementById("burger-button-close"),Tv=async()=>{document.getElementById("header").classList.remove("container"),No.classList.remove("visually-hidden"),document.body.classList.add("disable-scroll")},wv=async t=>{document.getElementById("header").classList.add("container"),No.classList.add("visually-hidden"),document.body.classList.remove("disable-scroll")},Av=t=>{t.key==="Escape"&&No.classList.add("visually-hidden"),document.body.classList.remove("disable-scroll")};Ev.addEventListener("click",Tv);Iv.addEventListener("click",wv);document.addEventListener("keydown",Av);const Rv=new Se,Tt=document.getElementById("sign-in"),Ri=document.getElementById("sign-out"),Do=document.getElementById("user");Do.innerHTML=localStorage.getItem("user");const Sv=window.location.href.toString();localStorage.getItem("user")&&(Ri.classList.remove("display-none"),Tt.classList.add("display-none"),Tt.style.display="none");const Cv=async()=>{await Ey(Po,Rv).then(t=>{Se.credentialFromResult(t).accessToken;const n=t.user;localStorage.user=n.email,Do.innerHTML=localStorage.getItem("user"),Ri.classList.remove("display-none"),Tt.classList.add("display-none"),Tt.style.display="none",dh()}).catch(t=>{const e=t.message;console.log(e),Se.credentialFromError(t)})},bv=async()=>{await Z_(Po).then(()=>{Do.innerHTML="",localStorage.removeItem("user"),Sv.slice(-14)===favorites.html&&On()}).catch(t=>{console.log(t.message)}),Ri.classList.add("display-none"),Tt.classList.remove("display-none"),Tt.style.display="flex",localStorage.removeItem("favorites")};Tt.addEventListener("click",Cv);Ri.addEventListener("click",bv);class Pv{constructor(){this.overlay=document.querySelector(".overlay"),this.modal=document.querySelector(".modal-info"),this.closeButton,this.closeButtonHandler=()=>this.close(),this.escapeKeyHandler=e=>this.closeEsc(e),this.overlayClickHandler=e=>this.closeBack(e)}open(e){this.overlay.innerHTML=e,this.overlay.style.zIndex=3,this.overlay.style.display="flex",this.modal.classList.remove("visually-hidden"),this.closeButton=document.querySelector(".modal-button-close"),document.body.classList.add("no-scroll"),this.closeButton.addEventListener("click",this.closeButtonHandler),document.addEventListener("keydown",this.escapeKeyHandler),this.overlay.addEventListener("click",this.overlayClickHandler)}close(){this.modal=document.querySelector(".modal-info")||document.querySelector(".modal-get-raiting"),this.overlay.style.display="none",this.overlay.style.zIndex=-1,this.modal.classList.add("visually-hidden"),document.body.classList.remove("no-scroll"),this.closeButton.removeEventListener("click",this.closeButtonHandler),document.removeEventListener("keydown",this.escapeKeyHandler),this.overlay.removeEventListener("click",this.overlayClickHandler)}closeEsc(e){e.key==="Escape"&&this.close()}closeBack(e){e.target===this.overlay&&this.close()}}const zr=new Pv,Q=class{static handleErrors(e){return async()=>{try{return await e()}catch(n){console.error("Помилка при запиті: ",n.message)}}}static async fetchJson(e,n){return(await fetch(e,n)).json()}async getQuotes(){return await Q.handleErrors(async()=>await Q.fetchJson(`${Q.BASE_URL}/quote`))()}async getByFilterName(e){return await Q.handleErrors(async()=>{const r=new URLSearchParams({...e});return await Q.fetchJson(`${Q.BASE_URL}/filters?${r}`)})()}async getByFilterCategory(e){return await Q.handleErrors(async()=>{const r=new URLSearchParams({...e});return await Q.fetchJson(`${Q.BASE_URL}/exercises?${r}`)})()}async getOneExercises(e){return await Q.handleErrors(async()=>await Q.fetchJson(`${Q.BASE_URL}/exercises/${e}`))()}async addExercisesRate(e,n){return await Q.handleErrors(async()=>{const i={method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)};return await Q.fetchJson(`${Q.BASE_URL}/exercises/${e}/rating`,i)})()}async addSubscription(e){return await Q.handleErrors(async()=>{const r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return await Q.fetchJson(`${Q.BASE_URL}/subscription`,r)})()}};let Ir=Q;Vo(Ir,"BASE_URL","https://your-energy.b.goit.study/api");const Si=new Ir,Hr={quoteText:document.querySelector(".quote-text"),quoteAuthor:document.querySelector(".quote-author")};document.addEventListener("DOMContentLoaded",kv);async function kv(){const t=localStorage.getItem("quote");if(t){const e=new Date().toDateString(),{date:n,quote:r,author:i}=JSON.parse(t);e!==n?tc():(Hr.quoteText.innerHTML=r,Hr.quoteAuthor.innerHTML=i)}else tc()}async function tc(){const t=await Si.getQuotes(),{author:e,quote:n}=t,r={author:e,quote:n,date:new Date().toDateString()};localStorage.setItem("quote",JSON.stringify(r)),Hr.quoteText.innerHTML=n,Hr.quoteAuthor.innerHTML=e}function Nv(){const t=document.createElement("button");t.className="scroll-up-button hidden";const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("viewBox","0 0 32 32"),e.setAttribute("class","button-icon");const n=document.createElementNS("http://www.w3.org/2000/svg","use");n.setAttributeNS("http://www.w3.org/1999/xlink","href",`${oe}#icon-arrow`),e.appendChild(n),t.appendChild(e),t.addEventListener("click",function(){window.scrollTo({top:0,behavior:"smooth"})}),document.addEventListener("scroll",function(){window.scrollY>50?t.classList.remove("hidden"):t.classList.add("hidden")}),document.body.appendChild(t)}Nv();function Dv(t){if(t)return t[0].toUpperCase()+t.slice(1)}function Vv(t){const e=(t%1).toFixed(1)*100;let n='<div class="rating-container-not-cursore" data-rating="0">';for(let r=1;r<=t+1;r+=1)r<=t?n+=`<span class="star-js selected" data-value="${r}"><svg class="exercises_btn_start_icon_modal star-js selected">
              <use xlink:href="${oe}#icon-star"></use>
              />
            </svg></span>`:e>0&&(n+=`<span class="last-star-js" data-value="${r}"><svg xmlns="http://www.w3.org/2000/svg" width="16" viewBox="0 0 20 19" fill="none">
                    <path d="M9.04894 0.927052C9.3483 0.00574112 10.6517 0.00573993 10.9511 0.927051L12.4697 5.60081C12.6035 6.01284 12.9875 6.2918 13.4207 6.2918H18.335C19.3037 6.2918 19.7065 7.53141 18.9228 8.10081L14.947 10.9894C14.5966 11.244 14.4499 11.6954 14.5838 12.1074L16.1024 16.7812C16.4017 17.7025 15.3472 18.4686 14.5635 17.8992L10.5878 15.0106C10.2373 14.756 9.7627 14.756 9.41221 15.0106L5.43648 17.8992C4.65276 18.4686 3.59828 17.7025 3.89763 16.7812L5.41623 12.1074C5.55011 11.6954 5.40345 11.244 5.05296 10.9894L1.07722 8.10081C0.293507 7.53141 0.696283 6.2918 1.66501 6.2918H6.57929C7.01252 6.2918 7.39647 6.01284 7.53035 5.60081L9.04894 0.927052Z" fill="url(#paint0_linear_126_18474)"/>
                    <defs>
                    <linearGradient id="paint0_linear_126_18474" x1="20" y1="10" x2="-1.99998" y2="10.0209" gradientUnits="userSpaceOnUse">
                    <stop offset="${100-e}%" stop-color="rgba(244, 244, 244, 0.20)" />
                    <stop offset="${e}%" stop-color="#EEA10C" />
                    </linearGradient>
                    </defs>
                  </svg></span>`);for(let r=t+1;r<=5;r+=1)n+=`<span class="star-js" data-value="${r}"><svg class="exercises_btn_start_icon_modal star-js">
              <use xlink:href="${oe}#icon-star"></use>
              />
            </svg></span>`;return n+"</div>"}function Ov(t){return t?`<button class="add-favorite-js" type="button" style="font-size: 14px;">
              <span class="remote-favorites">Remove from favorites</span>
              <svg class="trash-icon-img" width="15" height="15" aria-label="trash-icon">
                  <use href="${oe}#icon-trash"></use>
              </svg>
          </button>`:`<button class="add-favorite-js" type="button" style="font-size: 14px;">
                <span>Add to favorites</span>
                <svg class="heart-icon-img" width="20" height="20" aria-label="heart-icon">
                    <use href="${oe}#icon-heart"></use>
                </svg>
              </button>`}function Lv(t){return`<div class="modal-info" data-id="${t._id}">
     <button class="modal-button-close" id="button-close">
      <svg class="close-icon-img" width="20" height="20" aria-label="close-icon">
        <use href="${oe}#icon-close"></use>
      </svg>
    </button>
    <div class="modal-image-vrapper">
      <img loading="lazy" class="modal-img" src="${t.gifUrl}" alt="${t.name}" />
    </div>
    <div class="modal-content-wrapper">
      <div class="card-wrapper">
        <h3 class="title-card-modal">${Dv(t.name)}</h3>
        <div class="rating-modal-container-wrapper"><p>${t.rating.toFixed(1)}</p>${Vv(t.rating)}</div>
      </div>
      <hr class="modal-decoration-line" />
      <ul class="modal-table">
        <li>
          <h4 class="title-collum">Target</h4>
          <p class="data-collumn">${t.target}</p>
        </li>
        <li>
          <h4 class="title-collum">Body Part</h4>
          <p class="data-collumn">${t.bodyPart}</p>
        </li>
        <li>
          <h4 class="title-collum">Equipment</h4>
          <p class="data-collumn">${t.equipment}</p>
        </li>
        <li>
          <h4 class="title-collum">Popular</h4>
          <p class="data-collumn">${t.popularity}</p>
        </li>
        <li>
          <h4 class="title-collum">Burned Calories</h4>
          <p class="data-collumn">${t.burnedCalories}/${t.time} min</p>
        </li>
      </ul>
      <hr class="modal-decoration-line" />
      <p class="about-exercise">
        ${t.description}
      </p>
      <div class="button-section-modal">
        <div class="refresh-button-js" data-favorite="${t.favorite}">
          ${Ov(t.favorite)}
        </div>
        <button class="add-rating" type="button" style="font-size: 14px;">Give a rating</button>
      </div>`}function Mv(t){return`<div class="modal-get-raiting" data-id="${t}">
    <button class="modal-button-close" id="button-close">
      <svg class="close-icon-img" width="20" height="20" aria-label="close-icon">
        <use href="${oe}#icon-close"></use>
      </svg>
    </button>
    <div class="get-rating-container">
      <div class="get-rating-choise">
        <h3 class="title-card-get-rating">Rating</h3>
        <div class="rating-container-js rating-container" data-rating="" data-id="">
          <p class="user-rating-js">0</p>
          <span class="star-js" data-value="1"><svg class="exercises_btn_start_icon_rating star-js" wirth="15px" height="15px">
              <use xlink:href="${oe}#icon-star"></use>
              />
            </svg></span>
          <span class="star-js" data-value="2"><svg class="exercises_btn_start_icon_rating star-js" wirth="15px" height="15px">
              <use xlink:href="${oe}#icon-star"></use>
              />
            </svg></span>
          <span class="star-js" data-value="3"><svg class="exercises_btn_start_icon_rating star-js" wirth="15px" height="15px">
              <use xlink:href="${oe}#icon-star"></use>
              />
            </svg></span>
          <span class="star-js" data-value="4"><svg class="exercises_btn_start_icon_rating star-js" wirth="15px" height="15px">
              <use xlink:href="${oe}#icon-star"></use>
              />
            </svg></span>
          <span class="star-js" data-value="5"><svg class="exercises_btn_start_icon_rating star-js" wirth="15px" height="15px">
              <use xlink:href="${oe}#icon-star"></use>
              />
            </svg></span>
        </div>
      <form class="form raiting-form">
        <label class="raiting-form-field">
          <input
            type="Email"
            class="raiting-form-field-input"
            name="user_email"
            placeholder="Email"
            required
          />
        </label>
        <label class="form-comment">
          <textarea
            class="raiting-form-field-comment"
            name="user_comment"
            placeholder="Your comment"
          ></textarea>
        </label>
        <button class="raiting-form-submit" type="submit">Send</button>
      </form>
    </div>
  </div>`}function xv(){const t=document.querySelector(".rating-container-js"),e=t.querySelectorAll(".exercises_btn_start_icon_rating");let n=t.querySelector(".user-rating-js");e.forEach((o,a)=>{o.addEventListener("mouseover",()=>r(a)),o.addEventListener("mouseout",i),o.addEventListener("click",()=>s(a+1))});function r(o){i();for(let a=0;a<=o;a++)e[a].classList.add("hovered"),n.textContent=`${a+1}`}function i(){e.forEach(o=>{const a=t.dataset.rating;o.classList.remove("hovered"),n.textContent=`${a||0}`})}function s(o){t.setAttribute("data-rating",o),e.forEach((a,c)=>{c+1<=o?a.classList.add("selected"):a.classList.remove("selected")})}}let Mt=[];const hr=JSON.parse(localStorage.getItem("favorites"));hr!=null&&hr.length&&Mt.push(...hr);function Fv(t){fv(t),Mt.push(t),localStorage.setItem("favorites",JSON.stringify(Mt))}const fh=t=>{pv(t),Mt=Mt.filter(e=>e._id!==t),localStorage.setItem("favorites",JSON.stringify([...Mt]))};var dr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},xt={},Uv={get exports(){return xt},set exports(t){xt=t}};(function(t,e){(function(n,r){t.exports=r(n)})(typeof dr<"u"?dr:window||dr.window||dr.global,function(n){var r={},i="iziToast";document.querySelector("body");var s=!!/Mobi/.test(navigator.userAgent),o=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),a=typeof InstallTrigger<"u",c="ontouchstart"in document.documentElement,l=["bottomRight","bottomLeft","bottomCenter","topRight","topLeft","topCenter","center"],u={info:{color:"blue",icon:"ico-info"},success:{color:"green",icon:"ico-success"},warning:{color:"orange",icon:"ico-warning"},error:{color:"red",icon:"ico-error"},question:{color:"yellow",icon:"ico-question"}},f=568,p={};r.children={};var _={id:null,class:"",title:"",titleColor:"",titleSize:"",titleLineHeight:"",message:"",messageColor:"",messageSize:"",messageLineHeight:"",backgroundColor:"",theme:"light",color:"",icon:"",iconText:"",iconColor:"",iconUrl:null,image:"",imageWidth:50,maxWidth:null,zindex:null,layout:1,balloon:!1,close:!0,closeOnEscape:!1,closeOnClick:!1,displayMode:0,position:"bottomRight",target:"",targetFirst:!0,timeout:5e3,rtl:!1,animateInside:!0,drag:!0,pauseOnHover:!0,resetOnHover:!1,progressBar:!0,progressBarColor:"",progressBarEasing:"linear",overlay:!1,overlayClose:!1,overlayColor:"rgba(0, 0, 0, 0.6)",transitionIn:"fadeInUp",transitionOut:"fadeOut",transitionInMobile:"fadeInUp",transitionOutMobile:"fadeOutDown",buttons:{},inputs:{},onOpening:function(){},onOpened:function(){},onClosing:function(){},onClosed:function(){}};if("remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),typeof window.CustomEvent!="function"){var O=function(v,y){y=y||{bubbles:!1,cancelable:!1,detail:void 0};var h=document.createEvent("CustomEvent");return h.initCustomEvent(v,y.bubbles,y.cancelable,y.detail),h};O.prototype=window.Event.prototype,window.CustomEvent=O}var S=function(v,y,h){if(Object.prototype.toString.call(v)==="[object Object]")for(var d in v)Object.prototype.hasOwnProperty.call(v,d)&&y.call(h,v[d],d,v);else if(v)for(var A=0,k=v.length;A<k;A++)y.call(h,v[A],A,v)},w=function(v,y){var h={};return S(v,function(d,A){h[A]=v[A]}),S(y,function(d,A){h[A]=y[A]}),h},q=function(v){var y=document.createDocumentFragment(),h=document.createElement("div");for(h.innerHTML=v;h.firstChild;)y.appendChild(h.firstChild);return y},G=function(v){var y=btoa(encodeURIComponent(v));return y.replace(/=/g,"")},Y=function(v){return v.substring(0,1)=="#"||v.substring(0,3)=="rgb"||v.substring(0,3)=="hsl"},ve=function(v){try{return btoa(atob(v))==v}catch{return!1}},Ee=function(){return{move:function(v,y,h,d){var A,k=.3,E=180;d!==0&&(v.classList.add(i+"-dragged"),v.style.transform="translateX("+d+"px)",d>0?(A=(E-d)/E,A<k&&y.hide(w(h,{transitionOut:"fadeOutRight",transitionOutMobile:"fadeOutRight"}),v,"drag")):(A=(E+d)/E,A<k&&y.hide(w(h,{transitionOut:"fadeOutLeft",transitionOutMobile:"fadeOutLeft"}),v,"drag")),v.style.opacity=A,A<k&&((o||a)&&(v.style.left=d+"px"),v.parentNode.style.opacity=k,this.stopMoving(v,null)))},startMoving:function(v,y,h,d){d=d||window.event;var A=c?d.touches[0].clientX:d.clientX,k=v.style.transform.replace("px)","");k=k.replace("translateX(","");var E=A-k;h.transitionIn&&v.classList.remove(h.transitionIn),h.transitionInMobile&&v.classList.remove(h.transitionInMobile),v.style.transition="",c?document.ontouchmove=function(b){b.preventDefault(),b=b||window.event;var U=b.touches[0].clientX,Z=U-E;Ee.move(v,y,h,Z)}:document.onmousemove=function(b){b.preventDefault(),b=b||window.event;var U=b.clientX,Z=U-E;Ee.move(v,y,h,Z)}},stopMoving:function(v,y){c?document.ontouchmove=function(){}:document.onmousemove=function(){},v.style.opacity="",v.style.transform="",v.classList.contains(i+"-dragged")&&(v.classList.remove(i+"-dragged"),v.style.transition="transform 0.4s ease, opacity 0.4s ease",setTimeout(function(){v.style.transition=""},400))}}}();return r.setSetting=function(v,y,h){r.children[v][y]=h},r.getSetting=function(v,y){return r.children[v][y]},r.destroy=function(){S(document.querySelectorAll("."+i+"-overlay"),function(v,y){v.remove()}),S(document.querySelectorAll("."+i+"-wrapper"),function(v,y){v.remove()}),S(document.querySelectorAll("."+i),function(v,y){v.remove()}),this.children={},document.removeEventListener(i+"-opened",{},!1),document.removeEventListener(i+"-opening",{},!1),document.removeEventListener(i+"-closing",{},!1),document.removeEventListener(i+"-closed",{},!1),document.removeEventListener("keyup",{},!1),p={}},r.settings=function(v){r.destroy(),p=v,_=w(_,v||{})},S(u,function(v,y){r[y]=function(h){var d=w(p,h||{});d=w(v,d||{}),this.show(d)}}),r.progress=function(v,y,h){var d=this,A=y.getAttribute("data-iziToast-ref"),k=w(this.children[A],v||{}),E=y.querySelector("."+i+"-progressbar div");return{start:function(){typeof k.time.REMAINING>"u"&&(y.classList.remove(i+"-reseted"),E!==null&&(E.style.transition="width "+k.timeout+"ms "+k.progressBarEasing,E.style.width="0%"),k.time.START=new Date().getTime(),k.time.END=k.time.START+k.timeout,k.time.TIMER=setTimeout(function(){clearTimeout(k.time.TIMER),y.classList.contains(i+"-closing")||(d.hide(k,y,"timeout"),typeof h=="function"&&h.apply(d))},k.timeout),d.setSetting(A,"time",k.time))},pause:function(){if(typeof k.time.START<"u"&&!y.classList.contains(i+"-paused")&&!y.classList.contains(i+"-reseted")){if(y.classList.add(i+"-paused"),k.time.REMAINING=k.time.END-new Date().getTime(),clearTimeout(k.time.TIMER),d.setSetting(A,"time",k.time),E!==null){var b=window.getComputedStyle(E),U=b.getPropertyValue("width");E.style.transition="none",E.style.width=U}typeof h=="function"&&setTimeout(function(){h.apply(d)},10)}},resume:function(){typeof k.time.REMAINING<"u"?(y.classList.remove(i+"-paused"),E!==null&&(E.style.transition="width "+k.time.REMAINING+"ms "+k.progressBarEasing,E.style.width="0%"),k.time.END=new Date().getTime()+k.time.REMAINING,k.time.TIMER=setTimeout(function(){clearTimeout(k.time.TIMER),y.classList.contains(i+"-closing")||(d.hide(k,y,"timeout"),typeof h=="function"&&h.apply(d))},k.time.REMAINING),d.setSetting(A,"time",k.time)):this.start()},reset:function(){clearTimeout(k.time.TIMER),delete k.time.REMAINING,d.setSetting(A,"time",k.time),y.classList.add(i+"-reseted"),y.classList.remove(i+"-paused"),E!==null&&(E.style.transition="none",E.style.width="100%"),typeof h=="function"&&setTimeout(function(){h.apply(d)},10)}}},r.hide=function(v,y,h){typeof y!="object"&&(y=document.querySelector(y));var d=this,A=w(this.children[y.getAttribute("data-iziToast-ref")],v||{});A.closedBy=h||null,delete A.time.REMAINING,y.classList.add(i+"-closing"),function(){var b=document.querySelector("."+i+"-overlay");if(b!==null){var U=b.getAttribute("data-iziToast-ref");U=U.split(",");var Z=U.indexOf(String(A.ref));Z!==-1&&U.splice(Z,1),b.setAttribute("data-iziToast-ref",U.join()),U.length===0&&(b.classList.remove("fadeIn"),b.classList.add("fadeOut"),setTimeout(function(){b.remove()},700))}}(),A.transitionIn&&y.classList.remove(A.transitionIn),A.transitionInMobile&&y.classList.remove(A.transitionInMobile),s||window.innerWidth<=f?A.transitionOutMobile&&y.classList.add(A.transitionOutMobile):A.transitionOut&&y.classList.add(A.transitionOut);var k=y.parentNode.offsetHeight;y.parentNode.style.height=k+"px",y.style.pointerEvents="none",(!s||window.innerWidth>f)&&(y.parentNode.style.transitionDelay="0.2s");try{var E=new CustomEvent(i+"-closing",{detail:A,bubbles:!0,cancelable:!0});document.dispatchEvent(E)}catch(b){console.warn(b)}setTimeout(function(){y.parentNode.style.height="0px",y.parentNode.style.overflow="",setTimeout(function(){delete d.children[A.ref],y.parentNode.remove();try{var b=new CustomEvent(i+"-closed",{detail:A,bubbles:!0,cancelable:!0});document.dispatchEvent(b)}catch(U){console.warn(U)}typeof A.onClosed<"u"&&A.onClosed.apply(null,[A,y,h])},1e3)},200),typeof A.onClosing<"u"&&A.onClosing.apply(null,[A,y,h])},r.show=function(v){var y=this,h=w(p,v||{});if(h=w(_,h),h.time={},h.id===null&&(h.id=G(h.title+h.message+h.color)),h.displayMode===1||h.displayMode=="once")try{if(document.querySelectorAll("."+i+"#"+h.id).length>0)return!1}catch{console.warn("["+i+"] Could not find an element with this selector: #"+h.id+". Try to set an valid id.")}if(h.displayMode===2||h.displayMode=="replace")try{S(document.querySelectorAll("."+i+"#"+h.id),function(E,b){y.hide(h,E,"replaced")})}catch{console.warn("["+i+"] Could not find an element with this selector: #"+h.id+". Try to set an valid id.")}h.ref=new Date().getTime()+Math.floor(Math.random()*1e7+1),r.children[h.ref]=h;var d={body:document.querySelector("body"),overlay:document.createElement("div"),toast:document.createElement("div"),toastBody:document.createElement("div"),toastTexts:document.createElement("div"),toastCapsule:document.createElement("div"),cover:document.createElement("div"),buttons:document.createElement("div"),inputs:document.createElement("div"),icon:h.iconUrl?document.createElement("img"):document.createElement("i"),wrapper:null};d.toast.setAttribute("data-iziToast-ref",h.ref),d.toast.appendChild(d.toastBody),d.toastCapsule.appendChild(d.toast),function(){if(d.toast.classList.add(i),d.toast.classList.add(i+"-opening"),d.toastCapsule.classList.add(i+"-capsule"),d.toastBody.classList.add(i+"-body"),d.toastTexts.classList.add(i+"-texts"),s||window.innerWidth<=f?h.transitionInMobile&&d.toast.classList.add(h.transitionInMobile):h.transitionIn&&d.toast.classList.add(h.transitionIn),h.class){var E=h.class.split(" ");S(E,function(b,U){d.toast.classList.add(b)})}h.id&&(d.toast.id=h.id),h.rtl&&(d.toast.classList.add(i+"-rtl"),d.toast.setAttribute("dir","rtl")),h.layout>1&&d.toast.classList.add(i+"-layout"+h.layout),h.balloon&&d.toast.classList.add(i+"-balloon"),h.maxWidth&&(isNaN(h.maxWidth)?d.toast.style.maxWidth=h.maxWidth:d.toast.style.maxWidth=h.maxWidth+"px"),(h.theme!==""||h.theme!=="light")&&d.toast.classList.add(i+"-theme-"+h.theme),h.color&&(Y(h.color)?d.toast.style.background=h.color:d.toast.classList.add(i+"-color-"+h.color)),h.backgroundColor&&(d.toast.style.background=h.backgroundColor,h.balloon&&(d.toast.style.borderColor=h.backgroundColor))}(),function(){h.image&&(d.cover.classList.add(i+"-cover"),d.cover.style.width=h.imageWidth+"px",ve(h.image.replace(/ /g,""))?d.cover.style.backgroundImage="url(data:image/png;base64,"+h.image.replace(/ /g,"")+")":d.cover.style.backgroundImage="url("+h.image+")",h.rtl?d.toastBody.style.marginRight=h.imageWidth+10+"px":d.toastBody.style.marginLeft=h.imageWidth+10+"px",d.toast.appendChild(d.cover))}(),function(){h.close?(d.buttonClose=document.createElement("button"),d.buttonClose.type="button",d.buttonClose.classList.add(i+"-close"),d.buttonClose.addEventListener("click",function(E){E.target,y.hide(h,d.toast,"button")}),d.toast.appendChild(d.buttonClose)):h.rtl?d.toast.style.paddingLeft="18px":d.toast.style.paddingRight="18px"}(),function(){h.progressBar&&(d.progressBar=document.createElement("div"),d.progressBarDiv=document.createElement("div"),d.progressBar.classList.add(i+"-progressbar"),d.progressBarDiv.style.background=h.progressBarColor,d.progressBar.appendChild(d.progressBarDiv),d.toast.appendChild(d.progressBar)),h.timeout&&(h.pauseOnHover&&!h.resetOnHover&&(d.toast.addEventListener("mouseenter",function(E){y.progress(h,d.toast).pause()}),d.toast.addEventListener("mouseleave",function(E){y.progress(h,d.toast).resume()})),h.resetOnHover&&(d.toast.addEventListener("mouseenter",function(E){y.progress(h,d.toast).reset()}),d.toast.addEventListener("mouseleave",function(E){y.progress(h,d.toast).start()})))}(),function(){h.iconUrl?(d.icon.setAttribute("class",i+"-icon"),d.icon.setAttribute("src",h.iconUrl)):h.icon&&(d.icon.setAttribute("class",i+"-icon "+h.icon),h.iconText&&d.icon.appendChild(document.createTextNode(h.iconText)),h.iconColor&&(d.icon.style.color=h.iconColor)),(h.icon||h.iconUrl)&&(h.rtl?d.toastBody.style.paddingRight="33px":d.toastBody.style.paddingLeft="33px",d.toastBody.appendChild(d.icon))}(),function(){h.title.length>0&&(d.strong=document.createElement("strong"),d.strong.classList.add(i+"-title"),d.strong.appendChild(q(h.title)),d.toastTexts.appendChild(d.strong),h.titleColor&&(d.strong.style.color=h.titleColor),h.titleSize&&(isNaN(h.titleSize)?d.strong.style.fontSize=h.titleSize:d.strong.style.fontSize=h.titleSize+"px"),h.titleLineHeight&&(isNaN(h.titleSize)?d.strong.style.lineHeight=h.titleLineHeight:d.strong.style.lineHeight=h.titleLineHeight+"px")),h.message.length>0&&(d.p=document.createElement("p"),d.p.classList.add(i+"-message"),d.p.appendChild(q(h.message)),d.toastTexts.appendChild(d.p),h.messageColor&&(d.p.style.color=h.messageColor),h.messageSize&&(isNaN(h.titleSize)?d.p.style.fontSize=h.messageSize:d.p.style.fontSize=h.messageSize+"px"),h.messageLineHeight&&(isNaN(h.titleSize)?d.p.style.lineHeight=h.messageLineHeight:d.p.style.lineHeight=h.messageLineHeight+"px")),h.title.length>0&&h.message.length>0&&(h.rtl?d.strong.style.marginLeft="10px":h.layout!==2&&!h.rtl&&(d.strong.style.marginRight="10px"))}(),d.toastBody.appendChild(d.toastTexts);var A;(function(){h.inputs.length>0&&(d.inputs.classList.add(i+"-inputs"),S(h.inputs,function(E,b){d.inputs.appendChild(q(E[0])),A=d.inputs.childNodes,A[b].classList.add(i+"-inputs-child"),E[3]&&setTimeout(function(){A[b].focus()},300),A[b].addEventListener(E[1],function(U){var Z=E[2];return Z(y,d.toast,this,U)})}),d.toastBody.appendChild(d.inputs))})(),function(){h.buttons.length>0&&(d.buttons.classList.add(i+"-buttons"),S(h.buttons,function(E,b){d.buttons.appendChild(q(E[0]));var U=d.buttons.childNodes;U[b].classList.add(i+"-buttons-child"),E[2]&&setTimeout(function(){U[b].focus()},300),U[b].addEventListener("click",function(Z){Z.preventDefault();var ph=E[1];return ph(y,d.toast,this,Z,A)})})),d.toastBody.appendChild(d.buttons)}(),h.message.length>0&&(h.inputs.length>0||h.buttons.length>0)&&(d.p.style.marginBottom="0"),(h.inputs.length>0||h.buttons.length>0)&&(h.rtl?d.toastTexts.style.marginLeft="10px":d.toastTexts.style.marginRight="10px",h.inputs.length>0&&h.buttons.length>0&&(h.rtl?d.inputs.style.marginLeft="8px":d.inputs.style.marginRight="8px")),function(){d.toastCapsule.style.visibility="hidden",setTimeout(function(){var E=d.toast.offsetHeight,b=d.toast.currentStyle||window.getComputedStyle(d.toast),U=b.marginTop;U=U.split("px"),U=parseInt(U[0]);var Z=b.marginBottom;Z=Z.split("px"),Z=parseInt(Z[0]),d.toastCapsule.style.visibility="",d.toastCapsule.style.height=E+Z+U+"px",setTimeout(function(){d.toastCapsule.style.height="auto",h.target&&(d.toastCapsule.style.overflow="visible")},500),h.timeout&&y.progress(h,d.toast).start()},100)}(),function(){var E=h.position;if(h.target)d.wrapper=document.querySelector(h.target),d.wrapper.classList.add(i+"-target"),h.targetFirst?d.wrapper.insertBefore(d.toastCapsule,d.wrapper.firstChild):d.wrapper.appendChild(d.toastCapsule);else{if(l.indexOf(h.position)==-1){console.warn("["+i+`] Incorrect position.
It can be › `+l);return}s||window.innerWidth<=f?h.position=="bottomLeft"||h.position=="bottomRight"||h.position=="bottomCenter"?E=i+"-wrapper-bottomCenter":h.position=="topLeft"||h.position=="topRight"||h.position=="topCenter"?E=i+"-wrapper-topCenter":E=i+"-wrapper-center":E=i+"-wrapper-"+E,d.wrapper=document.querySelector("."+i+"-wrapper."+E),d.wrapper||(d.wrapper=document.createElement("div"),d.wrapper.classList.add(i+"-wrapper"),d.wrapper.classList.add(E),document.body.appendChild(d.wrapper)),h.position=="topLeft"||h.position=="topCenter"||h.position=="topRight"?d.wrapper.insertBefore(d.toastCapsule,d.wrapper.firstChild):d.wrapper.appendChild(d.toastCapsule)}isNaN(h.zindex)?console.warn("["+i+"] Invalid zIndex."):d.wrapper.style.zIndex=h.zindex}(),function(){h.overlay&&(document.querySelector("."+i+"-overlay.fadeIn")!==null?(d.overlay=document.querySelector("."+i+"-overlay"),d.overlay.setAttribute("data-iziToast-ref",d.overlay.getAttribute("data-iziToast-ref")+","+h.ref),!isNaN(h.zindex)&&h.zindex!==null&&(d.overlay.style.zIndex=h.zindex-1)):(d.overlay.classList.add(i+"-overlay"),d.overlay.classList.add("fadeIn"),d.overlay.style.background=h.overlayColor,d.overlay.setAttribute("data-iziToast-ref",h.ref),!isNaN(h.zindex)&&h.zindex!==null&&(d.overlay.style.zIndex=h.zindex-1),document.querySelector("body").appendChild(d.overlay)),h.overlayClose?(d.overlay.removeEventListener("click",{}),d.overlay.addEventListener("click",function(E){y.hide(h,d.toast,"overlay")})):d.overlay.removeEventListener("click",{}))}(),function(){if(h.animateInside){d.toast.classList.add(i+"-animateInside");var E=[200,100,300];(h.transitionIn=="bounceInLeft"||h.transitionIn=="bounceInRight")&&(E=[400,200,400]),h.title.length>0&&setTimeout(function(){d.strong.classList.add("slideIn")},E[0]),h.message.length>0&&setTimeout(function(){d.p.classList.add("slideIn")},E[1]),(h.icon||h.iconUrl)&&setTimeout(function(){d.icon.classList.add("revealIn")},E[2]);var b=150;h.buttons.length>0&&d.buttons&&setTimeout(function(){S(d.buttons.childNodes,function(U,Z){setTimeout(function(){U.classList.add("revealIn")},b),b=b+150})},h.inputs.length>0?150:0),h.inputs.length>0&&d.inputs&&(b=150,S(d.inputs.childNodes,function(U,Z){setTimeout(function(){U.classList.add("revealIn")},b),b=b+150}))}}(),h.onOpening.apply(null,[h,d.toast]);try{var k=new CustomEvent(i+"-opening",{detail:h,bubbles:!0,cancelable:!0});document.dispatchEvent(k)}catch(E){console.warn(E)}setTimeout(function(){d.toast.classList.remove(i+"-opening"),d.toast.classList.add(i+"-opened");try{var E=new CustomEvent(i+"-opened",{detail:h,bubbles:!0,cancelable:!0});document.dispatchEvent(E)}catch(b){console.warn(b)}h.onOpened.apply(null,[h,d.toast])},1e3),h.drag&&(c?(d.toast.addEventListener("touchstart",function(E){Ee.startMoving(this,y,h,E)},!1),d.toast.addEventListener("touchend",function(E){Ee.stopMoving(this,E)},!1)):(d.toast.addEventListener("mousedown",function(E){E.preventDefault(),Ee.startMoving(this,y,h,E)},!1),d.toast.addEventListener("mouseup",function(E){E.preventDefault(),Ee.stopMoving(this,E)},!1))),h.closeOnEscape&&document.addEventListener("keyup",function(E){E=E||window.event,E.keyCode==27&&y.hide(h,d.toast,"esc")}),h.closeOnClick&&d.toast.addEventListener("click",function(E){y.hide(h,d.toast,"toast")}),y.toast=d.toast},r})})(Uv);xt.settings({timeout:6e3,resetOnHover:!0,icon:"material-icons",transitionIn:"flipInX",transitionOut:"flipOutX",position:"topRight"});class Bv{error(e){xt.error({title:"Error",message:e})}success(e){xt.success({title:"OK",message:e})}info(e){xt.info({title:"Info",message:e})}}const nc=new Bv,qv=document.querySelector(".filter-list-js");let rc="";const jv=["BUTTON","svg","use","P"];let ic,sc,oc;async function $v(t){t.preventDefault();const e=document.querySelector(".modal-get-raiting").dataset.id,r=document.querySelector(".rating-container-js").dataset.rating,i=document.querySelector(".raiting-form-field-input").value,s=document.querySelector(".raiting-form-field-comment").value,o={rate:Number(r),email:i,review:s},a=await Si.addExercisesRate(e,o);a.message?nc.error(`${a.message}`):(nc.success(`Thank you for your mark - ${o.rate} for ${a.name}`),zr.close())}async function zv(){const t=document.querySelector(".modal-info").dataset.id;zr.close(),zr.open(Mv(t)),xv(),oc=document.querySelector(".raiting-form"),oc.addEventListener("submit",$v)}async function Hv(t){const e=document.querySelector(".refresh-button-js"),n=document.querySelector(".modal-info").dataset.id;let i=window.location.href.toString().slice(-14);if(e.dataset.favorite==="false"){e.innerHTML=`<button class="add-favorite-js" type="button">
                                        <span class="remote-favorites">Remove from favorites</span>
                                        <svg class="trash-icon-img" width="18" height="18" aria-label="trash-icon">
                                            <use href="${oe}#icon-trash"></use>
                                        </svg>
                                    </button>`,e.dataset.favorite="true";let s=await Si.getOneExercises(n);Fv(s),i==="favorites.html"&&On()}else e.innerHTML=`<button class="add-favorite-js" type="button">
                                        <span>Add to favorites</span>
                                        <svg class="heart-icon-img" width="20" height="20" aria-label="heart-icon">
                                            <use href="${oe}#icon-heart"></use>
                                        </svg>
                                    </button>`,e.dataset.favorite="false",fh(n),i==="favorites.html"&&On()}function Wv({target:t}){if(jv.includes(t.nodeName)&&t.classList[0]!=="favourites_btn_trash_icon"&&t.classList[0]!=="favourites_btn_workout")return rc=t.dataset.id,Gv(rc);if(t.classList[0]==="favourites_btn_trash_icon"){const e=t.dataset.id;fh(e),On()}}qv.addEventListener("click",Wv);const Gv=async t=>{let e=await Si.getOneExercises(t);const n=localStorage.getItem("favorites");n!==null&&JSON.parse(n).find(({_id:s})=>s===t)?e.favorite=!0:e.favorite=!1,zr.open(Lv(e)),sc=document.querySelector(".refresh-button-js"),ic=document.querySelector(".add-rating"),ic.addEventListener("click",zv),sc.addEventListener("click",Hv)};
//# sourceMappingURL=commonHelpers.js.map
